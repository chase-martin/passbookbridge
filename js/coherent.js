window.$P=function(){};if("undefined"!==typeof(coherent)){throw new Error("Library module (coherent) already defined")}var coherent={version:"@VERSION@",revision:"@REVISION@",generateUid:(function(){var a=0;return function(){return ++a}})()};coherent.Browser={IE:!!(window.attachEvent&&!window.opera)&&(function(){var b=/MSIE (\d+)/;var a=b.exec(navigator.userAgent);return a&&parseInt(a[1],10)})(),Safari:navigator.userAgent.indexOf("AppleWebKit/")>-1,Safari2:(function(){var a=/AppleWebKit\/(\d+(?:\.\d+)?)/;var b=a.exec(navigator.userAgent);return(b&&parseInt(b[1],10)<420)})(),Mozilla:navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("KHTML")==-1,MobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/),Chrome:navigator.userAgent.indexOf("Chrome")>-1};coherent.OS={Mac:navigator.userAgent.indexOf("Mac OS X")>-1&&navigator.userAgent.indexOf("Mobile")==-1,Windows:navigator.userAgent.indexOf("Windows")>-1,Linux:navigator.userAgent.indexOf("Linux")>-1,iPhone:navigator.userAgent.indexOf("iPhone")>-1};coherent.Support={Properties:("__defineGetter__" in Object.prototype),QuerySelector:("querySelector" in document),Touches:!!document.createTouch,CSS3ColorModel:false,CSSTransitions:false};if(coherent.Support.Properties){coherent.Support.__defineGetter__("CSS3ColorModel",function(){delete this.CSS3ColorModel;var b=document.createElement("span");try{b.style.backgroundColor="rgba(100,100,100,0.5)";return this.CSS3ColorModel=(b.style.length===1)}catch(a){}return(this.CSS3ColorModel=false)});coherent.Support.__defineGetter__("CSSTransitions",function(){delete this.CSSTransitions;var b=document.createElement("span");try{b.style.setProperty("-webkit-transition-duration","1ms","");b.style.setProperty("-o-transition-duration","1ms","");b.style.setProperty("-moz-transition-duration","1ms","");return this.CSSTransitions=(b.style.length>0)}catch(a){}return(this.CSSTransitions=false)})}coherent.typeOf=function(b){if(null===b){return"null"}var a=typeof(b);if("object"!==a&&"function"!==a){return a}return Object.prototype.toString.call(b).slice(8,-1).toLowerCase()};coherent.compareValues=function(g,d){var c=coherent.typeOf(g);if(c!==coherent.typeOf(d)){var a=String(g);var f=String(d);return a.localeCompare(f)}switch(c){case"null":return 0;case"boolean":case"number":var b=(g-d);if(0===b){return b}return(b<0?-1:1);case"regexp":case"function":break;case"string":case"array":case"object":if(g.localeCompare){return g.localeCompare(d)}if(g.compare){return g.compare(d)}break;case"undefined":return true;default:throw new TypeError("Unknown type for comparison: "+c)}return String(g).localeCompare(String(d))};coherent.defineError=function(b){function a(c){this.message=c;this.name=b}a.prototype=new Error;a.prototype.constructor=a;a.prototype.name=b;return a};var InvalidArgumentError=coherent.defineError("InvalidArgumentError");if("undefined"==typeof(window.console)){window.console={}}if("undefined"==typeof(window.console.log)){window.console.log=function(){}}String.prototype.titleCase=function(){return this.charAt(0).toUpperCase()+this.substr(1)};String.prototype.trim=function(){var b=this.replace(/^\s+/,"");for(var a=b.length-1;a>0;--a){if(/\S/.test(b.charAt(a))){b=b.substring(0,a+1);break}}return b};String.prototype.beginsWith=function(a){return a===this.substring(0,a.length)};if(!String.prototype.localeCompare){String.prototype.localeCompare=function(a){if(this<a){return -1}else{if(this>a){return 1}else{return 0}}}}String.prototype.expand=function(c,a){function b(g,d){var f=c[d];if(null===f||"undefined"===typeof(f)){return a}return f}return this.replace(/\$\{(\w+)\}/g,b)};String.prototype.times=function(b){if(isNaN(b)||b<=0){return""}var a=this;while(--b){a+=this}return a};String.prototype.truncate=function truncate(){var c=arguments[0],b=coherent.typeOf(c)==="number",l=b?{}:(c||{}),f=this.toString(),d=Math,a=b?c:(l.length||30),k,h=l.omission||"\u2026",g=l.from||"start";if(this.length>a){switch(g){case"start":case"beginning":f=this.slice(0,a).stripPunctuationAtEnd().trim()+h;break;case"middle":k=d.floor(a/2);f=[this.slice(0,k).stripPunctuationAtEnd().trim(),h,this.slice(-k).stripPunctuationAtStart().trim()].join(" ");break;case"end":case"ending":f=h+this.slice(-a).stripPunctuationAtStart().trim();break;default:break}}return f};String.prototype.escapeForInnerHTML=function(){var a=document.createElement("div");a.innerHTML="&";if(a.innerHTML===""){String.prototype.escapeForInnerHTML=function(){return this.replace(/&((\w){0,10})$/g,"&amp;$1")}}else{String.prototype.escapeForInnerHTML=function(){return this.valueOf()}}return this.escapeForInnerHTML()};String.stringify=function(a){return typeof a==="string"?a:String(a)};(function(){var c=String.prototype,k="\\s!¡\\?¿‽\\.\\,…:;_\\-–—~·•‘’“”‚„‛‟′`″'\"#\\$&\\*@§¶\\^\\|\\/",d="",g="[",h="]",a="+",o=new RegExp([g,k,h,a,"$"].join(d)),m=new RegExp(["^",g,k,h,a].join(d)),b=/<[^>]*>/g,l=function l(){return this.replace(o,d)},n=function n(){return this.replace(m,d)},f=function f(){return this.replace(b,d)};c.stripPunctuationAtEnd=l;c.stripPunctuationAtStart=n;c.stripTags=f})();if("undefined"!==typeof(window.Prototype)){(function(){var a=["indexOf","lastIndexOf","forEach","filter","map","some","every","reduce","reduceRight"];for(var b=0;b<a.length;++b){delete Array.prototype[a[b]]}})()}Array.prototype.distinct=function(){var b=this.length;var a=new Array(b);var c;var f;var d=0;for(c=0;c<b;++c){f=this[c];if(-1==a.indexOf(f)){a[d++]=f}}a.length=d;return a};Array.prototype.compare=function(c){var f=this.length-c.length;if(0!==f){return f}var g;var b;var d;for(g=0,b=this.length;g<b;++g){d=coherent.compareValues(this[g],c[g]);if(0!==d){return d}}return 0};Array.from=function(a,b){return Array.prototype.slice.call(a,b||0)};if(!Array.prototype.reduce){Array.prototype.reduce=function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}if(0===a&&1===arguments.length){throw new TypeError()}var c=0;if(arguments.length>=2){var d=arguments[1]}else{do{if(c in this){d=this[c++];break}if(++c>=a){throw new TypeError()}}while(true)}for(;c<a;c++){if(c in this){d=b.call(null,d,this[c],c,this)}}return d}}if(!Array.prototype.reduceRight){Array.prototype.reduceRight=function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}if(0===a&&1===arguments.length){throw new TypeError()}var c=a-1;if(arguments.length>=2){var d=arguments[1]}else{do{if(c in this){d=this[c--];break}if(--c<0){throw new TypeError()}}while(true)}for(;c>=0;c--){if(c in this){d=b.call(null,d,this[c],c,this)}}return d}}if(!Array.indexOf){Array.indexOf=function(c,b,a){return Array.prototype.indexOf.call(c,b,a)}}if(!Array.lastIndexOf){Array.lastIndexOf=function(c,b,a){return Array.prototype.lastIndexOf.call(c,b,a)}}if(!Array.forEach){Array.forEach=function(c,a,b){return Array.prototype.forEach.call(c,a,b)}}if(!Array.filter){Array.filter=function(c,a,b){return Array.prototype.filter.call(c,a,b)}}if(!Array.map){Array.map=function(c,a,b){return Array.prototype.map.call(c,a,b)}}if(!Array.some){Array.some=function(c,a,b){return Array.prototype.some.call(c,a,b)}}if(!Array.every){Array.every=function(c,a,b){return Array.prototype.every.call(c,a,b)}}if(!Array.reduce){Array.reduce=function(b,a){if(arguments.length>2){return Array.prototype.reduce.call(b,a,arguments[2])}else{return Array.prototype.reduce.call(b,a)}}}if(!Array.reduceRight){Array.reduceRight=function(b,a){if(arguments.length>2){return Array.prototype.reduceRight.call(b,a,arguments[2])}else{return Array.prototype.reduceRight.call(b,a)}}}Array.from=function(d,f){var b=d.length;var a=[];for(var c=(f||0);c<b;++c){a.push(d[c])}return a};if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c,b){if("undefined"===typeof(b)){b=0}else{if(b<0){b=Math.max(0,this.length+b)}}for(var a=b;a<this.length;a++){if(this[a]===c){return a}}return -1}}if(!Array.prototype.lastIndexOf){Array.prototype.lastIndexOf=function(c,b){if("undefined"===typeof(b)){b=this.length-1}else{if(b<0){b=Math.max(0,this.length+b)}}for(var a=b;a>=0;a--){if(this[a]===c){return a}}return -1}}if(!Array.prototype.forEach){Array.prototype.forEach=function(c,d){var a=this.length;for(var b=0;b<a;b++){c.call(d,this[b],b,this)}}}if(!Array.prototype.filter){Array.prototype.filter=function(d,g){var a=this.length;var c=[];for(var b=0;b<a;b++){if(d.call(g,this[b],b,this)){c.push(this[b])}}return c}}if(!Array.prototype.map){Array.prototype.map=function(d,g){var a=this.length;var c=[];for(var b=0;b<a;b++){c.push(d.call(g,this[b],b,this))}return c}}if(!Array.prototype.some){Array.prototype.some=function(c,d){var a=this.length;for(var b=0;b<a;b++){if(c.call(d,this[b],b,this)){return true}}return false}}if(!Array.prototype.every){Array.prototype.every=function(c,d){var a=this.length;for(var b=0;b<a;b++){if(!c.call(d,this[b],b,this)){return false}}return true}}if(!Function.prototype.bind){Function.prototype.bind=function(c){var a=this;if(!arguments.length){return a}if(1==arguments.length){return function(){return a.apply(c,arguments)}}var b=Array.from(arguments,1);return function(){return a.apply(c,b.concat(Array.from(arguments)))}}}if(!Function.prototype.bindAsEventListener){Function.prototype.bindAsEventListener=function(c){var a=this;if(1==arguments.length){return function(d){return a.call(c,d||window.event)}}var b=Array.from(arguments);b.shift();return function(d){return a.apply(c,[d||window.event].concat(b))}}}if(!Function.prototype.delay){Function.prototype.delay=function(d){var b=this;d=d||10;if(arguments.length<2){function a(){b()}return window.setTimeout(a,d)}var c=Array.from(arguments,1);function f(){b.apply(b,c)}return window.setTimeout(f,d)}}if(!Function.prototype.bindAndDelay){Function.prototype.bindAndDelay=function(g,d){var b=this;g=g||b;d=d||10;if(arguments.length<3){function a(){b.call(g)}return window.setTimeout(a,d)}var c=Array.from(arguments,2);function f(){b.apply(g,c)}return window.setTimeout(f,d)}}if(!Function.prototype.bindAndRepeat){Function.prototype.bindAndRepeat=function(g,c){var b=this;g=g||b;c=c||10;if(arguments.length<3){function a(){b.call(g)}return window.setInterval(a,c)}var d=Array.from(arguments,2);function f(){b.apply(g,d)}return window.setInterval(f,c)}}Function.prototype.sync=function(){var b=arguments.length?this.bind.apply(this,arguments):this;var a={};var c=false;b.stop=function(){c=true};b.waitFor=function(d){a[d]=true;return function(){a[d]=false;for(var f in a){if(a[f]){return}}if(c){return}b()}};return b};function Set(){var d=this;if(d.constructor!==Set){d=new Set()}var b=arguments;if(1==b.length&&b[0] instanceof Array){b=b[0]}var c;var a=b.length;for(c=0;c<a;++c){d[b[c]]=true}return d}Set.union=function(c,b){var a=Object.clone(c);if(!b){return a}var d;for(d in b){a[d]=true}return a};Set.intersect=function(c,b){var a=new Set();var d;for(d in c){if(d in b){a[d]=true}}return a};Set.add=function(b,a){b[a]=true;return b};Set.remove=function(b,a){delete b[a];return b};Set.toArray=function(d){var c;var b=[];for(c in d){b.push(c)}return b};Set.forEach=function(f,c,b){var d;var a=0;for(d in f){c.call(b,d,a++)}};Set.join=function(f,c){var d;var b=[];for(d in f){b.push(d)}return b.join(c||"")};var $S=Set;Object.clone=function(b){var a=(function(){});a.prototype=b;return new a()};Object.applyDefaults=function(c,b){c=c||{};if(!b){return c}for(var a in b){if(a in c){continue}c[a]=b[a]}return c};Object.extend=function(c,a){c=c||{};for(var b in a){c[b]=a[b]}return c};Object.merge=function(c,a){var b={};var d;for(d in c){b[d]=c[d]}for(d in a){if(d in b){continue}b[d]=a[d]}return b};(function(){var b=Set("file","submit","image","reset","button");var d={};function f(l,k,m){var h=l[k];var g=coherent.typeOf(h);if("string"===g){l[k]=[h,m]}else{if("array"===g){h.push(m)}else{l[k]=m}}}function c(k){var g=k.name;var h=(k.type||"").toLowerCase();if(k.disabled||h in b){return}if("radio"===h||"checkbox"===h){if(k.checked){f(this,g,k.value)}}else{if(k.multiple){function l(m){if(m.selected){f(this,g,m.value)}}this[g]=[];Array.forEach(k.options,l,this)}else{f(this,g,k.value);if("image"===h){f(this,g+".x",0);f(this,g+".y",0)}}}}Object.fromForm=function(h){var g={};Array.forEach(h.elements,c,g);return g};function a(k){k=k.split("=");if(1===k.length){return}var g=decodeURIComponent(k[0].trim());var h=decodeURIComponent(k[1].trim())||null;f(this,g,h)}Object.fromQueryString=function(h){if("?"==h.charAt(0)){h=h.slice(1)}h=h.split(/\s*&\s*/);var g={};h.forEach(a,g);return g};Object.toQueryString=function(n){if(!n){return""}var k;var m;var g;var h=[];function l(o){if(null!==o&&"undefined"!==typeof(o)){o=encodeURIComponent(o)}h.push(k+"="+o)}for(k in n){m=n[k];g=coherent.typeOf(m);if("null"===g){m=""}if("function"===g||m===d[k]){continue}k=encodeURIComponent(k);if("array"===g){m.forEach(l)}else{l(m)}}return h.join("&")}})();RegExp.escape=function(a){return a.replace(RegExp._escapeRegex,"\\$1")};RegExp.specialCharacters=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];RegExp._escapeRegex=new RegExp("(\\"+RegExp.specialCharacters.join("|\\")+")","g");var Class=(function(){function d(l,o){var m;if(!l&&!o){return l}if(!l){m=function(){return o.apply(this,arguments)}}else{var n=/this\.base/.test(l);if(!n&&!o){return l}if(!n){m=function(){o.call(this);return l.apply(this,arguments)}}else{m=function(){var q=this.base;this.base=o||function(){};var p=l.apply(this,arguments);this.base=q;return p}}}m.valueOf=function(){return l};m.toString=function(){return String(l)};return m}function h(l,m){var n=l.prototype.__factory__.apply(l,m);if("function"!==typeof(n)){throw new Error("Factory function doesn't return a function")}n.__factoryFn__=true;return n}function g(n){if(n.__createFactoryObjects){n.__createFactoryObjects();return}var m;var l;for(m in n.__factories__){l=n[m];if(!l.__factoryFn__){continue}n[m]=l.call(n)}}function c(l,n){if(l&&!(l instanceof Function)){throw new Error("Invalid constructor")}if(n&&!(n instanceof Function)){throw new Error("Invalid superclass")}n=n?n.valueOf():null;l=d(l,n);var m;if(l){m=function(){if(!(this instanceof m)){return h(m,arguments)}this.__uid=this.__uid||coherent.generateUid();var o=l.apply(this,arguments);g(this);if(this.__postConstruct instanceof Function){this.__postConstruct()}return o||this}}else{m=function(){if(!(this instanceof m)){return h(m,arguments)}this.__uid=this.__uid||coherent.generateUid();g(this);if(this.__postConstruct instanceof Function){this.__postConstruct()}return this}}m.valueOf=function(){return l};m.toString=function(){return String(l||m)};return m}function b(m){function l(){}l.prototype=m.prototype;return new l()}function f(n,l){if(!n||!/this\.base/.test(n)){return n}function m(){var p=this.base;this.base=l||function(){};var o=n.apply(this,arguments);this.base=p;return o}m.valueOf=function(){return n};m.toString=function(){return String(n)};return m}function k(n,l,o){if(o instanceof Function){var m=n[l];var p=o.valueOf();if(m instanceof Function&&m.valueOf()!==p){o=f(o,m)}if(p.__factoryFn__){n.__factories__[l]=o}}n[l]=o;return o}function a(m){var l;for(l=m.superclass;l;l=l.superclass){if("__subclassCreated__" in l){l.__subclassCreated__(m)}}}return{create:function(o,m){var l;var n={};switch(arguments.length){case 0:throw new TypeError("Missing superclass and declaration arguments");case 1:m=o;o=undefined;break;default:n=b(o);break}if("function"==typeof(m)){m=m();if(!m){throw new Error("Class declaration function did not return a prototype")}}if(m.hasOwnProperty("constructor")){l=m.constructor;delete m.constructor}l=c(l,o);l.prototype=n;l.prototype.constructor=l;l.superclass=o;if(o){n.__factories__=Object.clone(o.prototype.__factories__)}else{n.__factories__={}}this.extend(l,m);a(l);return l},findPropertyName:function(o,l){var m;for(var n in o){m=o[n];if(m===l||("function"===typeof(m)&&m.valueOf()===l)){return n}}return null},extend:(function(){if(coherent.Support.Properties){return function(l,m){var r=l.prototype;var n;for(var t in m){var q=m.__lookupGetter__(t);var o=m.__lookupSetter__(t);if(q||o){q&&r.__defineGetter__(t,q);o&&r.__defineSetter__(t,o)}else{k(r,t,m[t])}}return l}}else{return function(l,m){var n=l.prototype;for(var o in m){k(n,o,m[o])}}}})()}})();coherent.strings={"marker.input.multipleValues":"Multiple Values","marker.input.placeholder":"","marker.input.noSelection":"No Selection","marker.image.multipleValues":"","marker.image.placeholder":"","marker.image.noSelection":"","marker.text.multipleValues":"Multiple Values","marker.text.placeholder":"","marker.text.noSelection":"No Selection","error.no_description":"An unspecified error occurred.","error.invalid_value":"This value is not valid.","error.invalid_number":"This value is not a valid number."};coherent.localisedString=function(a){return{valueOf:function(){if(a in coherent.strings){return coherent.strings[a]}return null},toString:function(){if(a in coherent.strings){return coherent.strings[a]}console.log("Localisation missing string for key: "+a);return a}}};var _=coherent.localisedString;coherent.Error=Class.create({constructor:function(a){Object.extend(this,a)},toString:function(){return this.description},description:_("error.no_description"),recoverySuggestion:null});coherent.KeyInfo=Class.create({constructor:function(d,b){var a=coherent.KVO.getPropertyMethodsForKeyOnObject(b,d);this.__uid=[b,coherent.generateUid()].join("_");this.reader=a.getter;this.mutator=a.mutator;this.validator=a.validator;this.key=b;this.mutable=((this.mutator||!this.reader)?true:false);if(!this.reader&&!this.mutator){this.mutable=true}this.changeCount=0;var c=a.value;if(!c){return}var f=coherent.typeOf(c);if(f in coherent.KVO.typesOfKeyValuesToIgnore||!c._addParentLink){return}c._addParentLink(d,this)},get:function(b){if(this.reader){return this.reader.call(b)}var a;if(this.key in b){a=b[this.key]}else{a=null}if(a&&a._addParentLink){a._addParentLink(b,this)}return a},set:function(b,a){if(this.mutator){this.mutator.call(b,a)}else{b.willChangeValueForKey(this.key,this);if("undefined"===typeof(a)){a=null}b[this.key]=a;b.didChangeValueForKey(this.key,this)}},validate:function(b,a){if(!this.validator){return a}return this.validator.call(b,a)},unlinkParentLink:function(){if(!this.parentLink){return}this.parentLink.observer=null;this.parentLink.callback=null;this.parentLink=null}});coherent.ChangeType={setting:0,insertion:1,deletion:2,replacement:3};coherent.ChangeNotification=Class.create({constructor:function(d,a,f,c,b){this.object=d;this.changeType=a;this.newValue=f;this.oldValue=c;this.indexes=b;this.objectKeyPath=[]},toString:function(){var a="[ChangeNotification changeType: ";switch(this.changeType){case coherent.ChangeType.setting:a+="setting";break;case coherent.ChangeType.insertion:a+="insertion";break;case coherent.ChangeType.deletion:a+="deletion";break;case coherent.ChangeType.replacement:a+="replacement";break;default:a+="<<unknown>>";break}a+=" newValue="+this.newValue+" oldValue="+this.oldValue+(this.indexes?" indexes="+this.indexes.join(", "):"")+"]";return a}});coherent.ObserverEntry=Class.create({constructor:function(a,c,b){this.observer=a;this.callback=c;this.context=b},observeChangeForKeyPath:function(a,b){if(!this.callback||!this.observer||-1!==a.objectKeyPath.indexOf(this.observer)){return}this.callback.call(this.observer,a,b,this.context)}});coherent.KVO=Class.create({constructor:function(){},__factory__:function(){var b=Array.from(arguments);var a=this;function c(){}return function(){c.prototype=a.prototype;var d=new c();a.prototype.constructor.apply(d,b);return d}},setValueForKeyPath:function(c,d){if(!d||0===d.length){throw new InvalidArgumentError("keyPath may not be empty")}if("string"==typeof(d)){if("$"==d.charAt(0)){this.setValueForVariableKeyPath(c,d);return}d=d.split(".")}var b=d[0];if(1==d.length){this.setValueForKey(c,b);return}if("@"==b.charAt(0)){return}var a=this.valueForKey(b);if(!a){return}a.setValueForKeyPath(c,d.slice(1))},setValueForVariableKeyPath:function(a,c){var b=coherent.VariableKeyPath.resolve(c,this);if("undefined"===typeof(b)){return}this.setValueForKeyPath(a,b)},setValueForKey:function(b,a){if(!a||0===a.length){throw new InvalidArgumentError("key may not be empty")}var c=this.infoForKey(a);if(!c||!c.mutable){return}c.set(this,b)},valueForKeyPath:function(f){if(!f||0===f.length){throw new InvalidArgumentError("keyPath may not be empty")}if("string"==typeof(f)){if("$"==f.charAt(0)){return this.valueForVariableKeypath(f)}f=f.split(".")}var d=f[0];if(1==f.length){return this.valueForKey(d)}if("@"==d.charAt(0)){var b=d.substr(1);var a=this.valueForKeyPath(f.slice(1));return coherent.ArrayOperator[b](a)}var c=this.valueForKey(d);if("undefined"===typeof(c)||null===c){return undefined}return c.valueForKeyPath(f.slice(1))},valueForVariableKeypath:function(b){var a=coherent.VariableKeyPath.resolve(b,this);if("undefined"===typeof(a)){return undefined}return this.valueForKeyPath(a)},valueForKey:function(a){if(!a||0===a.length){throw new InvalidArgumentError("the key is empty")}var b=this.infoForKey(a);if(!b){return null}return b.get(this)},validateValueForKeyPath:function(c,d){if(!d||0===d.length){throw new InvalidArgumentError("keyPath may not be empty")}if("string"==typeof(d)){if("$"==d.charAt(0)){return this.validateValueForVariableKeypath(c,d)}d=d.split(".")}var b=d[0];if(1==d.length){return this.validateValueForKey(c,b)}var a=this.valueForKey(b);if("undefined"===typeof(a)||null===a){return c}return a.validateValueForKeyPath(c,d.slice(1))},validateValueForVariableKeypath:function(a,c){var b=coherent.VariableKeyPath.resolve(c,this);if("undefined"===typeof(b)){return a}return this.validateValueForKeyPath(a,b)},validateValueForKey:function(b,a){if(!a||!a.length){throw new InvalidArgumentError("missing key")}var c=this.infoForKey(a);return c.validate(this,b)},observeChildObjectChangeForKeyPath:function(d,c,a){if(coherent.KVO.kAllPropertiesKey!=c){c=a+"."+c}else{c=a}var b=Object.clone(d);b.object=this;this.notifyObserversOfChangeForKeyPath(b,c)},infoForKeyPath:function(d){if(!d||0===d.length){throw new InvalidArgumentError("keyPath is empty")}if("string"==typeof(d)){if("$"==d.charAt(0)){return this.infoForVariableKeyPath(d)}d=d.split(".")}var b=d[0];if(1==d.length){return this.infoForKey(b)}else{if("@"==b.charAt(0)){var c=new coherent.KeyInfo(null,null);c.mutable=false;return c}else{var a=this.valueForKey(b);if(!a){return undefined}if(!a.infoForKeyPath){return undefined}return a.infoForKeyPath(d.slice(1))}}},infoForVariableKeyPath:function(b){var a=coherent.VariableKeyPath.resolve(b,this);return("undefined"===typeof(a))?undefined:this.infoForKeyPath(a)},infoForKey:function(a){var b;if(!this.__keys){this.__keys={}}if(coherent.KVO.kAllPropertiesKey==a){return null}b=this.__keys[a];if(b){return b}b=new coherent.KeyInfo(this,a);this.__keys[a]=b;return b},setKeysTriggerChangeNotificationsForDependentKey:function(d,c){if(!d||!d.length){throw new InvalidArgumentError("keys array is not valid")}if(!c){throw new InvalidArgumentError("dependentKey can not be null")}if(-1!==c.indexOf(".")){throw new InvalidArgumentError("dependentKey may not be a key path")}var b;var g;var a;var f;if("string"===typeof(d)){d=[d]}if(!this.__dependentKeys){this.__dependentKeys={}}for(a=0;a<d.length;++a){b=d[a];if(!b){throw new InvalidArgumentError("key at index "+a+" was null")}if(!(b in this.__dependentKeys)){this.__dependentKeys[b]=[]}coherent.KVO.getPropertyMethodsForKeyOnObject(b,this);f=this.__dependentKeys[b];if(-1==f.indexOf(c)){f.push(c)}}},mutableKeys:function(){var d=[];var b;var a;var c;if("__mutableKeys" in this&&this.__mutableKeys.concat){return this.__mutableKeys}var f=Set.union(coherent.KVO.keysToIgnore,this.__keysToIgnore);for(b in this){if(b in f||"__"===b.substr(0,2)){continue}a=this[b];if("function"!==typeof(a)){d.push(b);continue}if(1!==a.length||"set"!==b.substr(0,3)){continue}c=b.charAt(3);if(c!==c.toUpperCase()){continue}b=c.toLowerCase()+b.substr(4);if(b in f){continue}if(-1===d.indexOf(b)){d.push(b)}}return d},initialiseKeyValueObserving:function(){this.__uid=this.__uid||coherent.generateUid();this.__observers={};this.__variableBindings={}},_addParentLink:function(d,f,c){if(!this.hasOwnProperty("__observers")){this.initialiseKeyValueObserving()}var b=this.__observers[coherent.KVO.kAllPropertiesKey];if(!b){b=this.__observers[coherent.KVO.kAllPropertiesKey]={}}c=c||f.__uid;if(c in b){return}var a=new coherent.ObserverEntry(d,d.observeChildObjectChangeForKeyPath,f?f.key:"");b[c]=a;if(!f){return}f.unlinkParentLink();f.parentLink=a},_removeParentLink:function(c,d,b){if(!this.__observers){return}var a=this.__observers[coherent.KVO.kAllPropertiesKey];if(!a){a=this.__observers[coherent.KVO.kAllPropertiesKey]={}}b=b||d.__uid;if(d&&d.parentLink===a[b]){d.unlinkParentLink()}delete a[b]},addObserverForKeyPath:function(a,g,f,b){if(!f||0===f.length){throw new InvalidArgumentError("keyPath is empty")}if(!a){throw new InvalidArgumentError("Observer may not be null")}if(!g){g=a.observeChangeForKeyPath}if("string"===typeof(g)){g=a[g]}if(!g){throw new InvalidArgumentError("Missing callback method")}if(!this.hasOwnProperty("__observers")){this.initialiseKeyValueObserving()}if("$"===f.charAt(0)){var c=this.__variableBindings[f];if(!c){c=coherent.Binding.bindingFromString(f,this);this.__variableBindings[f]=c;c.bind();c.observerFn=function(p,n,k){var m=this.getObservers();for(var h in m){var l=m[h];l.observeChangeForKeyPath(p,n)}}}c.addObserver(a,g,b)}else{this.infoForKeyPath(f);if(!this.__observers[f]){this.__observers[f]=[]}var d=new coherent.ObserverEntry(a,g,b);this.__observers[f].push(d)}},removeObserverForKeyPath:function(c,h){if(!h||0===h.length){throw new InvalidArgumentError("keyPath may not be empty")}if(!c){throw new InvalidArgumentError("Observer may not be null")}if(!this.__observers){return}if("$"===h.charAt(0)){var d=this.__variableBindings[h];if(d){d.removeObserver(c)}return}if(!this.__observers[h]){return}var g=this.__observers[h];var b=-1;var f;var a=g.length;for(b=0;b<a;++b){f=g[b];if(f.observer==c){g.splice(b,1);return}}},willChangeValueForKey:function(a,c){if(!a){throw new InvalidArgumentError("key may not be null")}c=(c instanceof coherent.KeyInfo)?c:this.infoForKey(a);if(!c){return}if(1!==++c.changeCount){return}var b=(this.__dependentKeys&&this.__dependentKeys[a]);if(b){b.forEach(this.willChangeValueForKey,this)}c.previousValue=c.get(this)},forceChangeNotificationForKey:function(a,b){if(!a){throw new InvalidArgumentError("key may not be null")}b=(b instanceof coherent.KeyInfo)?b:this.infoForKey(a);if(!b){return}if(0!==b.changeCount){return}b.changeCount=1;this.didChangeValueForKey(a,b)},didChangeValueForKey:function(b,g){if(!b){throw new InvalidArgumentError("key may not be null")}g=(g instanceof coherent.KeyInfo)?g:this.infoForKey(b);if(!g){return}if(0!==--g.changeCount){return}var c=g.get(this);var a=g.previousValue;g.previousValue=null;if(c!==a){var f=new coherent.ChangeNotification(this,coherent.ChangeType.setting,c,a);this.notifyObserversOfChangeForKeyPath(f,b);if(a&&a._removeParentLink){a._removeParentLink(this,g)}if(c&&c._addParentLink){c._addParentLink(this,g)}}var d=(this.__dependentKeys&&this.__dependentKeys[b]);if(d){d.forEach(this.didChangeValueForKey,this)}},notifyObserversOfChangeForKeyPath:function(m,p){if(!p){throw new InvalidArgumentError("keyPath may not be null")}if(p.charAt(0)==="$"){throw new InvalidArgumentError("keyPath cannot be a variable keypath")}if(!this.__observers){return}var h;var g;var k;g=this.__observers[coherent.KVO.kAllPropertiesKey];if(g){var f=Object.clone(m);var a=m.objectKeyPath.length;m.objectKeyPath.push(this);for(h in g){var b=g[h];b.observeChangeForKeyPath(f,p)}m.objectKeyPath.length=a}if(coherent.KVO.kAllPropertiesKey==p){return}g=this.__observers[p];if(g&&g.length){k=g.length;for(h=0;h<k;++h){g[h].observeChangeForKeyPath(m,p)}}var d=p+".";var l=d.length;var n;var q;var u;var t;var c;var r=!(null===m.oldValue||"undefined"===typeof(m.oldValue));for(q in this.__observers){if(q.substr(0,l)!=d){continue}g=this.__observers[q];if(!g||!g.length){continue}n=q.substr(l);t=m.oldValue;if(t&&t.valueForKeyPath){t=t.valueForKeyPath(n)}else{t=null}c=m.newValue;if(c&&c.valueForKeyPath){c=c.valueForKeyPath(n)}else{c=null}if(r&&t===c){continue}u=new coherent.ChangeNotification(m.object,m.changeType,c,t,m.indexes);k=g.length;for(h=0;h<k;++h){g[h].observeChangeForKeyPath(u,q)}}},toJSON:function(a){var b={};this.mutableKeys().forEach(function(c){b[c]=this[c]},this);return b}});coherent.KVO.kAllPropertiesKey="*";coherent.KVO.keysToIgnore=$S("__keys","__observers","__keysToIgnore","__dependentKeys","__mutableKeys","__factories__");coherent.KVO.typesOfKeyValuesToIgnore=$S("string","number","boolean","date","regexp","function");coherent.KVO.getPropertyMethodsForKeyOnObject=(function(){function b(k,g){g=g||"__kvo_prop_"+k;var h={getter:function(){var l=null;if(g in this){l=this[g]}var m=this.__keys?this.__keys[k]:null;if(!m){return l}if(l&&l._addParentLink){l._addParentLink(this,m)}else{m.unlinkParentLink()}return l},mutator:function(l){this.willChangeValueForKey(k);if("undefined"===typeof(l)){l=null}this[g]=l;this.didChangeValueForKey(k);return l}};h.mutator.__key=k;h.getter.__key=k;return h}function c(k,h){function g(m){this.willChangeValueForKey(h);var l=k.call(this,m);this.didChangeValueForKey(h);return l}g.__key=h;g.valueOf=function(){return k};g.toString=function(){return String(k)};return g}function d(g,k){function h(){var l=g.call(this);var m=this.__keys?this.__keys[k]:null;if(!m){return l}if(l&&l._addParentLink){l._addParentLink(this,m)}else{m.unlinkParentLink()}return l}h.__key=k;h.valueOf=function(){return g};h.toString=function(){return String(g)};return h}function f(x,n){var p=n.constructor.prototype;var m=(p==n);var o=(p!=Object.prototype&&p!=Array.prototype&&p!=coherent.KVO.prototype)?p:n;var y=x.titleCase();var t="get"+y;var u="set"+y;var l="validate"+y;var r;var k;var w;var g=n[l];var q=("undefined"!==typeof(r=n.__lookupGetter__(x))&&"undefined"!==typeof(k=n.__lookupSetter__(x)));if(!q){t=(t in n)?t:x;r=n[t];k=n[u]}if("function"!==typeof(r)){var v="__kvo_prop_"+x;var h=b(x,v);if(x in n){w=n[v]=("undefined"==typeof(r)?null:r);delete n[x]}r=h.getter;k=h.mutator;q=true}else{if(0!==r.length){r=null}if(k&&1!==k.length){k=null}if(r&&!m){w=r.valueOf().call(n)}if(r&&x!==r.__key){r=d(r,x)}if(k&&x!==k.__key){k=c(k,x)}}if(q){o.__defineGetter__(x,r);o.__defineSetter__(x,k)}else{if(r){if(n.hasOwnProperty(t)){n[t]=r}else{o[t]=r}}if(k){if(n.hasOwnProperty(u)){n[u]=k}else{o[u]=k}}}return{getter:r,mutator:k,validator:g,value:w}}function a(u,m){var o=m.constructor.prototype;var l=(o==m);var n=(o!=Object.prototype&&o!=Array.prototype&&o!=coherent.KVO.prototype)?o:m;var v=u.titleCase();var r="set"+v;var q="get"+v;var k="validate"+v;q=(q in m)?q:u;var p=m[q];var h=m[r];var g=m[k];var t;if("function"!==typeof(p)){if(u in m){t=p}p=null;h=null}else{if(0!==p.length){p=null}if(h&&1!==h.length){h=null}if(p&&!l){t=p.valueOf().call(m)}if(p&&u!==p.__key){p=d(p,u)}if(h&&u!==h.__key){h=c(h,u)}}if(p){if(m.hasOwnProperty(q)){m[q]=p}else{n[q]=p}}if(h){if(m.hasOwnProperty(r)){m[r]=h}else{n[r]=h}}return{getter:p,mutator:h,validator:g,value:t}}if(coherent.Support.Properties){return f}else{return a}})();coherent.KVO.adapt=function(c){if(!c){throw new InvalidArgumentError("Can't adapt a null object")}var b;var a=coherent.KVO.prototype;for(b in a){if(b in c){continue}c[b]=a[b]}if("keyDependencies" in c&&!("__dependentKeys" in c)){var d=c.keyDependencies;for(b in d){c.setKeysTriggerChangeNotificationsForDependentKey(d[b],b)}}return c};coherent.KVO.adaptTree=function(d){coherent.KVO.adapt(d);var c;var a;var f=coherent.KVO.keysToIgnore;var b=coherent.KVO.typesOfKeyValuesToIgnore;for(c in d){if(f[c]){continue}a=d[c];if(!a){continue}if(b[coherent.typeOf(a)]){continue}coherent.KVO.adaptTree(a)}return d};coherent.KVO.unadaptTree=function(c){var a,b=coherent.typeOf(c);switch(b){case"object":a={};break;case"array":a=[];break;default:return c}if(!c.mutableKeys){return c}c.mutableKeys().forEach(function(d){a[d]=coherent.KVO.unadaptTree(c[d])});return a};coherent.KVO.__subclassCreated__=function(a){var d=a.superclass.prototype;var b=a.prototype;if(d.keyDependencies===b.keyDependencies){return}var f=b.keyDependencies||{};for(var c in f){b.setKeysTriggerChangeNotificationsForDependentKey(f[c],c)}};coherent.Bindable=Class.create(coherent.KVO,{constructor:function(a){this.bindings={};this.__parameters=a;this.__context=coherent.dataModel},__createFactoryObjects:function(){var a=coherent.dataModel;var c=this.__context;coherent.dataModel=this.__context=this;var d;var b;for(d in this.__factories__){b=this[d];if(!b.__factoryFn__){continue}this[d]=b.call(this)}coherent.dataModel=a;this.__context=c},exposedBindings:[],automaticallySetupBindings:true,__relativeSource:null,__relativeSourceKeyPathPattern:/(\$|^)(\*.)(.+)/,__relativeSourceKeyPathFormat:"$1$3",bindNameToKeyPath:function(b,g,a){var c;var f;var d=this;if(!this.bindings){this.bindings={}}c=this["observe"+b.titleCase()+"Change"];if(!c){c=function(k){if(coherent.ChangeType.setting!==k.changeType){throw new InvalidArgumentError('Received invalid change type for synthesized binding observer (name="'+b+'" keyPath="'+g+'")')}var h=k.newValue;d.setValueForKey(k.newValue,b)}}if(this.bindings[b]){this.bindings[b].unbind()}if(this.__relativeSourceKeyPathPattern.test(g)){f=coherent.Binding.bindingFromString(g.replace(this.__relativeSourceKeyPathPattern,this.__relativeSourceKeyPathFormat),a)}else{f=coherent.Binding.bindingFromString(g,this.__context)}f.observerFn=c.bind(this);this.bindings[b]=f},__postConstruct:function(){if(!this.automaticallySetupBindings){return}this.__initialising=true;this.__copyParameters(this.__parameters||{});this.setupBindings();this.updateBindings();this.createObservers();delete this.__initialising},__copyParameters:function(c){var d;var a;var b=coherent.KVO.adaptTree;for(d in c){if(-1!==d.search(/Binding$/)){continue}a=c[d];if("object"===coherent.typeOf(a)&&!("addObserverForKeyPath" in a)){b(a)}this[d]=a}this.__parameters=c},bindingInfoForName:function(a){if(!this.__parameters){return null}return this.__parameters[a+"Binding"]||this.__parameters[a]},__createAutoObserver:function(c,b){var a=coherent.ChangeType.setting;return function(d){if(this.bindings[b]||a==d.changeType){return}c.apply(this,arguments)}},createObservers:function(){var f=this.exposedBindings;var a=f.length;var b;var d;var c;for(b=0;b<a;++b){c=f[b];d=this["observe"+c.titleCase()+"Change"];if(!d){continue}d=this.__createAutoObserver(d,c);this.addObserverForKeyPath(this,d,c,"__auto_observer__")}},setupBindings:function(){var f=this.exposedBindings;var c=f.length;var g;var a;var d;for(d=0;d<c;++d){a=f[d];g=this.bindingInfoForName(a);if(!g){continue}this.bindNameToKeyPath(a,g,this.__relativeSource)}},updateBindings:function(){var g=this.bindings;var f=this.exposedBindings;var c=f.length;var a;var d;for(d=0;d<c;++d){a=g[f[d]];if(!a){continue}a.update()}},unbind:function(){for(var a in this.bindings){this.bindings[a].unbind()}}});coherent.Bindable.__subclassCreated__=function(a){var c=a.superclass.prototype;var b=a.prototype;if(c.exposedBindings===b.exposedBindings){return}b.exposedBindings=c.exposedBindings.concat(b.exposedBindings)};coherent.SortDescriptor=Class.create({constructor:function(d,a,b){this.keyPath=d;this.ascending=a;this.comparisonFn=b||this.defaultCompare;var c=typeof(this.comparisonFn);if("string"!=c&&"function"!=c){throw new InvalidArgumentError("comparisonFn must be either the name of a method or a function reference")}},resolveComparisonFn:function(b){var a=this.comparisonFn;if("string"===typeof(a)){a=b[a]}if("function"!==typeof(a)){throw new TypeError("comparisonFn does not resolve to a function")}return a},compareObjects:function(c,b){if(!c.valueForKeyPath||!b.valueForKeyPath){throw new InvalidArgumentError("Objects are not Key Value compliant")}var f=c.valueForKeyPath(this.keyPath);var d=b.valueForKeyPath(this.keyPath);var a=this.resolveComparisonFn(f);return a.call(f,d)},defaultCompare:function(a){return coherent.compareValues(this,a)},reversedSortDescriptor:function(){return new coherent.SortDescriptor(this.keyPath,!this.ascending,this.comparisonFn)}});coherent.Controller=Class.create(coherent.Bindable,{constructor:function(a){this.base(a)},registerWithName:function(a){if(!a){return}this.name=a;coherent.registerModelWithName(this,a)}});coherent.Markers={MultipleValues:"ThisIsAnUniqueStringThatRepresentsMultipleValues",NoSelection:"ThisIsAnUniqueStringThatRepresentsNoSelection"};coherent.SelectionProxy=Class.create(coherent.KVO,{constructor:function(a){this.controller=a;this.mutable=true},infoForKey:function(b){var a=this.controller.selectedObjects();var c=a.infoForKey(b);c.mutable&=this.mutable;return c},infoForKeyPath:function(c){var a=this.controller.selectedObjects();var b=a.infoForKeyPath(c);b.mutable&=this.mutable;return b},translateValue:function(d){if("array"!==coherent.typeOf(d)){return d}if(1===d.length){return d[0]}var c;var a;var b=d[0];for(c=1,a=d.length;c<a;++c){if(0!==coherent.compareValues(b,d[c])){return coherent.Markers.MultipleValues}}return b},valueForKey:function(c){var b=this.controller.selectedObjects();if(0===b.length){return coherent.Markers.NoSelection}var a=b.valueForKey(c);return this.translateValue(a)},validateValueForKeyPath:function(f,g){var b=this.controller.selectedObjects();var a=b.length;var d;if(0===a){return f}var c;for(d=0;d<a;++d){c=b[d].validateValueForKeyPath(f,g);if(c instanceof coherent.Error){return c}}return c},valueForKeyPath:function(c){var b=this.controller.selectedObjects();if(0===b.length){return coherent.Markers.NoSelection}var a=b.valueForKeyPath(c);return this.translateValue(a)},setValueForKey:function(d,c){if(!this.mutable){return}var b=this.controller.selectedObjects();var a=this.valueForKey(c);b.setValueForKey(d,c);var f=this.valueForKey(c);if(a===f){return}var g=new coherent.ChangeNotification(this,coherent.ChangeType.setting,f,a);this.notifyObserversOfChangeForKeyPath(g,c)},setValueForKeyPath:function(c,g){if(!this.mutable){return}var b=this.controller.selectedObjects();var a=this.valueForKeyPath(g);b.setValueForKeyPath(c,g);var d=this.valueForKeyPath(g);if(a===d){return}var f=new coherent.ChangeNotification(this,coherent.ChangeType.setting,d,a);this.notifyObserversOfChangeForKeyPath(f,g)}});coherent.ObjectController=Class.create(coherent.Controller,{constructor:function(a){this.base(a);this.objectClass=coherent.KVO;this.__content=null;this.__editable=true;this.__selectedObjects=[];this.__selection=new coherent.SelectionProxy(this)},observeChildObjectChangeForKeyPath:function(g,f,b){this.base(g,f,b);if("selectedObjects"!==b){return}var c="selection."+f;var d=this.valueForKeyPath(c);var a=new coherent.ChangeNotification(this,coherent.ChangeType.setting,d,null);this.notifyObserversOfChangeForKeyPath(a,c)},keyDependencies:{},exposedBindings:["editable","content"],editable:function(){var a=this.__editable;if(this.bindings.content){a&=this.bindings.content.mutable()}return a},setEditable:function(a){if(this.bindings.content){a&=this.bindings.content.mutable()}if(this.bindings.editable){this.bingings.editable.setValue(a)}this.__editable=a},content:function(){return this.__content},setContent:function(a){if(this.bindings.content){this.bindings.content.setValue(a)}this.__content=a;this.willChangeValueForKey("selectedObjects");if(!a){this.__selectedObjects=[]}else{this.__selectedObjects=[a]}this.didChangeValueForKey("selectedObjects");this.forceChangeNotificationForKey("selection")},selectedObjects:function(){return this.__selectedObjects},selection:function(){return this.__selection}});window.XHR=(function(){var getTransport=function(){throw new Error("XMLHttpRequest not available.")};if(!coherent.Browser.IE){getTransport=function(){return new XMLHttpRequest()}}else{var progIdCandidates=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"];var len=progIdCandidates.length;var progId;var xhr;for(var i=0;i<len;++i){try{progId=progIdCandidates[i];xhr=new ActiveXObject(progId);getTransport=function(){return new ActiveXObject(progId)};break}catch(e){}}}function send(url,method,options){function noop(){}function cancel(){xhr.onreadystatechange=noop;xhr.abort()}function readyStateChanged(){if(4!==xhr.readyState){return}if(xhrSent===false){arguments.callee.delay(0);return}var status=xhr.status;var succeeded=(status>=200&&status<300)||304==status;if(0===status||"undefined"===typeof(status)){var protocol=window.location.protocol;succeeded="file:"===protocol||"chrome:"===protocol}var result=xhr.responseText;var err;if(succeeded){if("HEAD"==method){result={};try{var headers=xhr.getAllResponseHeaders();if(headers){headers=headers.split("\n");headers.forEach(function(header){var match=header.match(/^([^:]+):(.+)$/m);var name=match[1].trim();result[name]=match[2].trim()})}}catch(e){}}else{var contentType=options.responseContentType||xhr.getResponseHeader("Content-Type");if(contentType.match(/(?:application\/(?:x-)?json)|(?:text\/json)/)){try{result=eval("("+result+")")}catch(e){err=e;succeeded=false}}if(contentType.match(/(?:application|text)\/xml/)){result=xhr.responseXML}}}else{err=new Error("XHR request failed");err.url=url;err.method=method;err.xhr=xhr;try{err.status=xhr.status;err.statusText=xhr.statusText}catch(e){err.status=0;err.statusText=null}}if(succeeded){deferred.callback(result)}else{deferred.failure(err)}xhr.onreadystatechange=noop;xhr=null}var urlArgs=(url||"").split("?");if(2==urlArgs.length){url=urlArgs[0];urlArgs=Object.fromQueryString(urlArgs[1])}else{urlArgs={}}var xhr=getTransport();var args=Object.applyDefaults(options.parameters||{},urlArgs);var queryString=Object.toQueryString(args);var body=options.body||"";var async=!options.sync;var deferred=new coherent.Deferred(cancel);var xhrSent=false;method=(method||"GET").toUpperCase();if("GET"==method){url=url+"?"+queryString}if(options.user){xhr.open(method,url,async,options.user,options.password||"")}else{xhr.open(method,url,async)}var headers=options.headers||{};for(var h in headers){xhr.setRequestHeader(h,headers[h])}xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");if("POST"==method){xhr.setRequestHeader("Content-Type",options.contentType||"application/x-www-form-urlencoded");body=body||queryString}if(async){xhr.onreadystatechange=readyStateChanged}xhr.send(body);xhrSent=true;if(!async){readyStateChanged()}return deferred}return{get:function(url,parameters,options){return XHR.request("GET",url,parameters,options)},post:function(url,parameters,options){return XHR.request("POST",url,parameters,options)},request:function(method,url,parameters,options){method=method.toUpperCase();options=options||{};options.parameters=parameters;return send(url,method,options)}}})();coherent.AjaxController=Class.create(coherent.ObjectController,{exposedBindings:["url"],flushContentBeforeQuery:false,constructor:function(a){this.base(a);this.addObserverForKeyPath(this,this.queryUpdated,"url");this.addObserverForKeyPath(this,this.queryUpdated,"method");this.queryDelay=500;this.url="";this.method="GET";this.setValueForKey(new coherent.KVO(),"parameters")},validateParameters:function(){return true},observeChildObjectChangeForKeyPath:function(c,b,a){this.base(c,b,a);if("parameters"===a){this.queryUpdated(c,b,a)}},queryUpdated:function(c,b,a){if(!this.parameters||!this.validateParameters()){return}this.setValueForKey(true,"queryInProgress");if(this.__queryTimer){window.clearTimeout(this.__queryTimer)}this.__queryTimer=this.performQuery.bindAndDelay(this,this.queryDelay)},performQuery:function(){var f={};var d=this.parameters.mutableKeys();var a=d.length;var g;var b;for(var c=0;c<a;++c){g=d[c];if(!this.parameters.hasOwnProperty(g)){continue}b=this.parameters[g];if(""===b||null===b||"undefined"===typeof(b)){continue}f[g]=b}this.finalParameters(f);this.__request=XHR.get(this.url,f,{responseContentType:"application/json"});this.__request.addMethods(this.querySucceeded.bind(this),this.queryFailed.bind(this));if(this.flushContentBeforeQuery){this.setContent(null)}},finalParameters:function(a){return a},extractContent:function(a){return a},querySucceeded:function(a){coherent.KVO.adaptTree(a);this.setContent(this.extractContent(a));this.setValueForKey("","statusCode");this.setValueForKey("","errorMessage");this.setValueForKey(false,"queryInProgress")},queryFailed:function(a){console.log("failure: "+this.url);this.setValueForKey(a.status,"statusCode");this.setValueForKey(a.statusText,"errorMessage");this.setContent(null);this.setValueForKey(false,"queryInProgress")}});function IndexRange(c,a){var b;var d=[];if(1==arguments.length&&c.length){a=c.length-1;c=0}for(b=c;b<=a;++b){d.push(b)}return d}coherent.ArrayController=Class.create(coherent.ObjectController,{constructor:function(a){this.base(a);this.arrangedObjects=[];this.__sortDescriptors=[];this.__filterPredicate=null;this.__selectionIndexes=[]},keyDependencies:{selectedObjects:["selectionIndexes"],selectionIndex:["selectionIndexes"],canRemove:["editable","selectionIndexes"],canAdd:["editable"]},selectsInsertedObjects:true,exposedBindings:["selectionIndexes","sortDescriptors","filterPredicate","contentForMultipleSelection"],observeContentChange:function(d){var a;var c;switch(d.changeType){case coherent.ChangeType.setting:this.setContent(d.newValue);break;case coherent.ChangeType.insertion:this._insertObjectsIntoArrangedObjects(d.newValue);if(this.selectsInsertedObjects){var b=this.selectedObjects();b=b.concat(d.newValue);this.setSelectedObjects(b)}break;case coherent.ChangeType.deletion:this.rearrangeObjects();break;case coherent.ChangeType.replacement:this.rearrangeObjects();break;default:break}},canAdd:function(){return this.editable()},add:function(){var a=new (this.objectClass)();var b=this.content();b.addObject(a)},canRemove:function(){return this.editable()&&this.selectionIndexes().length},remove:function(){var a=this.selectedObjects();var b=this.content();b.removeObjects(a)},setContent:function(a){a=a||[];if(this.bindings.content){this.bindings.content.setValue(a)}this.__content=a;this.rearrangeObjects(a)},sortDescriptors:function(){return this.__sortDescriptors},setSortDescriptors:function(a){if(this.bindings.sortDescriptors){this.bindings.sortDescriptors.setValue(a)}this.__sortDescriptors=a;this.rearrangeObjects()},filterPredicate:function(){return this.__filterPredicate},setFilterPredicate:function(a){if(this.bindings.filterPredicate){this.bindings.filterPredicate.setValue(a)}this.__filterPredicate=a;this.rearrangeObjects()},filterObjects:function(f){var g=this.filterPredicate();if(!g){return IndexRange(f)}var c=[];var d;var a;var b;for(d=0,a=f.length;d<a;++d){b=f[d];if(g(b)){c.push(d)}}return c},_compareObjects:function(g,f){var d;var b;var c=this.sortDescriptors();var a=c.length;for(d=0;d<a;++d){b=c[d].compareObjects(g,f);if(!c[d].ascending){b*=-1}if(0!==b){return b>0?1:-1}}return 0},sortObjects:function(d,b){b=b||IndexRange(d);var c=this.sortDescriptors();var f=c.length;function a(p,o){var l;var h;var n=d[p];var m=d[o];var g=f;var k=c;for(l=0;l<g;++l){h=k[l].compareObjects(n,m);if(!k[l].ascending){h*=-1}if(0!==h){return h}}return 0}if(0!==c.length){b.sort(a)}return b},arrangeObjects:function(f){var c=this.filterObjects(f);c=this.sortObjects(f,c);if(f===this.content()){var d=[];var a=c.length;for(var b=0;b<a;++b){d[c[b]]=b}this.__contentToArrangedMap=d;this.__arrangedToContentMap=c}return f.objectsAtIndexes(c)},rearrangeObjects:function(d){var h=d||this.content()||[];var c=this.arrangeObjects(h);var b=this.selectedObjects();var f=[];var a=b.length;var k;var g;for(g=0;g<a;++g){k=c.indexOf(b[g]);if(-1!==k){f.push(k)}}this.setValueForKey(c,"arrangedObjects");this.setValueForKey(f,"selectionIndexes")},_insertObjectsIntoArrangedObjects:function(a){var k=this.arrangeObjects(a);var m=k.length;var b=this.arrangedObjects;var g=b.length;var h=[];var l=0;var d;var c;var f;h.length=m;for(f=0;f<m;++f){d=k[f];while(l<g){c=b[l];if(-1===this._compareObjects(d,c)){break}++l}h[f]=l+f}b.insertObjectsAtIndexes(k,h)},selectedObjects:function(){return this.__selectedObjects},setSelectedObjects:function(b){var c=[];var f;var d;var a=this.arrangedObjects;for(f=0;f<b.length;++f){d=a.indexOf(b[f]);if(-1===d){continue}c.push(d)}return this.setSelectionIndexes(c)},selectionIndexes:function(){return this.__selectionIndexes},setSelectionIndexes:function(b){b=b||[];b.sort();if(0===(this.selectionIndexes()||[]).compare(b)){return false}if(this.bindings.selectionIndexes){this.bindings.selectionIndexes.setValue(b)}this.__selectionIndexes=b;var a=this.arrangedObjects;this.__selectedObjects=a.objectsAtIndexes(b);this.forceChangeNotificationForKey("selection");return true},setSelectionIndex:function(b){var a=this.setSelectionIndexes([b]);return a},selectionIndex:function(){var a=this.selectionIndexes();if(0===a.length){return -1}return a[0]}});coherent.ModelController=Class.create(coherent.Controller,{constructor:function(b,a){if(!("addObserverForKeyPath" in b)){coherent.KVO.adaptTree(b)}function c(d){this.setValueForKey(b[d],d)}b.mutableKeys().forEach(c,this);this.base(a)}});Object.extend(coherent,{dataModel:new coherent.KVO(),registerModelWithName:function(b,a){coherent.dataModel.setValueForKey(b,a)},unregisterModelWithName:function(a){delete coherent.dataModel[a]}});coherent.ValueTransformer=Class.create({transformedValue:function(a){return a},reverseTransformedValue:function(a){return a},__factory__:function(){var b=Array.from(arguments);var a=this;function c(){}return function(){c.prototype=a.prototype;var d=new c();a.prototype.constructor.apply(d,b);return d}}});coherent.ValueTransformer.__subclassCreated__=function(a){var c=coherent.ValueTransformer.prototype;var b=a.prototype;if(c.reverseTransformedValue==b.reverseTransformedValue){a.prototype.reverseTransformedValue=null}};coherent.transformer={};coherent.transformerInstances={};coherent.findTransformerWithName=function(transformerName){var valueTransformer=coherent.transformerInstances[transformerName.toLowerCase()];if(valueTransformer){return valueTransformer}if(-1===transformerName.indexOf(".")){valueTransformer=coherent.transformer[transformerName]}else{try{valueTransformer=eval(transformerName)}catch(e){}}valueTransformer=valueTransformer&&new valueTransformer();if(valueTransformer){return valueTransformer}throw new InvalidArgumentError("The transformerName argument does not specify a valid ValueTransformer: "+transformerName)};coherent.registerTransformerWithName=function(b,a){if(!b.transformedValue){throw new InvalidArgumentError("The valueTransformer argument does not support the ValueTransformer method transformedValue")}a=a.toLowerCase();coherent.transformerInstances[a]=b};coherent.transformer.Not=Class.create(coherent.ValueTransformer,{transformedValue:function(a){return(a?false:true)},reverseTransformedValue:function(a){return !!a}});coherent.registerTransformerWithName(new coherent.transformer.Not(),"not");coherent.transformer.Boolean=Class.create(coherent.ValueTransformer,{constructor:function(a,b){this.trueValue=a;this.falseValue=b},transformedValue:function(a){return(a==this.trueValue)},reverseTransformedValue:function(a){return(a?this.trueValue:this.falseValue)}});coherent.transformer.Matches=Class.create(coherent.ValueTransformer,{constructor:function(a){this.trueRegex=a},transformedValue:function(a){return this.trueRegex.test(a)}});coherent.transformer.Generic=Class.create(coherent.ValueTransformer,{constructor:function(a,b){this.modelValues=a;this.displayValues=b},transformedValue:function(b){var a=this.modelValues.indexOf(b);var c;if(-1==a){return c}else{return this.displayValues[a]}},reverseTransformedValue:function(b){var a=this.displayValues.indexOf(b);var c;if(-1==a){return c}else{return this.modelValues[a]}}});coherent.transformer.Truncated=Class.create(coherent.ValueTransformer,{constructor:function(a){this.max=a||50},ellipsis:String.fromCharCode(8230),transformedValue:function(a){if(a){return a.toString().truncate({from:"middle",length:this.max,omission:this.ellipsis})}else{return a}}});coherent.registerTransformerWithName(new coherent.transformer.Truncated(50),"truncated");coherent.transformer.StringsToObjects=Class.create(coherent.ValueTransformer,{constructor:function(a){this.key=a||"string"},transformedValue:function(b){if(!b||!b.map){return b}function a(c){var d=new coherent.KVO();d[this.key]=c;return d}return b.map(a,this)},reverseTransformedValue:function(b){if(!b||!b.map){return b}function a(c){return c[this.key]}return b.map(a,this)}});coherent.registerTransformerWithName(new coherent.transformer.StringsToObjects("string"),"StringsToObjects");coherent.transformer.ObjectToArray=Class.create(coherent.ValueTransformer,{transformedValue:function(d){var a=coherent.KVO.adapt([]);if(d){for(var c in d){var b=d[c].index;a[b]=d[c]}}return a}});coherent.registerTransformerWithName(new coherent.transformer.ObjectToArray(),"ObjectToArray");
/*!
 * Sizzle CSS Selector Engine - v1.0
 *  Copyright 2009, The Dojo Foundation
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://sizzlejs.com/
 */
/*!
 * ATTENTION: This file has been modified to remove all handling of XML
 */
(function(){var t=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?/g,l=0,d=Object.prototype.toString,n=Array.prototype.splice,p=Array.prototype.push,k=Array.prototype.sort;var b=function(A,w,D,E){D=D||[];var G=w=w||document;if(w.nodeType!==1&&w.nodeType!==9){return[]}if(!A||typeof A!=="string"){return D}var B=[],y,I,L,v,F,x,z=true;t.lastIndex=0;while((y=t.exec(A))!==null){B.push(y[1]);if(y[2]){x=RegExp.rightContext;break}}if(B.length>1&&m.exec(A)){if(B.length===2&&f.relative[B[0]]){I=g(B[0]+B[1],w)}else{I=f.relative[B[0]]?[w]:b(B.shift(),w);while(B.length){A=B.shift();if(f.relative[A]){A+=B.shift()}I=g(A,I)}}}else{if(!E&&B.length>1&&w.nodeType===9&&f.match.ID.test(B[0])&&!f.match.ID.test(B[B.length-1])){var H=b.find(B.shift(),w);w=H.expr?b.filter(H.expr,H.set)[0]:H.set[0]}if(w){var H=E?{expr:B.pop(),set:a(E)}:b.find(B.pop(),B.length===1&&(B[0]==="~"||B[0]==="+")&&w.parentNode?w.parentNode:w);I=H.expr?b.filter(H.expr,H.set):H.set;if(B.length>0){L=a(I)}else{z=false}while(B.length){var K=B.pop(),J=K;if(!f.relative[K]){K=""}else{J=B.pop()}if(J==null){J=w}f.relative[K](L,J)}}else{L=B=[]}}if(!L){L=I}if(!L){throw"Syntax error, unrecognized expression: "+(K||A)}if(d.call(L)==="[object Array]"){if(!z){p.apply(D,L)}else{if(w&&w.nodeType===1){for(var C=0;L[C]!=null;C++){if(L[C]&&(L[C]===true||L[C].nodeType===1&&h(w,L[C]))){p.call(D,I[C])}}}else{for(var C=0;L[C]!=null;C++){if(L[C]&&L[C].nodeType===1){p.call(D,I[C])}}}}}else{a(L,D)}if(x){b(x,G,D,E);b.uniqueSort(D)}return D};b.uniqueSort=function(w){if(c){hasDuplicate=false;k.call(w,c);if(hasDuplicate){for(var v=1;v<w.length;v++){if(w[v]===w[v-1]){n.call(w,v--,1)}}}}};b.matches=function(v,w){return b(v,null,null,w)};b.find=function(B,y){var C,w;if(!B){return[]}for(var x=0,v=f.order.length;x<v;x++){var z=f.order[x],w;if((w=f.match[z].exec(B))){var A=RegExp.leftContext;if(A.substr(A.length-1)!=="\\"){w[1]=(w[1]||"").replace(/\\/g,"");C=f.find[z](w,y);if(C!=null){B=B.replace(f.match[z],"");break}}}}if(!C){C=y.getElementsByTagName("*")}return{set:C,expr:B}};b.filter=function(E,D,H,y){var x=E,J=[],B=D,A,v;while(E&&D.length){for(var C in f.filter){if((A=f.match[C].exec(E))!=null){var w=f.filter[C],I,G;v=false;if(B==J){J=[]}if(f.preFilter[C]){A=f.preFilter[C](A,B,H,J,y);if(!A){v=I=true}else{if(A===true){continue}}}if(A){for(var z=0;(G=B[z])!=null;z++){if(G){I=w(G,A,z,B);var F=y^!!I;if(H&&I!=null){if(F){v=true}else{B[z]=false}}else{if(F){J.push(G);v=true}}}}}if(I!==undefined){if(!H){B=J}E=E.replace(f.match[C],"");if(!v){return[]}break}}}if(E==x){if(v==null){throw"Syntax error, unrecognized expression: "+E}else{break}}x=E}return B};var f=b.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF_-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF_-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF_-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF_-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*_-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF_-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(v){return v.getAttribute("href")}},relative:{"+":function(B,w){var y=typeof w==="string",A=y&&!/\W/.test(w),C=y&&!A;if(A){w=w.toUpperCase()}for(var x=0,v=B.length,z;x<v;x++){if((z=B[x])){while((z=z.previousSibling)&&z.nodeType!==1){}B[x]=C||z&&z.nodeName===w?z||false:z===w}}if(C){b.filter(w,B,true)}},">":function(B,w){var z=typeof w==="string";if(z&&!/\W/.test(w)){w=w.toUpperCase();for(var x=0,v=B.length;x<v;x++){var A=B[x];if(A){var y=A.parentNode;B[x]=y.nodeName===w?y:false}}}else{for(var x=0,v=B.length;x<v;x++){var A=B[x];if(A){B[x]=z?A.parentNode:A.parentNode===w}}if(z){b.filter(w,B,true)}}},"":function(y,w){var x=l++,v=u;if(!w.match(/\W/)){var z=w=w.toUpperCase();v=r}v("parentNode",w,x,y,z)},"~":function(y,w){var x=l++,v=u;if(typeof w==="string"&&!w.match(/\W/)){var z=w=w.toUpperCase();v=r}v("previousSibling",w,x,y,z)}},find:{ID:function(w,x){if(typeof x.getElementById!=="undefined"){var v=x.getElementById(w[1]);return v?[v]:[]}},NAME:function(x,A){if(typeof A.getElementsByName!=="undefined"){var w=[],z=A.getElementsByName(x[1]);for(var y=0,v=z.length;y<v;y++){if(z[y].getAttribute("name")===x[1]){w.push(z[y])}}return w.length===0?null:w}},TAG:function(v,w){return w.getElementsByTagName(v[1])}},preFilter:{CLASS:function(y,w,x,v,B){y=" "+y[1].replace(/\\/g,"")+" ";for(var z=0,A;(A=w[z])!=null;z++){if(A){if(B^(A.className&&(" "+A.className+" ").indexOf(y)>=0)){if(!x){v.push(A)}}else{if(x){w[z]=false}}}}return false},ID:function(v){return v[1].replace(/\\/g,"")},TAG:function(w,v){return w[1].toUpperCase()},CHILD:function(v){if(v[1]=="nth"){var w=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(v[2]=="even"&&"2n"||v[2]=="odd"&&"2n+1"||!/\D/.test(v[2])&&"0n+"+v[2]||v[2]);v[2]=(w[1]+(w[2]||1))-0;v[3]=w[3]-0}v[0]=l++;return v},ATTR:function(z,w,x,v,A){var y=z[1].replace(/\\/g,"");if(f.attrMap[y]){z[1]=f.attrMap[y]}if(z[2]==="~="){z[4]=" "+z[4]+" "}return z},PSEUDO:function(z,w,x,v,A){if(z[1]==="not"){if(z[3].match(t).length>1||/^\w/.test(z[3])){z[3]=b(z[3],null,null,w)}else{var y=b.filter(z[3],w,x,true^A);if(!x){v.push.apply(v,y)}return false}}else{if(f.match.POS.test(z[0])||f.match.CHILD.test(z[0])){return true}}return z},POS:function(v){v.unshift(true);return v}},filters:{enabled:function(v){return v.disabled===false&&v.type!=="hidden"},disabled:function(v){return v.disabled===true},checked:function(v){return v.checked===true},selected:function(v){v.parentNode.selectedIndex;return v.selected===true},parent:function(v){return !!v.firstChild},empty:function(v){return !v.firstChild},has:function(x,w,v){return !!b(v[3],x).length},header:function(v){return/h\d/i.test(v.nodeName)},text:function(v){return"text"===v.type},radio:function(v){return"radio"===v.type},checkbox:function(v){return"checkbox"===v.type},file:function(v){return"file"===v.type},password:function(v){return"password"===v.type},submit:function(v){return"submit"===v.type},image:function(v){return"image"===v.type},reset:function(v){return"reset"===v.type},button:function(v){return"button"===v.type||v.nodeName.toUpperCase()==="BUTTON"},input:function(v){return/input|select|textarea|button/i.test(v.nodeName)}},setFilters:{first:function(w,v){return v===0},last:function(x,w,v,y){return w===y.length-1},even:function(w,v){return v%2===0},odd:function(w,v){return v%2===1},lt:function(x,w,v){return w<v[3]-0},gt:function(x,w,v){return w>v[3]-0},nth:function(x,w,v){return v[3]-0==w},eq:function(x,w,v){return v[3]-0==w}},filter:{PSEUDO:function(B,x,y,C){var w=x[1],z=f.filters[w];if(z){return z(B,y,x,C)}else{if(w==="contains"){return(B.textContent||B.innerText||"").indexOf(x[3])>=0}else{if(w==="not"){var A=x[3];for(var y=0,v=A.length;y<v;y++){if(A[y]===B){return false}}return true}}}},CHILD:function(v,y){var B=y[1],w=v;switch(B){case"only":case"first":while(w=w.previousSibling){if(w.nodeType===1){return false}}if(B=="first"){return true}w=v;case"last":while(w=w.nextSibling){if(w.nodeType===1){return false}}return true;case"nth":var x=y[2],E=y[3];if(x==1&&E==0){return true}var A=y[0],D=v.parentNode;if(D&&(D.sizcache!==A||!v.nodeIndex)){var z=0;for(w=D.firstChild;w;w=w.nextSibling){if(w.nodeType===1){w.nodeIndex=++z}}D.sizcache=A}var C=v.nodeIndex-E;if(x==0){return C==0}else{return(C%x==0&&C/x>=0)}}},ID:function(w,v){return w.nodeType===1&&w.getAttribute("id")===v},TAG:function(w,v){return(v==="*"&&w.nodeType===1)||w.nodeName===v},CLASS:function(w,v){return(" "+(w.className||w.getAttribute("class"))+" ").indexOf(v)>-1},ATTR:function(A,y){var x=y[1],v=f.attrHandle[x]?f.attrHandle[x](A):A[x]!=null?A[x]:A.getAttribute(x),B=v+"",z=y[2],w=y[4];return v==null?z==="!=":z==="="?B===w:z==="*="?B.indexOf(w)>=0:z==="~="?(" "+B+" ").indexOf(w)>=0:!w?B&&v!==false:z==="!="?B!=w:z==="^="?B.indexOf(w)===0:z==="$="?B.substr(B.length-w.length)===w:z==="|="?B===w||B.substr(0,w.length+1)===w+"-":false},POS:function(z,w,x,A){var v=w[2],y=f.setFilters[v];if(y){return y(z,x,w,A)}}}};var m=f.match.POS;for(var q in f.match){f.match[q]=new RegExp(f.match[q].source+/(?![^\[]*\])(?![^\(]*\))/.source)}var a=function(w,v){w=Array.prototype.slice.call(w);if(v){p.apply(v,w);return v}return w};try{Array.prototype.slice.call(document.documentElement.childNodes)}catch(o){a=function(z,y){var w=y||[];if(d.call(z)==="[object Array]"){Array.prototype.push.apply(w,z)}else{if(typeof z.length==="number"){for(var x=0,v=z.length;x<v;x++){w.push(z[x])}}else{for(var x=0;z[x];x++){w.push(z[x])}}}return w}}var c;if(document.documentElement.compareDocumentPosition){c=function(w,v){var x=w.compareDocumentPosition(v)&4?-1:w===v?0:1;if(x===0){hasDuplicate=true}return x}}else{if("sourceIndex" in document.documentElement){c=function(w,v){var x=w.sourceIndex-v.sourceIndex;if(x===0){hasDuplicate=true}return x}}else{if(document.createRange){c=function(y,w){var x=y.ownerDocument.createRange(),v=w.ownerDocument.createRange();x.selectNode(y);x.collapse(true);v.selectNode(w);v.collapse(true);var z=x.compareBoundaryPoints(Range.START_TO_END,v);if(z===0){hasDuplicate=true}return z}}}}(function(){var w=document.createElement("form"),x="script"+(new Date).getTime();w.innerHTML="<input name='"+x+"'/>";var v=document.documentElement;v.insertBefore(w,v.firstChild);if(!!document.getElementById(x)){f.find.ID=function(z,A){if(typeof A.getElementById!=="undefined"){var y=A.getElementById(z[1]);return y?y.id===z[1]||typeof y.getAttributeNode!=="undefined"&&y.getAttributeNode("id").nodeValue===z[1]?[y]:undefined:[]}};f.filter.ID=function(A,y){var z=typeof A.getAttributeNode!=="undefined"&&A.getAttributeNode("id");return A.nodeType===1&&z&&z.nodeValue===y}}v.removeChild(w)})();(function(){var v=document.createElement("div");v.appendChild(document.createComment(""));if(v.getElementsByTagName("*").length>0){f.find.TAG=function(w,A){var z=A.getElementsByTagName(w[1]);if(w[1]==="*"){var y=[];for(var x=0;z[x];x++){if(z[x].nodeType===1){y.push(z[x])}}z=y}return z}}v.innerHTML="<a href='#'></a>";if(v.firstChild&&typeof v.firstChild.getAttribute!=="undefined"&&v.firstChild.getAttribute("href")!=="#"){f.attrHandle.href=function(w){return w.getAttribute("href",2)}}})();if(document.querySelectorAll){(function(){var v=b,x=document.createElement("div");x.innerHTML="<p class='TEST'></p>";if(x.querySelectorAll&&x.querySelectorAll(".TEST").length===0){return}b=function(B,A,y,z){A=A||document;if(!z&&A.nodeType===9){try{return a(A.querySelectorAll(B),y)}catch(C){}}return v(B,A,y,z)};for(var w in v){b[w]=v[w]}})()}if(document.getElementsByClassName&&document.documentElement.getElementsByClassName){(function(){var v=document.createElement("div");v.innerHTML="<div class='test e'></div><div class='test'></div>";if(v.getElementsByClassName("e").length===0){return}v.lastChild.className="e";if(v.getElementsByClassName("e").length===1){return}f.order.splice(1,0,"CLASS");f.find.CLASS=function(w,x){if(typeof x.getElementsByClassName!=="undefined"){return x.getElementsByClassName(w[1])}}})()}function r(w,B,A,E,C){var D=w=="previousSibling";for(var y=0,x=E.length;y<x;y++){var v=E[y];if(v){if(D&&v.nodeType===1){v.sizcache=A;v.sizset=y}v=v[w];var z=false;while(v){if(v.sizcache===A){z=E[v.sizset];break}if(v.nodeType===1){v.sizcache=A;v.sizset=y}if(v.nodeName===B){z=v;break}v=v[w]}E[y]=z}}}function u(w,B,A,E,C){var D=w=="previousSibling";for(var y=0,x=E.length;y<x;y++){var v=E[y];if(v){if(D&&v.nodeType===1){v.sizcache=A;v.sizset=y}v=v[w];var z=false;while(v){if(v.sizcache===A){z=E[v.sizset];break}if(v.nodeType===1){v.sizcache=A;v.sizset=y;if(typeof B!=="string"){if(v===B){z=true;break}}else{if(b.filter(B,[v]).length>0){z=v;break}}}v=v[w]}E[y]=z}}}var h=document.compareDocumentPosition?function(w,v){return w.compareDocumentPosition(v)&16}:function(w,v){return w!==v&&(w.contains?w.contains(v):true)};var g=function(v,C){var y=[],z="",A,x=C.nodeType?[C]:C;while((A=f.match.PSEUDO.exec(v))){z+=A[0];v=v.replace(f.match.PSEUDO,"")}v=f.relative[v]?v+"*":v;for(var B=0,w=x.length;B<w;B++){b(v,x[B],y)}return b.filter(z,y)};window.Sizzle=b})();(function(){var a=this.Element;this.Element={};Object.extend(this.Element,a||{})}).call(window);Object.extend(Element,{NodeType:{ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12},TABINDEX:"tabindex",uniqueId:function(){return"coherent_id_"+Element.assignId.uniqueId++},assignId:function(a){return a.id||(a.id=("coherent_id_"+Element.assignId.uniqueId++))},hasAttribute:function(b,a){return"hasAttribute" in b?b.hasAttribute(a):a in b.attributes&&typeof b.attributes[a]!=="undefined"},regexForClassName:function(b){var a=arguments.callee;if(!a._lookup){a._lookup={}}if(b in a._lookup){return a._lookup[b]}return(a._lookup[b]=new RegExp("(^|\\s)"+b+"(\\s|$)"))},hasClassName:function(a,b){var c=a.className;if(!c){return false}if(c==b){return true}return Element.regexForClassName(b).test(c)},addClassName:function(a,b){if(!b){return}if(Element.hasClassName(a,b)){return}a.className+=" "+b},removeClassName:function(a,b){if(!a||!b){return}var c=Element.regexForClassName(b);a.className=a.className.replace(c," ").trim()},replaceClassName:function(b,c,a){if(!c){return}if(!a){Element.removeClassName(b,c);return}var d=Element.regexForClassName(c);b.className=b.className.replace(d,"$1"+a+"$2").trim()},toggleClassName:function(a,b){if(!b){return}var c=Element.regexForClassName(b);var d=a.className;if(c.test(d)){a.className=d.replace(c," ").trim()}else{a.className+=" "+b}},updateClass:function(g,h,c){var f=$S(g.className.split(" "));var k=Set.add;var b=Set.remove;var d;var a;if("string"===typeof(h)){k(f,h)}else{for(d=0,a=h.length;d<a;++d){k(f,h[d])}}if("string"===typeof(c)){b(f,c)}else{for(d=0,a=c.length;d<a;++d){b(f,c[d])}}g.className=Set.join(f," ")},PROPERTIES:["backgroundColor","backgroundPosition","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","color","display","fontSize","letterSpacing","lineHeight","opacity","width","height","top","bottom","left","right","marginTop","marginRight","marginBottom","marginLeft","paddingTop","paddingRight","paddingBottom","paddingLeft"],getStyles:function(f,d){var g={};var b=window.getComputedStyle(f,null);if("string"===typeof(d)){return f.style[d]||b[d]||null}d=d||Element.PROPERTIES;var h;var a=d.length;for(var c=0;c<a;++c){h=d[c];g[h]=f.style[h]||b[h]||null}return g},setStyle:function(a,b,c){a.style[b]=c},setStyles:function(a,b){var c=a.style;for(var d in b){c[d]=b[d]}},isElement:function(a){return a.nodeType===Element.NodeType.ELEMENT},isVoidElement:function(a){var b=false;switch(a.tagName.toLowerCase()){case"area":case"base":case"br":case"col":case"command":case"embed":case"hr":case"img":case"input":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":b=true;break;default:break}return b},setInnerHTML:function(a,b){Element.innerHTML(a,b,false)},appendInnerHTML:function(a,b){Element.innerHTML(a,b,true)},innerHTML:function(d,f,b){var a=d.parentNode,c=a&&d.cloneNode(false);a&&a.replaceChild(c,d);f=String.stringify(f);if(b){d.innerHTML+=f.escapeForInnerHTML()}else{d.innerHTML=f.escapeForInnerHTML()}a&&a.replaceChild(d,c)},findDeepestFirstParentNode:function(f,d){var c=null;var b;var a;for(b=0,a=f.childNodes.length;b<a;b++){if((c=d(f.childNodes[b]))){break}}return c!==null?Element.findDeepestFirstParentNode(c,d):f},nonVoidElement:function(a){return Element.isElement(a)&&!Element.isVoidElement((a))&&(a)||null},setDeepestFirstElementInnerHTML:function(a,c){var b=Element.findDeepestFirstParentNode(a,Element.nonVoidElement);Element.innerHTML((b),c)},getDimensions:function(f){var h=Element.getStyle(f,"display");if(h&&h!="none"){return{left:f.offsetLeft,top:f.offsetTop,width:f.offsetWidth,height:f.offsetHeight}}var b=f.style;var g=b.visibility;var c=b.position;var a=b.display;b.visibility="hidden";b.position="absolute";b.display="block";var d={width:f.offsetWidth,height:f.offsetHeight,left:f.offsetLeft,top:f.offsetTop};b.display=a;b.position=c;b.visibility=g;return d},clone:function(a){return a.cloneNode(true)},depthFirstTraversal:function(d,f,c){if(!d||!f){return}var a=d.nextSibling||d.parentNode;var b;c=c||f;while(d!==a){if(1===d.nodeType){b=f.call(c,d);if(false!==b&&d.firstChild){d=d.firstChild;continue}}while(!d.nextSibling){d=d.parentNode;if(d===a){return}}d=d.nextSibling}},query:function(c,b){if(1==arguments.length){b=c;c=document}else{if(c!=document){b="#"+Element.assignId(c)+" "+b}}var a;try{a=c.querySelector(b)}catch(d){a=Sizzle(b,c)[0]||null}return a},queryAll:function(c,b){if(1==arguments.length){b=c;c=document}else{if(c!=document){b="#"+Element.assignId(c)+" "+b}}var a;try{a=Array.from(c.querySelectorAll(b))}catch(d){a=Sizzle(b,c)}return a},match:function(b,a){return Sizzle.matches(a,[b]).length==1},getViewport:function(){var c=["left","top","width","height"],d=c.length,b={},g=window,a,f;if(g.innerWidth){a=["pageXOffset","pageYOffset","innerWidth","innerHeight"]}else{a=["scrollLeft","scrollTop","clientWidth","clientHeight"];g=document.documentElement||document.body}for(f=0;f<d;f++){b[c[f]]=g[a[f]]}return b},scrollParent:function(d){var c;var b=Element.getStyles;var a=document.body;while(d&&d!=a){c=b(d,["overflow","overflowX","overflowY"]);if(("visible"!==c.overflowX||"visible"!==c.overflowY)||"visible"!==c.overflow){return d}d=d.parentNode}return d},getRect:function(t,q){if(!t){return null}var v=document.documentElement;var p=document.body;var d=0;var r=0;if(t!=document.body&&t.getBoundingClientRect){var o=t.getBoundingClientRect();o={left:o.left,right:o.right,top:o.top,bottom:o.bottom};if(!!q===false){o.left+=Math.max(v.scrollLeft,p.scrollLeft);o.right+=Math.max(v.scrollLeft,p.scrollLeft);o.top+=Math.max(v.scrollTop,p.scrollTop);o.bottom+=Math.max(v.scrollTop,p.scrollTop)}else{if(coherent.Browser.MobileSafari){o.top-=window.pageYOffset;o.bottom-=window.pageYOffset;o.left-=window.pageXOffset;o.right-=window.pageXOffset}}o.left-=v.clientLeft;o.right-=v.clientLeft;o.top-=v.clientTop;o.bottom-=v.clientTop;o.width=o.right-o.left;o.height=o.bottom-o.top;return o}var m=t.parentNode;var g=t;var a=t.offsetParent;var n=coherent.Browser.Mozilla;var u=coherent.Browser.Safari&&!coherent.Browser.Safari2;var b=coherent.Browser.Safari2;var k=Element.getStyles;var h=Element.getDimensions(t);var c=("fixed"===Element.getStyles(t,"position"));var l;d+=t.offsetLeft;r+=t.offsetTop;while(!c&&a){d+=a.offsetLeft;r+=a.offsetTop;if(n&&!((/^t(able|d|h)$/i).test(a.tagName))||u){l=k(a,["borderLeftWidth","borderTopWidth"]);d+=parseInt(l.borderLeftWidth||0,10);r+=parseInt(l.borderTopWidth||0,10)}if(!c){c=("fixed"===k(a,"position"))}if("BODY"!==a.tagName){g=a}a=a.offsetParent}var f=n?["display","overflow","borderLeftWidth","borderTopWidth"]:["display"];while(m&&m.tagName&&"BODY"!==m.tagName&&"HTML"!==m.tagName){l=k(m,f);if(!((/^inline|table.*$/i).test(l.display))){d-=m.scrollLeft;r-=m.scrollTop}if(n&&"visible"!=l.overflow){d+=parseInt(l.borderLeftWidth||0,10);r+=parseInt(l.borderTopWidth||0,10)}m=m.parentNode}var w=k(g,"position");if((b&&(c||w=="absolute"))||(n&&w!="absolute")){d-=p.offsetLeft;r-=p.offsetTop}if(q===true&&!c){d-=Math.max(window.pageXOffset,v.scrollLeft,p.scrollLeft);r-=Math.max(window.pageYOffset,v.scrollTop,p.scrollTop)}return{left:d,top:r,right:d+h.width-1,bottom:r+h.height-1,width:h.width,height:h.height}},offsetFromAncestor:function(b,a){var c=b&&b.offsetWidth&&{top:b.offsetTop,left:b.offsetLeft,width:b.offsetWidth,height:b.offsetHeight};a=c&&(a||document.body);while(a&&b&&a!==b){b=b.parentNode;c.top+=b.offsetTop;c.left+=b.offsetLeft}return c},locateAncestor:function(c,b,a){if(typeof b!="function"){throw new TypeError("Qualifier must be a function")}a=a||document.documentElement;while(c&&c!=a){if(b(c)){return c}c=c.parentNode}return null},scrollDocumentTopBy:function(a){document.documentElement.scrollTop=document.body.scrollTop=a},scrollDocumentLeftBy:function(a){document.documentElement.scrollLeft=document.body.scrollLeft=a},getDocumentScrollTop:function(){return document.documentElement.scrollTop||document.body.scrollTop},getDocumentScrollLeft:function(){return document.documentElement.scrollLeft||document.body.scrollLeft},isFixedPositionSupported:function(){var a=document.body;var g=4;var c=a.appendChild(document.createElement("DIV"));var k=c.appendChild(document.createElement("DIV"));var h=Element.getDocumentScrollTop();var f;var b;var d=true;if(a.getBoundingClientRect){c.style.cssText="position:relative;height:9999px;width:1px;";k.style.cssText="position:fixed;top:1px;width:1px;height:1px;";Element.scrollDocumentTopBy(0);f=k.getBoundingClientRect().top;Element.scrollDocumentTopBy(g);b=k.getBoundingClientRect().top;d=(f===b||b<0)&&Element.getDocumentScrollTop()===g;Element.scrollDocumentLeftBy(h)}a.removeChild(c);return d},hidden:function(a){return !Element.visible(a)},visible:function(b){var a=(b.offsetWidth>0||b.offsetHeight>0),c=(b.style&&b.style.display)!=="none";return a&&c},tabIndex:function(a){if(a.nodeType===Element.NodeType.ELEMENT||a.nodeType===Element.NodeType.DOCUMENT){var c=a.getAttributeNode(Element.TABINDEX),b=c?c.specified:false;return parseInt(b&&a.getAttribute(Element.TABINDEX),10)}},findFocusables:function(f,d,b){var a=[],g=0,h=(function(){if(typeof b==="boolean"){return b}else{if(typeof d==="boolean"){return d}else{return true}}})(),c=(function(){var k=d;if(typeof d==="string"){if(d.toLowerCase()==="first"){k=1}else{if(d.toLowerCase()==="last"){k=-1}}}return parseInt(k,10)})();Element.depthFirstTraversal(f,function(k){if(Element.tabIndex(k)||Element._findFocusables.isValidEl(k)){a.push({node:k,dfs:g++})}});if(h){a=a.filter(function(k){return Element.visible(k.node)&&(k.node.getAttribute(Element.TABINDEX)||0)>=0})}a=a.sort(function(l,k){var m=parseInt(l.node.getAttribute(Element.TABINDEX),10)||0,n=parseInt(k.node.getAttribute(Element.TABINDEX),10)||0;if(m===n){return l.dfs>k.dfs?1:-1}if(m>0&&n>0){return n<m?1:-1}return n>m?1:-1}).map(function(k){return k.node});if(c===-1){return a[a.length-1]}if(c===1){return a[0]}return a.slice(0,c||a.length)},_findFocusables:{validNodeNames:["A","INPUT","SELECT","BUTTON","TEXTAREA"],isValidEl:function(a){return Element._findFocusables.validNodeNames.some(function(b){return a.nodeName.toUpperCase()===b})}}});Element.getStyle=Element.getStyles;Element.assignId.uniqueId=1;if(!coherent.Support.QuerySelector){Object.extend(Element,{query:function(b,a){if(1==arguments.length){a=b;b=document}return(Sizzle(a,b)[0]||null)},queryAll:function(b,a){if(1==arguments.length){a=b;b=document}return(Sizzle(a,b)||null)}})}(function(){var a=this.Event;this.Event={};Object.extend(this.Event,a||{})}).call(window);Object.extend(Event,{KEY_BACKSPACE:8,KEY_TAB:9,KEY_CLEAR:12,KEY_RETURN:13,KEY_SHIFT:16,KEY_CTRL:17,KEY_ALT:18,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,KEY_CAPSLOCK:20,KEY_LEFTCOMMAND:91,KEY_RIGHTCOMMAND:93,KEY_MOZILLACOMMAND:224,KEY_RIGHTWINDOWSSTART:92,MOUSE_LEFT:1,MOUSE_RIGHT:3,shiftKey:false,_domHasFinishedLoading:function(){if(arguments.callee.done){return}arguments.callee.done=true;if(Event._domLoadedTimer){window.clearInterval(Event._domLoadedTimer)}var c=Event._readyCallbacks;var a=c.length;var b;for(b=0;b<a;++b){c[b]()}Event._readyCallbacks=null},observe:function(c,a,b){if("on"==a.slice(0,2)){a=a.slice(2)}c.addEventListener(a,b,false)},stopObserving:function(c,a,b){if("on"==a.slice(0,2)){a=a.slice(2)}c.removeEventListener(a,b,false)},stop:function(a){a.preventDefault();a.stopPropagation()},preventDefault:function(a){a.preventDefault()},onDomReady:function(a){if(Event._domHasFinishedLoading.done){window.setTimeout(a,0);return}if(!Event._readyCallbacks){document.addEventListener("DOMContentLoaded",Event._domHasFinishedLoading,false);function b(){if((/loaded|complete/).test(document.readyState)){Event._domHasFinishedLoading()}}if(coherent.Browser.Safari){Event._domLoadedTimer=window.setInterval(b,10)}Event.observe(window,"load",Event._domHasFinishedLoading);Event._readyCallbacks=[]}Event._readyCallbacks.push(a)},isModifiedKey:function(a){return !!(a.altKey||a.ctrlKey||a.metaKey)},isMetaKey:function(a){switch(a.keyCode){case this.KEY_TAB:case this.KEY_CLEAR:case this.KEY_RETURN:case this.KEY_SHIFT:case this.KEY_CTRL:case this.KEY_ALT:case this.KEY_ESC:case this.KEY_LEFT:case this.KEY_UP:case this.KEY_RIGHT:case this.KEY_DOWN:case this.KEY_HOME:case this.KEY_END:case this.KEY_PAGEUP:case this.KEY_PAGEDOWN:case this.KEY_INSERT:case this.KEY_CAPSLOCK:case this.KEY_LEFTCOMMAND:case this.KEY_RIGHTCOMMAND:case this.KEY_MOZILLACOMMAND:case this.KEY_RIGHTWINDOWSSTART:return true;break;default:break}return false}});coherent.PartFinder=(function(){function c(h,f){var k=h.length;var d=Array.from(f);function l(){h=[];d=null;k=0}function p(t){h.splice(t,1);if(d){d.splice(t,1)}k=h.length}function g(t){var v=Element.assignId(t);var u=h.indexOf(v);if(-1==u){return}h.splice(u,1);if(d){d.splice(u,1)}k=h.length}function r(v,u){var t=Element.assignId(v);h.splice(u,0,t);if(d){d.splice(u,0,v)}k=h.length}function q(t){h.push(Element.assignId(t));k=h.length;if(d){d.push(t)}}function n(){d=null}function m(){var v=[];var t;for(var u=0;u<k;++u){t=document.getElementById(h[u]);if(!t){continue}v.push(h[u])}h=v;k=v.length;d=null}function o(v){if(d){if(1==arguments.length){return d[v]}return d}if(1==arguments.length){return document.getElementById(h[v])}var t=[];for(var u=0;u<k;++u){t[u]=document.getElementById(h[u])}d=t;window.setTimeout(n,250);return t}if(f){window.setTimeout(n,250)}o.removePartAtIndex=p;o.removePart=g;o.insertPartAtIndex=r;o.add=q;o.removeAll=l;o.refresh=m;return o}function a(h,f){var d=f;function g(){d=null}function k(){if(d){return d}d=document.getElementById(h);window.setTimeout(g,250);return d}return k}function b(f,d){var g=Element.queryAll(f,d);var h=Array.map(g,Element.assignId);return{nodes:g,ids:h}}return{singlePart:function(f,d){function g(){var n=d;var h=typeof(n);if("function"===h){n=n()}else{if("string"===h){n=document.getElementById(n)}else{if(!n){n=this.viewElement()}}}var k=b(n,f);var m=a(k.ids[0],k.nodes[0]);var l=Class.findPropertyName(this,arguments.callee);if(l){this[l]=m}return k.nodes[0]}return g},multipleParts:function(f,d){function g(l){var o=d;var h=typeof(o);if("function"===h){o=o()}else{if("string"===h){o=document.getElementById(o)}else{if(!o){o=this.viewElement()}}}var k=b(o,f);var n=c(k.ids,k.nodes);var m=Class.findPropertyName(this,arguments.callee);if(m){this[m]=n}if(arguments.length){return k.nodes[l]}else{return Array.from(k.nodes)}}return g}}})();var Part=coherent.PartFinder.singlePart;var PartList=coherent.PartFinder.multipleParts;coherent.Style={kSelectedClass:"selected",kDisabledClass:"disabled",kReadOnlyClass:"read-only",kMarkerClass:"nullValue",kFocusClass:"focused",kHoverClass:"hover",kAscendingClass:"asc",kDescendingClass:"desc",kActiveClass:"active",kEditingClass:"editing",kUpdatingClass:"updating",kFadingClass:"invisible",kInvalidValueClass:"invalid",kInsertedClass:"inserted",kDeletedClass:"deleted",kReplacingClass:"replacing",kLoadingClass:"loading",kFirstClass:"first",kLastClass:"last"};coherent.Style.__styles=(function(){var a=[];var b=coherent.Style;for(var c in b){a.push(b[c])}return a})();coherent.setupSelectors=function(b,k,f){b=b||document.body;var a;var d;var h;var c=Element.queryAll;function g(m){for(var l in h){m.setAttribute(l,h[l])}}for(a in k){d=c(b,a);h=k[a];Array.forEach(d,g)}coherent.View.createViewsForNodeTree(b,f)};window.FIRST_RESPONDER="__first_responder__";coherent.Responder=Class.create(coherent.Bindable,{sendActionToView:function(b,a){if(FIRST_RESPONDER===a){a=coherent.page.firstResponder}var c=a||coherent.page.firstResponder||this;while(c){if(b in c){c[b](this);return true}c=c.nextResponder()}return false},acceptsFirstResponder:function(){return false},becomeFirstResponder:function(){return true},resignFirstResponder:function(){return true},nextResponder:function(){return this.__nextResponder||null},setNextResponder:function(a){this.__nextResponder=a},presentError:function(b){this.willPresentError(b);if(!("field" in b)){b.field=this}var a=this.nextResponder();if(a){return a.presentError(b)}return false},clearAllErrors:function(b){var a=this.nextResponder();if(a){a.clearAllErrors(b||this)}},willPresentError:function(a){},onmousedown:function(a){var b=this.nextResponder();if(b){b.onmousedown(a)}},onmouseup:function(a){var b=this.nextResponder();if(b){b.onmouseup(a)}},onmousedrag:function(a){var b=this.nextResponder();if(b){b.onmousedrag(a)}},onmouseenter:function(a){var b=this.nextResponder();if(b){b.onmouseenter(a)}},onmouseleave:function(a){var b=this.nextResponder();if(b){b.onmouseleave(a)}},onclick:function(a){var b=this.nextResponder();if(b){b.onclick(a)}},ondblclick:function(a){var b=this.nextResponder();if(b){b.ondblclick(a)}},onkeydown:function(a){var b=this.nextResponder();if(b){b.onkeydown(a)}},onkeyup:function(a){var b=this.nextResponder();if(b){b.onkeyup(a)}},onkeypress:function(a){var b=this.nextResponder();if(b){b.onkeypress(a)}},ontouchstart:function(a){var b=this.nextResponder();if(b){b.ontouchstart(a)}},ontouchmove:function(a){var b=this.nextResponder();if(b){b.ontouchmove(a)}},ontouchend:function(a){var b=this.nextResponder();if(b){b.ontouchend(a)}}});coherent.View=Class.create(coherent.Responder,{__viewClassName__:"View",__tagSpec__:["div","b","strong","em","i","q","p","span","li","h1","h2","h3","h4","td","label"],multipleValuesPlaceholder:_("marker.text.multipleValues"),nullPlaceholder:_("marker.text.placeholder"),noSelectionPlaceholder:_("marker.text.noSelection"),exposedBindings:["visible","class","enabled","editable","html","text","tabindex","title"],automaticallySetupBindings:false,requireBindingsForInferredViewType:true,formatter:null,target:null,action:null,sendActionOn:["click"],animated:false,updateAnimationDuration:0,updateAnimationDelay:0,postUpdateAnimationDuration:0,postUpdateAnimationDelay:0,preUpdateAnimationDuration:0,preUpdateAnimationDelay:0,constructor:function(a,b,c){this.base(c);if("string"===typeof(a)){this.id=a;this.__view=document.getElementById(a)}else{this.id=Element.assignId(a);this.__view=a}if(b&&!("addObserverForKeyPath" in b)){coherent.KVO.adaptTree(b)}this.__relativeSource=b;if(this.id in coherent.View.viewLookup){throw new Error("Two views share the same ID: "+this.id)}this.__updating=null;coherent.View.viewLookup[this.id]=this},__postConstruct:function(){var b=this;function c(){delete b.__view;delete b.__container}c.delay(250);var a=this.viewElement();if(a){this.__init()}else{Event.onDomReady(this.__init.bind(this))}},__init:function(){this.__initialising=true;var g=this.viewElement();if(!g){throw new Error("Unable to locate node with ID: "+this.id)}this.viewElement=function(){return g};var h;var a;if("true"===g.getAttribute("animated")){this.animated=true}var b=g.getAttribute("__parametersId");var k=this.__parameters||coherent.View.nodeParameters[b]||{};this.__copyParameters(k);if(this.innerHTML&&""===String(g.innerHTML).trim()){g.innerHTML=this.innerHTML}var l=coherent.dataModel;var c=this.__context;coherent.dataModel=this.__context=this;var d=this.structure()||{};var f={};for(a in d){h=d[a];if(h&&"function"==typeof(h)&&(h=h.valueOf()).__factoryFn__){f[a]=h;h.call(this,a,true)}}for(a in f){f[a].call(this,a,false)}this.__context=c;coherent.dataModel=l;this.setupBindings();this.init();this.updateBindings();this.createObservers();delete this.__initialising;delete this.viewElement},bindingInfoForName:function(c){var b=this.viewElement();var a=c+"Binding";return b.getAttribute(a)||this.__parameters[a]||this.__parameters[c]},teardown:function(){for(var a in this.bindings){this.bindings[a].unbind()}delete coherent.View.viewLookup[this.id]},__factory__:function(b,h,d){var a=this;var f=Element.queryAll;if("string"!==typeof(b)){d=h;h=b;b=null}h=h||{};var g="parameters_"+coherent.generateUid();coherent.View.nodeParameters[g]=h;h.viewClass=a;function k(l){l.setAttribute("__parametersId",g);if("sortKey" in h){l.setAttribute("sortKey",h.sortKey)}}function c(m){if(!m.getAttribute("__parametersId")){k(m)}var n=this.__relativeSource||this;var l=coherent.View.fromNode(m)||new a(m,n);coherent.View.createViewsForNodeTree(m,n,this.__context)}return function(p,m){if(p&&1===p.nodeType){return new a(p,m,h)}var q=d||(this?this.viewElement():document);var n=b||p;var l;if(/^#\S+$/.test(n)){var o=document.getElementById(n.substring(1));l=o?[o]:[]}else{l=f(q,n)||[]}if(!l.length){return null}if("action" in h){if(!h.target||h.target!==FIRST_RESPONDER){h.target=this}if(FIRST_RESPONDER!==h.target&&"string"===typeof(h.action)){h.action=(h.target)[h.action]}}Array.forEach(l,m?k:c,this);return coherent.View.fromNode(l[0])}},init:function(){var a=this.viewElement();var h=this.bindings;if(h["class"]&&!h["class"].hasValue()){var b=$S(a.className.split(" "));function f(k){delete b[k]}coherent.Style.__styles.forEach(f);var g=Set.join(b," ");h["class"].setValue(g)}if(h.enabled&&!h.enabled.hasValue()){h.enabled.setValue(!a.disabled)}if(h.text&&!h.text.hasValue()){var c=(a.textContent||a.innerText||"").trim();if(c){h.text.setValue(c)}}if(h.html&&!h.html.hasValue()){var d=(a.innerHTML||"").trim();if(d){h.html.setValue(d)}}if(h.title&&!h.title.hasValue()&&a.title){h.title.setValue(a.title)}},structure:function(){return this.__structure__},viewElement:function(){return this.__view||document.getElementById(this.id)},container:function(){return this.__container||this.__view||document.getElementById(this.__containerId||this.id)},setContainer:function(a){if(this.__view){this.__container=a}this.__containerId=Element.assignId(a);return a},superview:function(){var b=this.viewElement();if(!b){return null}var a=null;while(b&&!a){b=b.parentNode;if(!b){return null}if(document==b){return coherent.page}a=coherent.View.fromNode(b)}return a},isDescendantOf:function(b){if(!b){return false}var a=b.viewElement();var c=this.viewElement();while(c&&c!==document.body){if(c.id==a.id){return true}c=c.parentNode}return false},nextResponder:function(){return this.__nextResponder||this.superview()},focus:function(){var a=this.viewElement();function c(){a.focus()}if(coherent.Browser.IE){var b=/^(?:a|button|iframe|input|label|select|textarea)$/i;if(b.test(a.nodeName)){this.focus=c;c()}else{this.focus=function(){}}return}else{this.focus=c;c()}},blur:function(){var a=this.viewElement();function c(){a.blur()}if(coherent.Browser.IE){var b=/^(?:a|button|iframe|input|label|select|textarea)$/i;if(b.test(a.nodeName)){this.blur=c;c()}else{this.blur=function(){}}return}else{this.blur=c;c()}},setDelegate:function(a){this.delegate=a},sendToDelegate:function(a){if(this.delegate&&"function"==typeof(this.delegate[a])){this.delegate[a](this)}},sendAction:function(){var b=coherent.EventLoop.currentEvent;if(!this.action){return}if(FIRST_RESPONDER!==this.target||"string"!==typeof(this.action)){this.action.call(this.target||this.action,this,b);return}var a=coherent.page.firstResponder||this;var c=this.action;while(a){if(c in a){a[c](this,b);return}a=a.nextResponder()}},onclick:function(a){if(this.disabled){Event.stop(a);return}if(this.action&&this.sendActionOn.containsObject("click")){this.sendAction();Event.stop(a)}else{this.base(a)}},addTrackingInfo:function(a){coherent.page.addTrackingInfo(this.id,a)},observeVisibleChange:function(g,f,b){var a=this.viewElement();var d=coherent.Style.kFadingClass;function c(){a.style.display="none";Element.removeClassName(a,d)}if(!this.animated||this.__initialising){a.style.display=(g.newValue?"":"none")}else{if(g.newValue){if(a.style.display!==""){Element.addClassName(a,d);a.style.display=""}coherent.Animator.removeClassName(a,d,{duration:this.updateAnimationDuration||300})}else{coherent.Animator.addClassName(a,d,{duration:this.updateAnimationDuration||300,callback:c})}}},observeEnabledChange:function(b){var a=this.viewElement();this.disabled=a.disabled=!b.newValue;if(a.disabled){Element.addClassName(a,coherent.Style.kDisabledClass)}else{Element.removeClassName(a,coherent.Style.kDisabledClass)}},observeEditableChange:function(b){var a=this.viewElement();a.readOnly=!b.newValue;if(a.readOnly){Element.addClassName(a,coherent.Style.kReadOnlyClass)}else{Element.removeClassName(a,coherent.Style.kReadOnlyClass)}},observeClassChange:function(k,h,d){var a=this.viewElement();var c=$S(a.className.split(" "));var g=$S((k.newValue||"").split(" "));function f(l){if(l in c){Set.add(g,l)}}coherent.Style.__styles.forEach(f);var b=Set.join(g," ");if(this.animated&&!this.__initialising){coherent.Animator.setClassName(a,b,{duration:500})}else{a.className=b}},translateValue:function(c){var a=this.viewElement();var b=true;if(this.formatter){c=this.formatter.stringForValue(c)}switch(c){case"":case null:case undefined:c=this.attributeOrProperty("nullPlaceholder");break;case coherent.Markers.NoSelection:c=this.attributeOrProperty("noSelectionPlaceholder");break;case coherent.Markers.MultipleValues:c=this.attributeOrProperty("multipleValuesPlaceholder");break;default:c=String(c);b=false;break}if(b){Element.addClassName(a,coherent.Style.kMarkerClass)}else{Element.removeClassName(a,coherent.Style.kMarkerClass)}return c},_beginUpdate:function(k,g){var c=(this.preUpdateAnimationDuration||this.updateAnimationDuration||this.postUpdateAnimationDuration)===0;if(c&&k){k.call(this);return}g=g||coherent.Style.kUpdatingClass;var a=this.viewElement();var f=this;if(this.__updating){this.__updating=k||null;return}this.__updating=k||null;function b(){if(f.__updating){f.__updating.call(f)}f.__updating=null;var m=f.postUpdateAnimationDuration||f.updateAnimationDuration;var l=f.postUpdateAnimationDelay||f.updateAnimationDelay;coherent.Animator.removeClassName(a,g,{duration:m,delay:l})}var h=this.preUpdateAnimationDuration||this.updateAnimationDuration;var d=this.preUpdateAnimationDelay||this.updateAnimationDelay||0;coherent.Animator.addClassName(a,g,{duration:h,callback:b})},observeTitleChange:function(d,c,b){var a=this.viewElement();a.title=d.newValue},observeTextChange:function(g,f,b){var a=this.viewElement();var d=(this.translateValue(g.newValue)||"").trim();if(this.lastText===d){return}this.lastText=d;function c(){var h=document.createTextNode(d);a.innerHTML="";a.appendChild(h)}this._beginUpdate(c)},observeHtmlChange:function(k,h,b){var a=this.viewElement();var g=k.newValue;if("string"===typeof(g)){g=g.trim()}var d=(this.translateValue(g)||"").trim();function c(){var l=document.createTextNode(d);a.innerHTML="";a.appendChild(l)}function f(){Element.setInnerHTML(a,d)}if(d!==g){if((a.textContent||a.innerText||"").trim()===d){return}this._beginUpdate(c)}else{if((a.innerHTML||"").trim()===d){return}this._beginUpdate(f)}},observeTabindexChange:function(g,f,b){var a=this.viewElement(),d=g.newValue,c="tabindex";if(d!==0&&!d){a.removeAttribute(c)}else{a.setAttribute(c,d)}},removeChild:function(a){if(!a){return null}coherent.View.teardownViewsForNodeTree(a);if(this.beforeRemoveElement){this.beforeRemoveElement(a)}return a.parentNode.removeChild(a)},attributeOrProperty:(function(){if(coherent.Browser.IE){return function(b){var a=this.viewElement();var c=a[b];if(c||""===c){return c}return String(this[b])}}else{return function(b){var a=this.viewElement();var c=a.getAttribute(b);if(c||""===c){return c}c=a[b];if(c||""===c){return c}return String(this[b])}}})()});coherent.View.nodeParameters={};coherent.View.viewLookup={};coherent.View.registry={};coherent.View.tagToViewLookup={};coherent.View.tagSpecRegex=/^(\w+)\s*(?:\[(\w*)\s*=\s*(\w*)\s*\])?$/;coherent.View.__updateTagSpecTable=function(c){var b=c.prototype;function d(f){var h=f.match(coherent.View.tagSpecRegex);if(!h){throw new Error("Invalid view spec: "+f)}var k=h[1].toUpperCase();var g=h[2];var l=h[3];var m=coherent.View.tagToViewLookup[k]||{};if(!(k in coherent.View.tagToViewLookup)){coherent.View.tagToViewLookup[k]=m}if(!g){if(m.viewClass){console.log((b.__viewClassName__+": "||"")+"Redefining view spec: "+f+": previously registered to "+(m.viewClass.prototype.__viewClassName__||"unknown"));throw new Error("Redefining view spec: "+f)}m.viewClass=c;return}if(!m.attr){m.attr={}}if(!(g in m.attr)){m.attr[g]={}}if(l in m.attr[g]){console.log((b.__viewClassName__+": "||"")+"Redefining view spec: "+f+": previously registered to "+(m.viewClass.prototype.__viewClassName__||"unknown"));throw new Error("Redefining view spec: "+f)}m.attr[g][l]=c}if(b.hasOwnProperty("__tagSpec__")){var a=b.__tagSpec__;if("string"==typeof(a)){d(a)}else{if("forEach" in a){a.forEach(d)}else{console.log("Invalid type for __tagSpec__")}}}if(b.hasOwnProperty("__viewClassName__")){coherent.View.registry[b.__viewClassName__]=c}};coherent.View.__subclassCreated__=function(a){if(!coherent.View.registry){coherent.View.registry={}}var b=a.prototype;var c=a.superclass.prototype;coherent.View.__updateTagSpecTable(a);if(b.__structure__!==c.__structure__){Object.applyDefaults(b.__structure__,c.__structure__)}};coherent.View.viewClassForNode=function(g,d){function a(w){var r=[];var v=w.split(" ");var u;var t=coherent.View.registry;for(u=0;u<v.length;++u){if(v[u] in t){r[r.length]=t[v[u]]}}return r}var k=g.getAttribute("view");var c=g.getAttribute("__parametersId");var m;if(c){return coherent.View.nodeParameters[c].viewClass}if(k){m=coherent.View.registry[k];if(!m){throw new InvalidArgumentError("Invalid view type: "+k)}return m}var f=a(g.className)||0;if(1==f.length){return f[0]}if(f.length>1){throw new InvalidArgumentError("CSS class matches multiple view types: "+g.className)}var h=coherent.View.tagToViewLookup[g.tagName];if(!h){return null}var l;var o;var p=h.attr||{};var q;for(var b in p){q=p[b];o=g.getAttribute(b);if(o in q){m=q[o];break}o=g[b];if(o in q){l=q[o]}}m=m||l||h.viewClass;if(!m){return null}function n(v){var w=m.prototype.exposedBindings||[];var r=w.length;var u;var t;for(t=0;t<r;++t){u=w[t]+"Binding";if(v.getAttribute(u)){return true}}return false}if(!d&&m.prototype.requireBindingsForInferredViewType&&!n(g)){return null}return m};coherent.View.createViewForNode=function(c,f,b){var a=coherent.View.fromNode(c);if(a){return a}var d=coherent.View.viewClassForNode(c,b);return new (d||coherent.View)(c,f,b)};coherent.View.fromNode=function(a){var b=coherent.View.viewLookup;if(!b||!b[a.id]){return null}return b[a.id]};coherent.View.rebindNodeTreeWithRelativeSource=function(c,f,d){var a=coherent.ListView;function b(h){var g=coherent.View.fromNode(h);if(!g||(f&&g.__relativeSource!==f)){return true}g.__relativeSource=d;g.setupBindings();g.updateBindings();if(g instanceof a){return false}}Element.depthFirstTraversal(c,b)};coherent.View.unbindNodeTree=function(b){function a(d){var c=coherent.View.fromNode(d);if(!c){return}c.unbind()}Element.depthFirstTraversal(b,a)};coherent.View.createViewsForNodeTree=function(f,c,d){function b(g){if(coherent.View.fromNode(g)){return}var h=coherent.View.viewClassForNode(g);if(!h){return}new (h)(g,c)}var a=coherent.dataModel;if(d){coherent.dataModel=d}Element.depthFirstTraversal(f||document.body,b);if(d){coherent.dataModel=a}};coherent.View.teardownViewsForNodeTree=function(a){function b(d){var c=coherent.View.fromNode(d);if(!c){return}c.teardown()}Element.depthFirstTraversal(a||document.body,b)};coherent.View.__updateTagSpecTable(coherent.View);coherent.Anchor=Class.create(coherent.View,{__viewClassName__:"Anchor",__tagSpec__:"a",exposedBindings:["href"],init:function(){this.base();var a=this.viewElement();var b=this.bindings;if(b.href&&!b.href.hasValue()&&a.href){b.href.setValue(a.href)}},observeHrefChange:function(b){var a=this.viewElement();a.href=b.newValue}});coherent.ListView=Class.create(coherent.View,{__viewClassName__:"List",__tagSpec__:["table","ul"],exposedBindings:["content","selectionIndexes","selectedIndex","selectedObject"],_items:null,_activeItem:-1,init:function(){this.base();this.objectCache={};var b=this.viewElement();var a;switch(b.tagName){case"SELECT":this._isSelectElement=true;this._items=PartList("option");this.templateElement=document.createElement("option");Event.observe(b,"change",this.selectedIndexChanged.bindAsEventListener(this));break;case"TABLE":a=this.setContainer(b.tBodies[0]);this._items=PartList("> tbody tr");this.templateElement=Element.clone(this._items(0));break;default:a=this.container();var c=b.firstChild;while(c){if(1===c.nodeType){break}c=c.nextSibling}if(!c){return}this._items=PartList("> "+c.nodeName);this.templateElement=Element.clone(c);break}this._items();if("true"===(this.attributeOrProperty("multiple")||"").toLowerCase()){this.multiple=true}this.templateElement.id="";if(this.template&&"function"!==typeof(this.template)){delete this.template}if(this.template&&!(this.template.valueOf()).__factoryFn__){this.template=this.template()}if(!this.template&&this.initFromDOM!==false){this._initFromDOM()}else{if(a){while(a.firstChild){a.removeChild(a.firstChild)}}}},computeSelectionIndexes:function(){var b=[];var a=this._items();function c(f,d){if(f.selected){b.push(d)}}a.forEach(c);return b},_initFromDOM:function(){var b=this.container();var o=this.viewElement();var c=this.bindings;var h=[];var q=[];var m=[];var n=this._items();var k=n.length;var l;if(!k||(c.content&&c.content.hasValue())){return}var d=this.objectClass||coherent.KVO;var a=coherent.Style.kSelectedClass;var p=Element.hasClassName;for(var g=0;g<k;++g){l=n[g];var f=m[g]=new d();if(l.selected||p(l,a)){h.push(g);q.push(f)}this.setupElement(l,f)}this.__selectionIndexes=h;this.selectedIndex=h.length?h[0]:-1;this.__content=m;if(c.content){c.content.setValue(m)}if(c.selectionIndexes){c.selectionIndexes.setValue(h)}if(c.selectedObject){c.selectedObject.setValue(q[0])}if(c.selectedIndex){c.selectedIndex.setValue(this.selectedIndex)}},acceptsFirstResponder:function(){var a=this.viewElement();if(a.disabled||a.readOnly){return false}return true},highlightSelectionIndexes:function(d){var n=this.viewElement();var m=this._items();var h=m.length;var f;var g=0;var b=!!this._isSelectElement;var c;var a=coherent.Style.kSelectedClass;var l;var o;if(this.animated){var p={curve:coherent.easing.inOutSine,duration:300};l=function(r,q){coherent.Animator.addClassName(r,q,p)};o=function(r,q){coherent.Animator.removeClassName(r,q,p)}}else{l=Element.addClassName;o=Element.removeClassName}for(f=0;f<h;++f){if(f===0){Element.addClassName(m[f],coherent.Style.kFirstClass)}else{Element.removeClassName(m[f],coherent.Style.kFirstClass)}if(h>1&&f===h-1){Element.addClassName(m[f],coherent.Style.kLastClass)}else{Element.removeClassName(m[f],coherent.Style.kLastClass)}c=(f==d[g]);try{m[f].selected=c}catch(k){m[f].setAttribute("selected",c)}if(c){g++}if(b){continue}if(c){l(m[f],a)}else{o(m[f],a)}}if(1===d.length){this.selectedIndex=n.selectedIndex=d[0]}this.__selectionIndexes=d},selectionIndexes:function(){return this.__selectionIndexes},setSelectionIndexes:function(f){var a;var b=this.viewElement();var g=this.bindings;f=(f||[]).concat().sort();if(String(f)===String(this.__selectionIndexes)){f=this.__selectionIndexes}if(1===f.length){a=this.selectedIndex=b.selectedIndex=f[0]}else{if(f.length){a=b.selectedIndex=f[0]}else{a=b.selectedIndex=-1}}if(g.selectionIndexes){g.selectionIndexes.setValue(f)}if(g.selectedIndex){g.selectedIndex.setValue(a)}if(g.selectedObject&&g.content){var c=null;if(-1!==a){c=(this.__content||[])[a]}g.selectedObject.setValue(c)}if(g.selectedValue){var d=null;if(-1!==a){d=b.options[a].value}g.selectedValue.setValue(d)}this.__selectionIndexes=f;this.highlightSelectionIndexes(f)},selectedObjects:function(){var a=this.__content||[];return a.objectsAtIndexes(this.selectionIndexes()||[])},onkeydown:function(b){var m=this.viewElement();if(m.disabled){return}if(Event.KEY_UP!=b.keyCode&&Event.KEY_DOWN!=b.keyCode){return}Event.stop(b);var l=this.selectionIndexes();var f=(this.__content||[]).length-1;var o;if(this.multiple&&b.shiftKey&&l.length){var k=(this.selectedIndex==l[0]);var h=l[0];var n=l[l.length-1];if(1==l.length){if(Event.KEY_UP==b.keyCode){o=h-1}else{o=h+1}if(o<0||o>f){return}l.push(o)}else{if(k){if(Event.KEY_UP==b.keyCode){l.length--}else{if(n<f){l.push(o=n+1)}}}else{if(this.KEY_DOWN==b.keyCode){l.splice(0,1)}else{if(h>0){l.push(o=h-1)}}}}}else{if(!l.length){if(Event.KEY_UP==b.keyCode){this.selectedIndex=f}else{if(Event.KEY_DOWN==b.keyCode){this.selectedIndex=0}}l=[o=this.selectedIndex]}else{if(Event.KEY_UP==b.keyCode&&this.selectedIndex>0){this.selectedIndex--}else{if(Event.KEY_DOWN==b.keyCode&&this.selectedIndex<f){this.selectedIndex++}}l=[o=this.selectedIndex]}}if(!isNaN(o)){var q=this._items(o);var p=Element.scrollParent(m);var g=p.offsetHeight;var c=q.offsetTop-p.scrollTop;var d=q.offsetHeight;var a=this.container();if(q.offsetParent!==a){c-=a.offsetTop}if(c<0){q.scrollIntoView(true)}else{if(c+d>g){q.scrollIntoView(false)}}}this.setSelectionIndexes(l);return},selectedIndexChanged:function(c){if(!this.bindings.selectionIndexes&&!this.bindings.selectedIndex&&!this.bindings.selectedObject&&!this.bindings.selectedValue){return}var a=this.viewElement();var b;if(this.multiple){b=this.computeSelectionIndexes()}else{b=[this.selectedIndex=a.selectedIndex]}this.setSelectionIndexes(b)},_clearSelection:function(){var a=this.viewElement();var f=("SELECT"!==a.tagName);var g=Element.removeClassName;var c=coherent.Style.kSelectedClass;function d(h){h.selected=false;if(f){g(h,c)}}var b=this._items();b.forEach(d);a.selectedIndex=-1},observeSelectedIndexChange:function(d){var c=d.newValue;var b=(-1!==c&&null!==c&&"undefined"!==typeof(c));var a=b?[c]:[];this.setSelectionIndexes(a)},observeSelectedObjectChange:function(f){var d=f.newValue;var c=this.__content||[];var a=c.indexOf(d);var b=(-1===a?[]:[a]);this.setSelectionIndexes(b)},observeSelectionIndexesChange:function(b){var a=b.newValue||[];this.setSelectionIndexes(a)},_updateDomWithContent:function(m){this._items.refresh();var o=coherent.View.rebindNodeTreeWithRelativeSource;var t=coherent.View.unbindNodeTree;var u=this.selectedObjects();var k=[];var c=m.length;var n=this._items();var p=n.length;var f=Math.min(p,c);var h=0;var g;var l;var a;var q;var d;while(h<f){g=m[h];if(-1!==u.indexOf(g)){k.push(h)}l=n[h];d=Element.assignId(l);a=this.objectCache[d];this.objectCache[d]=g;if("undefined"===typeof(a)){this.setupElement(l,g)}else{o(l,a,g)}q=coherent.View.fromNode(l);if(!q||!q.bindings.visible){l.style.display=""}++h}if(h<c){var b=this.container();var r=document.createDocumentFragment();while(h<c){g=m[h];if(-1!==u.indexOf(g)){k.push(h)}l=this.createElement(g,null,r);this._items.add(l);++h}b.appendChild(r)}else{while(h<p){l=n[h];d=Element.assignId(l);t(l);this.objectCache[d]=null;if("SELECT"==this.viewElement().tagName){l.parentNode.removeChild(l);this._items.removePart(l);--p}else{l.style.display="none";++h}}}this.highlightSelectionIndexes(k)},observeContentChange:function(n){var b=this.container();var p=this.viewElement();var h;var o;var l;var m;var k;var g=[];var q=coherent.View.rebindNodeTreeWithRelativeSource;var r=coherent.View.unbindNodeTree;var a=this.objectCache;function d(v,u){var w=Element.assignId(w);var t=a[w];a[w]=u;q(v,t,u);v.style.display=""}switch(n.changeType){case coherent.ChangeType.setting:this.__content=n.newValue||[];this._updateDomWithContent(this.__content);break;case coherent.ChangeType.insertion:for(h=0;h<n.indexes.length;++h){o=this._items(n.indexes[h]);if(o&&"none"===o.style.display){l=o;d(o,n.newValue[h])}else{l=this.createElement(n.newValue[h],o);this._items.insertPartAtIndex(l,n.indexes[h])}if(this.animated){Element.addClassName(l,coherent.Style.kInsertedClass);coherent.Animator.removeClassName(l,coherent.Style.kInsertedClass,{discreteTransitionPoint:1,duration:this.updateAnimationDuration})}}break;case coherent.ChangeType.replacement:function f(u,t){d(u,t);coherent.Animator.removeClassName(u,coherent.Style.kReplacingClass,{duration:250,discreteTransitionPoint:1})}for(h=0;h<n.indexes.length;++h){l=this._items(n.indexes[h]);if(!this.animated){d(l,n.newValue[h])}else{coherent.Animator.addClassName(l,coherent.Style.kReplacingClass,{duration:this.updateAnimationDuration,discreteTransitionPoint:0,callback:f.bind(this,n.newValue[h])})}}break;case coherent.ChangeType.deletion:g=this.selectionIndexes();for(h=n.indexes.length-1;h>=0;--h){var c=n.indexes[h];g.removeObject(c);l=this._items(c);this._items.removePartAtIndex(c);if(!this.animated){this.removeChild(l)}else{coherent.Animator.addClassName(l,coherent.Style.kDeletedClass,{duration:this.updateAnimationDuration,discreteTransitionPoint:0,callback:this.removeChild.bind(this)})}}this.setSelectionIndexes(g);break;default:console.log("Unknown change type: "+n.changeType);break}if(this.bindings.displayValues){this.bindings.displayValues.update()}if(this.bindings.contentValues){this.bindings.contentValues.update()}},setupElement:function(d,c){if(coherent.Browser.MobileSafari&&!d.__setup){d.__setup=true;d.addEventListener("click",function(){},false)}if(this.template){var a=coherent.dataModel;var b;coherent.dataModel=this.__context;this.template.call(this,d,c);coherent.dataModel=a}else{coherent.View.createViewsForNodeTree(d,c,this.__context)}var f=Element.assignId(d);this.objectCache[f]=c;return d},createElement:function(c,d,b){var a=this.viewElement();b=b||this.container();var f=Element.clone(this.templateElement);var g=b.insertBefore(f,d||null);return this.setupElement(g,c)},onmousedown:function(d){var b=this.viewElement();if(b.disabled){return}if("SELECT"===b.tagName){this.base(d);return}var f=d.target||d.srcElement;var a=this.container();var c=this._items();if(f==a||f==b){return}while(f&&f.parentNode!=a){f=f.parentNode}if(f==a||f==b){return}this._activeItem=c.indexOf(f);Element.addClassName(f,coherent.Style.kActiveClass)},onmouseup:function(b){var a=this.viewElement();if(a.disabled){return}if(-1!==this._activeItem){Element.removeClassName(this._items(this._activeItem),coherent.Style.kActiveClass)}this._activeItem=-1},ontouchmove:function(b){var a=this.viewElement();if(a.disabled){return}if(-1!==this._activeItem){Element.removeClassName(this._items(this._activeItem),coherent.Style.kActiveClass)}this._activeItem=-1;this.base(b)},onclick:function(a){var m=this.viewElement();if(m.disabled){this.base(a);Event.stop(a);return}if("SELECT"===m.tagName){this.base(a);return}var k=a.target||a.srcElement;var f=-1;var d=null;var b=this.container();var l=this._items();if(k==b){return}while(k&&k.parentNode!=b){k=k.parentNode}if(k){f=l.indexOf(k);var c=Element.assignId(k);d=this.objectCache[c]}var h;if(!this.multiple){this.selectedIndex=f;this.setSelectionIndexes(h=[f])}else{h=this.selectionIndexes();if(a.shiftKey){this.setSelectionIndexes(IndexRange(this.selectedIndex,f))}else{if(a.ctrlKey||a.metaKey){var g=h.indexOf(f);if(-1===g){this.selectedIndex=f;h.push(f)}else{h.splice(g,1)}this.setSelectionIndexes(h)}else{this.selectedIndex=f;this.setSelectionIndexes([f])}}}if(k&&"A"==k.tagName){k.blur()}this.sendAction()}});coherent.Overlay=Class.create(coherent.View,{content:Part(".content"),container:Part(".container"),__structure__:{".close":coherent.Anchor({action:"close",visibleBinding:"canClose"}),".spinner":coherent.View({visibleBinding:"loading"}),".buttons":coherent.ListView({visibleBinding:"recoveryOptions",contentBinding:"recoveryOptions",action:"recoveryButtonClicked",acceptsFirstResponder:function(){return false},template:coherent.View({__structure__:{button:coherent.View({textBinding:"*.text"})}})})},minWidth:200,minHeight:200,contentScreen:null,spinnerDelay:500,spinnerClassName:"overlay-waiting",timeout:5000,focusableSelectors:"input, select, textarea, button, a[href]",tabStart:Part("#tab-start"),tabStop:Part("#tab-stop"),closeBtn:Part(".close"),innerHTML:'<span class="chrome tl"></span><span class="chrome tr"></span><span class="chrome top"></span><span class="chrome left"></span><span class="chrome right"></span><span class="chrome bottom"></span><span class="chrome bl"></span><span class="chrome br"></span><a href="#" class="close">close</a><a href="#" id="tab-start" tabindex="1"></a><span class="chrome center"></span><div class="spinner"></div><div class="container"><div class="content"></div><a href="#" id="tab-stop"></a><ul class="buttons"><li><button></button></li></ul></div>',errorInnerHTML:'<div class="blue-header-popup">        <div class="header">            <h2>Server did not respond</h2>        </div>        <div class="content clearfix">            <p><strong>Your request to the server got no response. Either the request took too long, or the server may be down temporarily. Please try again.</strong></p>            <div class="error-actions">                <a href="#" class="cancel continue"><span class="replaced">Continue</span></a>            </div>        </div>        <div class="footer empty-footer">            <p>&nbsp;</p>        </div>    </div>',keyDependencies:{canClose:["loading","displayCloseWidget"]},init:function(){this.__cache={};this.__urlCache={};var a=this.viewElement();Element.setStyle(a,"display","none");this.setValueForKey(false,"visible");this.__curFocusIndex=0;this.__curFocusElement=null;this.__focusableElements=null},__resetFocusableElements:function(){this.__focusableElements=Element.queryAll(this.viewElement(),this.focusableSelectors).sort(function a(g,f){var d=0,c=g.tabIndex,b=f.tabIndex;if(g==this.tabStop()){d=1}else{if(f==this.tabStop()){d=-1}else{if(g==this.closeBtn()){d=1}else{if(f==this.closeBtn()){d=-1}else{if(c>0&&b>0){d=c-b}else{if(c>0){d=-1}else{if(b>0){d=1}else{if(c<0&&b<0){d=0}else{if(c<0){d=1}else{if(b<0){d=-1}}}}}}}}}}return d}.bind(this)).filter(function(b){return b.type!=="hidden"&&b.tabIndex>=0})},__getNextFocusableIndex:function(a){var d=this.__focusableElements,c=d.length,b=0;if(c==3){b=1}else{if(c>3){b=this.__getNextTabbableIndex(this.__curFocusIndex,a)}}return b},__getNextTabbableIndex:function(k,b){var a=k,h=this.__focusableElements,f=h.length,d=f-1,c;do{a=(b?((a===0)?d:a-1):((a==d)?0:a+1));c=h[a];try{c.focus();return a}catch(g){}}while(a!=k);return a},__setFocus:function(a,c){var b=this.__focusableElements[a];if(!c&&b&&b.focus){b.focus()}this.__curFocusElement=b;this.__curFocusIndex=a},enableTabHandler:function(){this.__resetFocusableElements();this.__setFocus(this.__curFocusIndex);this.__keyboardObserver=this.__keyboardHandler.bindAsEventListener(this);Event.observe(document,"keydown",this.__keyboardObserver)},disableTabHandler:function(){Event.stopObserving(document,"keydown",this.__keyboardObserver)},__keyboardHandler:function(a){switch(a.keyCode||a.which){case Event.KEY_TAB:Event.stop(a);this.__setFocus(this.__getNextFocusableIndex(a.shiftKey));if((a.target||a.srcElement)==this.tabStop()){this.__resetFocusableElements()}break;case Event.KEY_ESC:if(this.valueForKey("canClose")){this.hide();Event.stop(a)}break;default:break}},__updateTabStateAfterClick:function(a){var b=a.target||a.srcElement,d=null;if(b&&Element.match(b,this.focusableSelectors)&&this.__inOverlay(b)){var c=function(f){return this.__focusableElements.indexOf(f)}.bind(this);if(c(b)<0){this.__resetFocusableElements()}this.__setFocus(c(b),true)}},__inOverlay:function(c){var a=this.viewElement(),b=Element.locateAncestor(c,function(d){return d==a},a.parentNode);return !!b},canClose:function(){return !this.loading&&this.displayCloseWidget},onclick:function(c){var a=this.viewElement(),d=Element.locateAncestor(c.target||c.srcElement,function b(f){return Element.hasClassName(f,"cancel")},a);if(d){this.hide();Event.stop(c)}else{this.__updateTabStateAfterClick(c)}d=this.nextResponder();if(d){d.onclick(c)}},display:function(c){c=Object.applyDefaults(c||{},{timeout:this.timeout,spinnerDelay:this.spinnerDelay,obscurePage:true,displayCloseWidget:true,nextResponder:null,grow:false,dimensions:{width:this.minWidth,height:this.minHeight}});if(!c.url&&!c.sourceId&&!c.html&&!c.text&&!c.error){throw new Error("No source specified for the overlay.")}this.setValueForKey(c.displayCloseWidget,"displayCloseWidget");if(c.nextResponder){this.setNextResponder(c.nextResponder)}if(!this.contentScreen){function b(d){this.close();Event.stop(d)}if(coherent.Browser.IE===6){this.contentScreen=document.createElement("IFRAME");this.contentScreen.scrolling="no";this.contentScreen.frameBorder="0";this.contentScreen.src="about:blank"}else{this.contentScreen=document.createElement("DIV");if(this.displayCloseWidget){Event.observe(this.contentScreen,"click",b.bindAsEventListener(this))}}this.contentScreen.className="overlayScreen";Element.assignId(this.contentScreen);document.body.appendChild(this.contentScreen)}var a=this.viewElement();if(a.parentNode!==document.body){document.body.appendChild(a)}if(this.__request){this.__request.abort()}this.__clearTimers();if(c.grow){this.__show(c)}if(c.url){this.__loadContent(c);return}this.__showContent(c)},__clearTimers:function(){var b=[this.__loadingTimer,this.__waitingTimer],a;for(a=0;a<b.length;a++){if(b[a]){window.clearTimeout(b[a]);b[a]=0}}},__prepareToShow:function(b){var a=document.getElementById(this.__spinnerDelayNodeId);if(a){Element.setStyle(a,"display","none")}b.obscurePage=false;this.setValueForKey(false,"loading");this.__showContent(b)},__loadContent:function(c){function g(){console.log("Failed to display overlay: timeout exceeded");this.__clearTimers();c.html=this.errorInnerHTML;this.__prepareToShow(c)}function k(d){console.log("Failed to display overlay: "+d.message);this.__clearTimers();c.html=this.errorInnerHTML;this.__prepareToShow(c)}function b(){var d=document.getElementById(this.__spinnerDelayNodeId),l=Element.setStyle;if(!this.__spinnerDelayNodeId){d=document.body.appendChild(document.createElement("DIV"));l(d,"display","none");d.className=this.spinnerClassName;this.__spinnerDelayNodeId=Element.assignId(d)}l(d,"display","")}function a(m){var l=document.createElement("div"),d=coherent.Scripts.extract(m);c.scripts=d.scripts;c.html=d.toString();c.sourceId=Element.assignId(l);Element.setInnerHTML(l,c.html);this.__urlCache[c.url]=c.sourceId;this.__cache[l.id]=l;this.__clearTimers();this.__prepareToShow(c)}var f=this.__urlCache[c.url],h;if(f){c.sourceId=f;this.__clearTimers();this.__showContent(c);return}if(c.obscurePage){this.__obscurePage()}h=XHR.get(c.url);h.addMethods(a.bind(this),k.bind(this));this.setValueForKey(true,"loading");this.__loadingTimer=g.bindAndDelay(this,c.timeout);this.__waitingTimer=b.bindAndDelay(this,c.spinnerDelay)},__obscurePage:function(){var b=this.contentScreen,a="px";if(!this.__didObscurePage){this.__didObscurePage=true;Element.setStyle(b,"display","block");if(6===coherent.Browser.IE||coherent.Browser.MobileSafari){Element.setStyles(b,{position:"absolute",top:0+a,left:0+a,width:document.body.offsetWidth+a,height:document.body.offsetHeight+a})}coherent.Animator.setStyles(b,{opacity:0.85},{duration:175})}},__unobscurePage:function(){var a=this.contentScreen;if(this.__didObscurePage){this.__didObscurePage=false;coherent.Animator.setStyles(a,{opacity:0},{duration:250,callback:function(){Element.setStyle(a,"display","none")}})}},__getNodeById:function(a){return this.__cache[a]=(document.getElementById(a)||this.__cache[a])},__removeChildren:function(a){while(a.firstChild){a.removeChild(a.firstChild)}},__suspendScrolling:function(){if(coherent.Browser.IE===6){Element.query("html").style.overflow="hidden"}},__resumeScrolling:function(){if(coherent.Browser.IE===6){Element.query("html").style.overflow=""}},__showContent:function(d){var g=document.body,k=g.insertBefore(this.viewElement(),g.firstChild),h=this.content(),a=this.container(),m,l,f,b,n;if("classname" in d){k.className=d.classname}Element.setStyles(k,{opacity:0,display:"",width:"",height:""});if("sourceId" in d){this.__removeChildren(h);b=this.__getNodeById(d.sourceId);if(b.parentNode){b.parentNode.removeChild(b)}h.appendChild(b)}else{if("html" in d){f=coherent.Scripts.extract(d.html);d.scripts=f.scripts;h.innerHTML=f}else{if("text" in d){m=document.createTextNode(d.text);this.__removeChildren(h);h.appendChild(m)}else{if("error" in d){m=document.createElement("span");Element.setInnerHTML(m,d.error.description);this.__removeChildren(h);h.appendChild(m);this.setValueForKey(d.error,"error");if(this.error.recoveryOptions&&this.error.recoveryAttempter){function c(q){var p=new coherent.KVO();p.text=q;return p}n=this.error.recoveryOptions.map(c);this.setValueForKey(n,"recoveryOptions")}else{this.setValueForKey(null,"recoveryOptions")}}}}}if(!d.error){this.setValueForKey(null,"error");this.setValueForKey(null,"recoveryOptions")}this.beforeShow(h,d);this.setDisplayDimensions(this.getDisplayDimensions(h),d);this.__show(d)},beforeShow:function(b,a){},getDisplayDimensions:function(a){return Element.getDimensions(a)},setDisplayDimensions:function(b,a){a.dimensions=b;a.dimensions.height=Math.max(this.minHeight,a.dimensions.height);a.dimensions.width=Math.max(this.minWidth,a.dimensions.width)},load:function(a){this.display({url:a})},__show:function(d){var b=d.dimensions.width,t=d.dimensions.height,a=this.container(),p=this.viewElement(),q="px",k=Element.getViewport(),h=Element.setStyle,o=Element.setStyles,g=coherent.Animator.setStyles,n=Math.max(t/2+15,Math.round(k.height/2+k.top))+q,l={display:"",position:"absolute",left:"50%",top:n},f={opacity:1},m=this;this.__grow=d.grow;if(this.__grow){l.width=this.minWidth+q;l.height=this.minHeight+q;l.marginLeft=(-this.minWidth/2)+q;l.marginTop=(-this.minHeight/2)+q;f.width=b+q;f.height=t+q;f.marginLeft=(-b/2)+q;f.marginTop=(-t/2)+q}else{l.width=b+q;l.height=t+q;l.marginLeft=(-b/2)+q;l.marginTop=(-t/2)+q}if(d.obscurePage){this.__obscurePage()}function r(){if(d.scripts){coherent.Scripts.install(d.scripts)}d.scripts=null}o(p,l);function c(){m.sendToDelegate("willShowOverlay");g(p,f,{duration:250,callback:function(){r();m.setValueForKey(true,"visible");m.sendToDelegate("didShowOverlay");m.enableTabHandler()}})}coherent.Overlay.__currentOverlay=this;c.delay(100)},close:function(){return this.hide()},hide:function(b){var n=this.contentScreen,l=this.viewElement(),a=this.container(),h=this.content(),m="px",g=this,k=this.__removeChildren,f=Element.setStyle,d=coherent.Animator.setStyles,c={opacity:0};this.sendToDelegate("willHideOverlay");if(this.__grow){c.width=this.minWidth+m;c.height=this.minHeight+m;c.marginLeft=(-this.minWidth/2)+m;c.marginTop=(-this.minHeight/2)+m}this.__unobscurePage();d(l,c,{duration:250,callback:function(){l=document.body.appendChild(l);f(l,"display","none");g.sendToDelegate("didHideOverlay");if(b){k(h)}}});coherent.Overlay.__currentOverlay=null;this.setValueForKey(false,"visible");this.disableTabHandler()},recoveryButtonClicked:function(d){var c=d.selectedIndex,b=this.error,a=b.recoveryAttempter;if(-1==c||!a){return}a(b,c)}});coherent.Overlay.getCurrentOverlay=function(){return coherent.Overlay.__currentOverlay||null};coherent.Bubble=Class.create(coherent.Overlay,{arrow:Part(".arrow"),innerHTML:'<span class="chrome tl"></span><span class="chrome tr"></span><span class="chrome top"></span><span class="chrome left"></span><span class="chrome right"></span><span class="chrome bottom"></span><span class="chrome bl"></span><span class="chrome br"></span><a href="#" class="close">close</a><span class="chrome center"></span><div class="spinner"></div><div class="container"><div class="content"></div><ul class="buttons"><li><button class="text-action"></button></li></ul></div><span class="chrome arrow"></span>',minWidth:50,minHeight:20,maxWidth:800,maxHeight:500,init:function(){this.base();this.currentTarget=null},display:function(a){a=Object.applyDefaults(a,{grow:false});var b=Element.assignId(a.target);if(this.currentTarget==b){return}if(this.currentTarget){this.base(a);return}if(this.__timer){window.clearTimeout(this.__timer)}this.currentTarget=b;this.__timer=this.base.bindAndDelay(this,150,a)},hide:function(a){if(a&&this.currentTarget!==a.target.id){return}if(this.__timer){window.clearTimeout(this.__timer)}this.__timer=this.__hide.bindAndDelay(this)},onmousedown:function(){if(this.__timer){window.clearTimeout(this.__timer)}},onmouseup:function(){this.hide()},__show:function(c){if(this.__timer){window.clearTimeout(this.__timer)}this.__timer=null;this.currentTarget=Element.assignId(c.target);var n=this.viewElement();var p=this.arrow();var h=this.content();var b=this.container();Element.setStyle(b,"opacity",1);b.style.position="";Element.setStyle(n,"opacity",0);n.style.display="";var a=Element.getRect(c.target),r=a.left+a.width/2;var k=Element.getViewport();var l,u,t,g;if(c.within){l=Element.getRect(c.within)}else{if(c.dimensions){var o=parseInt(a.left,10)+Math.floor(a.width/2);var q=Math.floor(c.dimensions.width/2);l={left:o-q,right:o+q,width:c.dimensions.width}}else{l=Element.getRect(document.body)}}n.style.width="";u=Element.getRect(h);if(u.width<=l.width){if((r+u.width/2)<l.right){t={width:u.width+"px",left:Math.max(l.left,r-u.width/2)+"px",right:""};g=(r-parseInt(t.left,10))+"px"}else{t={width:u.width+"px",left:(l.right-u.width)+"px",right:""};g=(r-parseInt(t.left,10))+"px"}}else{t={width:l.width+"px",left:l.left+"px",right:""};g=(r-l.left)+"px"}Element.setStyles(n,t);Element.setStyle(p,"left",g);Element.removeClassName(n,"below");var d=p.offsetHeight;var f=d+parseInt(Element.getStyle(p,"marginBottom")||0,10);var m=parseInt(a.top,10)-n.offsetHeight-f;if(m<k.top||"below"==c.position){Element.addClassName(n,"below");f=d+parseInt(Element.getStyle(p,"marginTop")||0,10);m=parseInt(a.bottom,10)+f}n.style.top=m+"px";coherent.Animator.setStyles(n,{opacity:1},{duration:100})},__hide:function(){if(this.__timer){window.clearTimeout(this.__timer)}this.__timer=null;this.currentTarget=null;var a=this.viewElement();coherent.Animator.setStyles(a,{opacity:0},{duration:100,callback:function(){a.style.display="none"}})}});coherent.Bubble.display=function(d){var b="coherent_bubble_node";var c=document.getElementById(b);var a;if(c){a=coherent.View.fromNode(c)}else{c=document.createElement("div");c.id=b;document.body.appendChild(c);a=new coherent.Bubble(c)}a.display(d)};coherent.Bubble.hide=function(d){var b="coherent_bubble_node";var c=document.getElementById(b);if(!c){return}var a=coherent.View.fromNode(c);a.hide(d)};coherent.FieldGroup=Class.create(coherent.View,{validateFields:function(){var c=this.viewElement();var b=Element.queryAll(c,"input, textarea");var a=b.length;var l;var h;var d;var k=true;for(var g=0;g<a;++g){l=coherent.View.fromNode(b[g]);if(!l){continue}if("validate" in l){d=l.validate();if(d instanceof coherent.Error){k=false;h=h||b[g]}}}if(h){h.focus()}return k}});coherent.Fieldset=Class.create(coherent.FieldGroup,{bubbleClass:"bubble",init:function(){this.__currentViewId=false;this.__fieldErrors={};coherent.page.addObserverForKeyPath(this,"observeFirstResponderChange","firstResponder")},presentError:function(a){var b=a.field;if(!b){return}this.__fieldErrors[b.id]=a},clearAllErrors:function(a){delete this.__fieldErrors[a.id];if(this.__currentViewId==a.id){this.__currentViewId=false;coherent.Bubble.hide({target:document.getElementById(a.id)})}},observeFirstResponderChange:function(b){var a=b.newValue;this.showErrorMessageForField(a)},showErrorMessageForField:function(b){var a=!!b&&this.__fieldErrors[b.id];if(!a||!b.isDescendantOf(this)){if(this.__currentViewId){coherent.Bubble.hide({target:document.getElementById(this.__currentViewId)})}this.__currentViewId=false;return}this.__currentViewId=b.id;coherent.Bubble.display({classname:this.bubbleClass,error:a,position:a.position,target:b.viewElement(),within:this.viewElement(),nextResponder:b})}});coherent.Binding=Class.create({constructor:function(b,c,a){if(0===arguments.length){return}this.object=b;this.keyPath=c;this.transformer=a;this.refresh()},bind:function(){this.object.addObserverForKeyPath(this,this.observeChangeForKeyPath,this.keyPath)},unbind:function(){this.object.removeObserverForKeyPath(this,this.keyPath)},refresh:function(){this.cachedOriginalValue=this.object.valueForKeyPath(this.keyPath);this.cachedValue=this.transformedValue(this.cachedOriginalValue)},transformedValue:function(a){if(!this.transformer){return a}return this.transformer.transformedValue(a)},validateProposedValue:function(b){if(this.transformer){if(!this.transformer.reverseTransformedValue){throw new Error("Can't validate a value when the transformer doesn't have a reverseTransformedValue method")}b=this.transformer.reverseTransformedValue(b)}var a=this.object.validateValueForKeyPath(b,this.keyPath);if(a instanceof coherent.Error){return a}return this.transformedValue(a)},setValue:function(a){if(this.cachedValue===a){return}this.cachedValue=a;if(this.transformer){if(!this.transformer.reverseTransformedValue){return}a=this.transformer.reverseTransformedValue(a)}this.cachedOriginalValue=a;var b=this.updating;this.updating=true;this.object.setValueForKeyPath(a,this.keyPath);this.updating=b},mutable:function(){if(this.transformer&&!this.transformer.reverseTransformedValue){return false}var a=this.object.infoForKeyPath(this.keyPath);return a&&a.mutable},value:function(){return this.cachedValue},hasValue:function(){var a=this.value();return !(null===a||"undefined"===typeof(a))},update:function(){var a=this.value();var b=new coherent.ChangeNotification(this.object,coherent.ChangeType.setting,a);this.updating=true;this.observerFn(b,this.keyPath);this.updating=false},observerFn:function(c,b,a){},observeChangeForKeyPath:function(g,f,a){if(this.updating&&g.newValue===this.cachedOriginalValue){return}this.cachedOriginalValue=g.newValue;this.cachedOldValue=g.oldValue;var d=this.transformedValue(g.newValue);var b=Object.clone(g);b.newValue=d;b.oldValue=null;if(coherent.ChangeType.setting===g.changeType){this.cachedValue=d}var c=this.updating;this.updating=true;this.observerFn(b,f,a);this.updating=c}});coherent.Binding.bindingRegex=/^(.*?)(?:\((.*)\))?$/;coherent.Binding.compoundRegex=/^\s*([^&|].*?)\s*(\&\&|\|\|)\s*(\S.+)\s*$/;coherent.Binding.bindingFromString=function(d,c){var b;var f;b=d.match(coherent.Binding.compoundRegex);if(b&&4==b.length){f=new coherent.CompoundBinding(b[2],coherent.Binding.bindingFromString(b[1],c),coherent.Binding.bindingFromString(b[3],c));f.bind();return f}b=d.match(coherent.Binding.bindingRegex);if(!b||b.length<3){throw new InvalidArgumentError("bindingString isn't in correct format")}var g=b[1];var a;if(b[2]){a=coherent.findTransformerWithName(b[2])}if("$"==g.charAt(0)){f=new coherent.VariableBinding(c||coherent.dataModel,g,a)}else{f=new coherent.Binding(c||coherent.dataModel,g,a)}f.bind();return f};coherent.VariableKeyPath=Class.create({constructor:function(b,a){this.keyPath=b;this.kvo=a},origKeyPath:function(){return this.keyPath},resolve:function(){return coherent.VariableKeyPath.resolve(this.keyPath,this.kvo)},variablePaths:function(){return coherent.VariableKeyPath.variableKeys(this.keyPath)}});coherent.VariableKeyPath.resolve=function(k,d){if("$"!==k.charAt(0)){throw new InvalidArgumentError("variable keypath isn't in correct format")}var a=k.substr(1).split("$"),h="",g={},c=d;for(var b=0;b<a.length;b++){var f=a[b];if(g[f]){h+=g[f]}else{if(f.length>0){if((f.charAt(0)!==".")&&(f.charAt(f.length-1)!==".")){f=c.valueForKeyPath(f);if("undefined"===typeof(f)||null===f){return undefined}}h+=f}}}return h};coherent.VariableKeyPath.variableKeys=function(c){var a=[],b={};c.substr(1).split("$").forEach(function(d){if(d.length>0&&d.charAt(0)!=="."&&d.charAt(d.length-1)!=="."){if(!b[d]){b[d]=true;a.push(d)}}});return a};coherent.VariableBinding=Class.create(coherent.Binding,{constructor:function(b,c,a){this.variableKeyPath=new coherent.VariableKeyPath(c,b);this.cachedVariablesMap={};this.base(b,c,a);this.observers={}},addObserver:function(a,d,b){var c=new coherent.ObserverEntry(a,d,b);c.vbuid=coherent.VariableBinding.observerId++;a.vbuid=c.vbuid;this.observers[c.vbuid]=c},removeObserver:function(a){delete this.observers[a.vbuid]},getObservers:function(){return this.observers},valueForResolvedKeyPath:function(a){if(null===a||"undefined"===typeof(a)||a.indexOf("undefined")!=-1){return undefined}return this.object.valueForKeyPath(a)},bind:function(){this.bindVariablePaths();this.bindResolvedPath()},bindVariablePaths:function(){for(var a in this.cachedVariablesMap){this.object.addObserverForKeyPath(this,this.observeChangeForVariablePath,a)}},bindResolvedPath:function(){this.object.addObserverForKeyPath(this,this.observeChangeForResolvedPath,this.cachedResolvedKey)},unbind:function(){this.unbindVariablePaths();this.unbindResolvedPath()},unbindVariablePaths:function(){for(var a in this.cachedVariablesMap){this.object.removeObserverForKeyPath(this,a)}},unbindResolvedPath:function(){this.object.removeObserverForKeyPath(this,this.cachedResolvedKey)},refresh:function(){this.refreshCacheForVariablePaths();this.refreshCacheForResolvedPath()},refreshCacheForVariablePaths:function(){this.variableKeyPath.variablePaths().forEach(function(a){this.cachedVariablesMap[a]=this.object.valueForKeyPath(a)},this)},refreshCacheForResolvedPath:function(){var b=this.resolvedKeyPathFromCache(),a=this.valueForResolvedKeyPath(b);this.cachedOriginalValue=a;this.cachedValue=a;this.cachedResolvedKey=b},resolvedKeyPathFromCache:function(){var a=this.cachedVariablesMap,b="";this.variableKeyPath.origKeyPath().substr(1).split("$").forEach(function(c){if(c.length>0){if(c.charAt(0)!=="."&&c.charAt(c.length-1)!=="."){b+=a[c]}else{b+=c}}});return b},observeChangeForVariablePath:function(g,f,a){this.unbindResolvedPath();this.cachedVariablesMap[f]=g.newValue;var c=this.resolvedKeyPathFromCache(),d=this.valueForResolvedKeyPath(c);this.cachedResolvedKey=c;var b=Object.clone(g);b.newValue=d;b.oldValue=this.cachedOriginalValue;this.observeChangeForResolvedPath(b,"",a);this.bindResolvedPath()},observeChangeForResolvedPath:function(c,b,a){this.observeChangeForKeyPath(c,this.variableKeyPath.origKeyPath(),a)}});coherent.VariableBinding.observerId=1;coherent.CompoundBinding=Class.create(coherent.Binding,{constructor:function(a,c,b){this.base();if(!a||!c||!b){throw new InvalidArgumentError("No parameters to CompoundBinding initialiser are optional")}this.operation=a;this.left=c;this.right=b;this.left.observerFn=this.right.observerFn=this.observeChange.bind(this);switch(this.operation){case coherent.CompoundBinding.AND:this.cachedValue=this.left.value()&&this.right.value();break;case coherent.CompoundBinding.OR:this.cachedValue=this.left.value()||this.right.value();break;default:throw new InvalidArgumentError("Unknown operation value for CompoundBinding");break}},bind:function(){this.left.bind();this.right.bind()},unbind:function(){this.left.unbind();this.right.unbind()},mutable:function(){return false},setValue:function(a){throw new Error("Attempting to set value of CompoundBinding")},observeChange:function(c,b){var a=this.cachedValue;switch(this.operation){case coherent.CompoundBinding.AND:this.cachedValue=this.left.value()&&this.right.value();break;case coherent.CompoundBinding.OR:this.cachedValue=this.left.value()||this.right.value();break;default:throw new Error("Unknown operation value for CompoundBinding");break}if(a===this.cachedValue){return}this.update()}});coherent.CompoundBinding.AND="&&";coherent.CompoundBinding.OR="||";Class.extend(Array,{containsObject:function(a){return -1!==this.indexOf(a)},valueForKey:function(c){if(!c||0===c.length){throw new InvalidArgumentError("the key is empty")}if("@count"==c){return this.length}var d=new Array(this.length);var b;var a=this.length;for(b=0;b<a;++b){d[b]=this[b].valueForKey(c)}return d},setValueForKey:function(d,c){if(!c||0===c.length){throw new InvalidArgumentError("key is empty")}var b;var a=this.length;for(b=0;b<a;++b){this[b].setValueForKey(d,c)}},indexesOfObjects:function(f){var d;var b=f.length;var a=[];var c;for(d=0;d<b;++d){c=this.indexOf(f[d]);if(-1===c){continue}a.push(c)}return a},addObject:function(b){var a=this.length;var c=new coherent.ChangeNotification(this,coherent.ChangeType.insertion,[b],null,[a]);this.push(b);this.observeElementAtIndex(a);this.notifyObserversOfChangeForKeyPath(c,coherent.KVO.kAllPropertiesKey)},addObjects:function(c){var b;var a=c.length;for(b=0;b<a;++b){this.addObject(c[b])}},insertObjectAtIndex:function(b,a){if(a<0||a>=this.length){throw new RangeError("index must be within the bounds of the array")}var c=new coherent.ChangeNotification(this,coherent.ChangeType.insertion,[b],null,[a]);this.splice(a,0,b);this.observeElementAtIndex(a);this.notifyObserversOfChangeForKeyPath(c,coherent.KVO.kAllPropertiesKey)},insertObjectsAtIndexes:function(f,c){if(f.length!==c.length){throw new InvalidArgumentError("length of objects and indexes parameters must be equal")}var a=f.length;var d;var b;for(d=0;d<a;++d){b=c[d];this.splice(b,0,f[d]);this.observeElementAtIndex(b)}var g=new coherent.ChangeNotification(this,coherent.ChangeType.insertion,f,null,c);this.notifyObserversOfChangeForKeyPath(g,coherent.KVO.kAllPropertiesKey)},replaceObjectAtIndex:function(c,b){var a=this[b];this[b]=c;var d=new coherent.ChangeNotification(this,coherent.ChangeType.replacement,[c],[a],[b]);this.notifyObserversOfChangeForKeyPath(d,coherent.KVO.kAllPropertiesKey)},replaceObjectsAtIndexes:function(g,d){var b=[];var a=g.length;var f;var c;for(f=0;f<a;++f){c=d[f];b[f]=this[c];this.stopObservingElementAtIndex(c);this[c]=g[f];this.observeElementAtIndex(c)}var h=new coherent.ChangeNotification(this,coherent.ChangeType.replacement,g,null,d);this.notifyObserversOfChangeForKeyPath(h,coherent.KVO.kAllPropertiesKey)},removeObject:function(b){var a=this.indexOf(b);if(-1===a){return}this.removeObjectAtIndex(a)},removeObjects:function(d){var a=d.length;var b;for(var c=0;c<a;++c){b=this.indexOf(d[c]);if(-1===b){continue}this.removeObjectAtIndex(b)}},removeObjectsAtIndexes:function(b){var a=b.length;for(var c=0;c<a;++c){this.removeObjectAtIndex(b[c])}},removeObjectAtIndex:function(b){if(b<0||b>=this.length){throw new RangeError("index must be within the bounds of the array")}this.stopObservingElementAtIndex(b);var a=this.splice(b,1);var c=new coherent.ChangeNotification(this,coherent.ChangeType.deletion,null,a,[b]);this.notifyObserversOfChangeForKeyPath(c,coherent.KVO.kAllPropertiesKey)},removeAllObjects:function(){var d;var c=[];var a=this.length;c.length=a;for(d=0;d<a;++d){this.stopObservingElementAtIndex(d);c[d]=d}var b=this.splice(0,a);var f=new coherent.ChangeNotification(this,coherent.ChangeType.deletion,null,b,c);this.notifyObserversOfChangeForKeyPath(f,coherent.KVO.kAllPropertiesKey)},objectsAtIndexes:function(c){var d;var b=[];var a=c.length;b.length=c.length;for(d=0;d<a;++d){b[d]=this[c[d]]}return b},observeChildObjectChangeForKeyPath:function(g,f,b){var d=g.object;var c=this.indexOf(d);if(!this.__uid){this.initialiseKeyValueObserving()}if(-1===c){d._removeParentLink(this,null,this.__uid);return}var a=new coherent.ChangeNotification(d,coherent.ChangeType.replacement,[g.newValue],[g.oldValue],[c]);this.notifyObserversOfChangeForKeyPath(a,f)},observeElementAtIndex:function(a){var b=this[a];if(!b||!b._addParentLink){return}if(!this.__uid){this.initialiseKeyValueObserving()}b._addParentLink(this,null,this.__uid)},stopObservingElementAtIndex:function(a){var b=this[a];if(!b||!b._removeParentLink){return}if(!this.__uid){this.initialiseKeyValueObserving()}b._removeParentLink(this,null,this.__uid)},initialiseKeyValueObserving:function(){var b;var a=this.length;this.__observers={};this.__uid=this.__uid||coherent.generateUid();for(b=0;b<a;++b){this.observeElementAtIndex(b)}},toJSON:function(){return this}});coherent.KVO.adapt(Array.prototype);coherent.ArrayOperator={avg:function(a){return this.sum(a)/a.length},count:function(a){throw new InvalidArgumentError("@count operator must end the keyPath")},distinctUnionOfArrays:function(a){return this.unionOfArrays(a).distinct()},distinctUnionOfObjects:function(a){return a.distinct()},max:function(d){var b=null;var f;var a;var c;for(f=0,a=d.length;f<a;++f){c=d[f];if(null===b||c>b){b=c}}return b},min:function(c){var f=null;var d;var a;var b;for(d=0,a=c.length;d<a;++d){b=c[d];if(null===f||b<f){f=b}}return f},sum:function(b){var d=0;var a=b.length;var c;for(c=0;c<a;++c){d+=b[c]}return d},unionOfArrays:function(b){var d=[];var a;var c;for(c=0,a=b.length;c<a;++c){d=d.concat(b[c])}return d},unionOfObjects:function(a){return a}};coherent.KVOTable=Class.create(coherent.KVO,{valueForKeyPath:function(a){if("array"===coherent.typeOf(a)){a=a.join(".")}return this.valueForKey(a)},setValueForKeyPath:function(a,b){if("array"===coherent.typeOf(b)){b=b.join(".")}return this.setValueForKey(a,b)},infoForKeyPath:function(a){if("array"===coherent.typeOf(a)){a=a.join(".")}return this.infoForKey(a)}});coherent.Scripts={extract:function(b){var c=RegExp("(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)","img");var a=[];var d=new String(b.replace(c,function(){a.push(arguments[1]);return""}));d.scripts=a;return d},install:function(a){if(!a){return}function b(g){if(!g||!g.length){return}if(window.execScript){window.execScript(g)}else{var c=document.createElement("script");var f=document.createTextNode(g);c.appendChild(f);c.type="text/javascript";c.defer=false;var d=document.getElementsByTagName("head").item(0);d.appendChild(c)}}if("string"===typeof(a)){b(a);return}a.forEach(b)}};Element.colours={black:"#000000",white:"#ffffff"};if(coherent.Browser.IE){Element.setStyle=function(a,f,d){if("opacity"!=f){a.style[f]=d;return}var c=a.style.filter;var b=a.style;if(d==1||d===""){b.filter=c.replace(/alpha\([^\)]*\)/gi,"");return}if(d<0.00001){d=0}b.filter=c.replace(/alpha\([^\)]*\)/gi,"")+"alpha(opacity="+(d*100)+")"};Element.setStyles=function(a,b){var c=a.style;for(var d in b){if("opacity"==d){Element.setStyle(a,d,b[d])}else{c[d]=b[d]}}};Element.getStyles=function(f,c){var b=f.currentStyle;function l(n){var m=0;if("width"===n){m+=parseInt(b.borderLeftWidth,10)||0+parseInt(b.borderRightWidth,10)||0+parseInt(b.paddingLeft,10)||0+parseInt(b.paddingRight,10)||0;return Math.max(0,f.offsetWidth-m)+"px"}else{m+=parseInt(b.borderTopWidth,10)||0+parseInt(b.borderBottomWidth,10)||0+parseInt(b.paddingTop,10)||0+parseInt(b.paddingBottom,10)||0;return Math.max(0,f.offsetHeight-m)+"px"}}var k={};var g;if("string"===typeof(c)){if("opacity"===c){g=b.filter.match(/opacity=(\d+)/i);return(null===g?1:parseInt(g[1],10)/100)}if(c=="height"||c=="width"){return l(c)}else{if(a=="backgroundPosition"){return b.backgroundPositionX+" "+b.backgroundPositionY}else{return b[c]}}}c=c||Element.PROPERTIES;var a;var h=c.length;for(var d=0;d<h;++d){a=c[d];if("opacity"===a){g=b.filter.match(/opacity=(\d+)/i);k[a]=(null===g?1:parseInt(g[1],10)/100)}else{if(a==="height"||a==="width"){k[a]=l(a)}else{if(a==="backgroundPosition"){k[a]=b.backgroundPositionX+" "+b.backgroundPositionY}else{k[a]=b[a]}}}}return k};Element.getStyle=Element.getStyles;Element.noScopeElements=["<style","<script","<link","&lt;style","&lt;script","&lt;link"];Element.setInnerHTML=function(a,b){Element.innerHTML(a,b,false)};Element.appendInnerHTML=function(a,b){Element.innerHTML(a,b,true)};Element.innerHTML=function(c,d,b){d=String.stringify(d);d=d.escapeForInnerHTML();var a=this.noScopeElements.some(function(f){return(d.indexOf(f)!==-1)});if(a){if(b){c.innerHTML='<input type="hidden"/>'+c.innerHTML+d}else{c.innerHTML='<input type="hidden"/>'+d}c.removeChild(c.firstChild)}else{if(b){c.innerHTML+=d}else{c.innerHTML=d}}};Element.clone=function(c){var d=c.cloneNode(false);if("TR"!=c.tagName){d.innerHTML=c.innerHTML;return d}var b;var a;var f;for(b=0;b<c.children.length;++b){a=c.children[b];f=a.cloneNode(false);f.id="";f.innerHTML=a.innerHTML;d.appendChild(f)}return d}}if(coherent.Browser.IE){Object.extend(Event,{preventDefault:function(a){a.returnValue=false},onDomReady:function(b){var c;function a(){try{document.documentElement.doScroll("left");document.body.firstChild;document.namespaces}catch(d){c=a.delay(1);return}Event._domHasFinishedLoading()}if(Event._domHasFinishedLoading.done){window.setTimeout(b,0);return}if(!Event._readyCallbacks){c=a.delay(1);Event.observe(window,"load",Event._domHasFinishedLoading);Event._readyCallbacks=[]}Event._readyCallbacks.push(b)}});if(!window.addEventListener){Object.extend(Event,{observe:function(c,a,b){if("on"!=a.slice(0,2)){a="on"+a}c.attachEvent(a,b)},stopObserving:function(c,a,b){if("on"!=a.slice(0,2)){a="on"+a}c.detachEvent(a,b)},stop:function(a){a=a||window.event;a.returnValue=false;a.cancelBubble=true}})}}coherent.Formatter=Class.create({invalidValueMessage:_("error.invalid_value"),constructor:function(a){Object.extend(this,a)},stringForValue:function(a){if(null===a||"undefined"===typeof(a)){return""}return String(a)},valueForString:function(a){return a},isStringValid:function(a){return true},isValidInputCharacter:function(a){return true}});coherent.NumberFormatter=Class.create(coherent.Formatter,{invalidValueMessage:_("error.invalid_number"),validFloatCharacters:"0123456789.-",validIntCharacters:"0123456789-",allowsFloats:true,stringForValue:function(a){if(null===a||"undefined"===typeof(a)){return""}return String(a)},valueForString:function(a){if(this.allowsFloats){return parseFloat(a)}else{return parseInt(a,10)}},isStringValid:function(a){var c=this.valueForString(a);var b=!isNaN(c);if(b&&!isNaN(this.minimum)){b=(c>=this.minimum)}if(b&&!isNaN(this.maximum)){b=(c<=this.maximum)}if(b){return true}return new coherent.Error({description:this.invalidValueMessage})},isValidInputCharacter:function(a){if(this.allowsFloats){return(-1!==this.validFloatCharacters.indexOf(a))}else{return(-1!==this.validIntCharacters.indexOf(a))}}});coherent.RegexFormatter=Class.create(coherent.Formatter,{constructor:function(a){this.base(a);this.typeofValidCharacters=typeof(this.validCharacters);if(this.invalidRegex&&"exec" in this.invalidRegex){this.invalidRegex=[this.invalidRegex]}if(this.validRegex&&"exec" in this.validRegex){this.validRegex=[this.validRegex]}},isStringValid:function(b){var c;var a;var f;var d=true;if(this.invalidRegex&&this.invalidRegex.length){f=this.invalidRegex;for(c=0,a=f.length;c<a;++c){if(f[c].test(b)){d=false;break}}}if(d&&this.validRegex&&this.validRegex.length){d=false;f=this.validRegex;for(c=0,a=f.length;c<a;++c){if(f[c].test(b)){d=true;break}}}if(d){return true}return new coherent.Error({description:this.invalidValueMessage})},isValidInputCharacter:function(a){if(!this.validCharacters){return true}if("string"===this.typeofValidCharacters){return(-1!==this.validCharacters.indexOf(a))}else{return this.validCharacters.test(a)}}});coherent.easing=(function(){var b=Math.PI/2;var a=Math.PI;return{linear:function(c){return c},cubicBezier:function(g,d,u,r,n){var o=3*g,q=3*(u-g)-o,c=1-o-q,m=3*d,p=3*(r-d)-m,v=1-m-p,t;function l(w){return((c*w+q)*w+o)*w}function k(w){return((v*w+p)*w+m)*w}function f(w){return(3*c*w+2*q)*w+o}function h(w,E){var D=0,C=1,A=w,y,B,z=8;while(z--){y=l(A)-w;if(Math.abs(y)<E){return A}B=f(A);if(Math.abs(B)<0.000001){break}A=A-y/B}A=w;if(A<D){return D}if(A>C){return C}while(D<C){y=l(A);if(Math.abs(y-w)<E){return A}if(w>y){D=A}else{C=A}A=(C-D)*0.5+D}return A}n=n/1000||5;t=function(w){return k(h(w,1/(200*n)))};t.timingFunction="cubic-bezier";t.p1x=g;t.p1y=d;t.p2x=u;t.p2y=r;return t},ease:function(d){var c=coherent.easing.cubicBezier(0.25,0.1,0.25,1,d);c.timingFunction="ease";return c},easeIn:function(d){var c=coherent.easing.cubicBezier(0.42,0,1,1,d);c.timingFunction="ease-in";return c},easeOut:function(d){var c=coherent.easing.cubicBezier(0,0,0.58,1,d);c.timingFunction="ease-out";return c},easeInOut:function(d){var c=coherent.easing.cubicBezier(0.42,0,0.58,1,d);c.timingFunction="ease-in-out";return c},linearCompleteAndReverse:function(c){return(c>0.5)?2-2*c:2*c},inSine:function(c){return 1-Math.cos(c*b)},outSine:function(c){return Math.sin(c*b)},inOutSine:function(c){return(1-Math.cos(c*a))/2},inBack:function(c,d){if(d==undefined){d=1.70158}return c*c*((d+1)*c-d)},outBack:function(c,d){if(d==undefined){d=1.70158}c=c-1;return(c*c*((d+1)*c+d)+1)},outBackStrong:function(c,d){if(d==undefined){d=1.70158*1.5}c=c-1;return(c*c*((d+1)*c+d)+1)},inOutQuad:function(c){if((c/=1/2)<1){return 1/2*c*c}return -1/2*((--c)*(c-2)-1)}}})();coherent.Animator=function(){var a={duration:500,actions:{}};var m=null;var B={};var b=0;var g=Element.getStyles;function d(F,E,I){var H={};I=I||{};function G(J){if(!J||J.tagName.toUpperCase()=="PARAM"){return false}var K=Element.assignId(J);H[K]=g(J,E);if(I[K]){return false}}Element.depthFirstTraversal(F,G);return H}function u(){return[this.r,this.g,this.b,this.a].join(",")}function q(E){if(typeof(E)!="string"){return E}var F;if((F=Element.colours[E.toLowerCase()])){E=F}if((F=E.match(/^rgb(?:a)?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d(?:\.\d+)?)\s*)?\)$/i))){return{r:parseInt(F[1],10),g:parseInt(F[2],10),b:parseInt(F[3],10),a:parseInt(F[4]||1,10),toString:u}}if("#"!==E.charAt(0)){if(E=="transparent"){return{r:255,g:255,b:255,a:0}}throw new Error("Invalid colour: "+E)}if(4==E.length){return{r:parseInt(E.charAt(1)+E.charAt(1),16),g:parseInt(E.charAt(2)+E.charAt(2),16),b:parseInt(E.charAt(3)+E.charAt(3),16),a:1,toString:u}}else{return{r:parseInt(E.substr(1,2),16),g:parseInt(E.substr(3,2),16),b:parseInt(E.substr(5,2),16),a:1,toString:u}}}function p(E){if("margin" in E){E.marginLeft=E.marginRight=E.marginTop=E.marginBottom=E.margin;delete E.margin}if("padding" in E){E.paddingLeft=E.paddingRight=E.paddingTop=E.paddingBottom=E.padding;delete E.padding}if("borderColor" in E){E.borderLeftColor=E.borderRightColor=E.borderTopColor=E.borderBottomColor=E.borderColor;delete E.borderColor}if("borderWidth" in E){E.borderLeftWidth=E.borderRightWidth=E.borderTopWidth=E.borderBottomWidth=E.borderWidth;delete E.borderWidth}return E}function t(H,F,I,E,G){this.property=H;this.element=F;this.start=q(I);this.end=q(E);if(coherent.Support.CSS3ColorModel){if(this.start.a===0){this.start.r=this.end.r;this.start.g=this.end.g;this.start.b=this.end.b}else{if(this.end.a===0){this.end.r=this.start.r;this.end.g=this.start.g;this.end.b=this.start.b}}this.step=this.stepRGBA}else{this.step=this.stepRGB}this.delta={r:this.end.r-this.start.r,g:this.end.g-this.start.g,b:this.end.b-this.start.b,a:this.end.a-this.start.a};this.shouldCleanup=!!G}t.prototype.stepRGB=function(F){if(this.curve){F=this.curve(F)}var E=["rgb(",Math.round(F*this.delta.r+this.start.r),",",Math.round(F*this.delta.g+this.start.g),",",Math.round(F*this.delta.b+this.start.b),")"].join("");this.element.style[this.property]=E};t.prototype.stepRGBA=function(F){if(this.curve){F=this.curve(F)}var E=["rgba(",Math.round(F*this.delta.r+this.start.r),",",Math.round(F*this.delta.g+this.start.g),",",Math.round(F*this.delta.b+this.start.b),",",F*this.delta.a+this.start.a,")"].join("");this.element.style[this.property]=E};t.prototype.cleanup=function(){this.element.style[this.property]=""};function l(H,F,I,E,G){this.property=H;this.element=F;this.start=parseInt(I||0,10);this.end=parseInt(E||0,10);this.delta=this.end-this.start;this.shouldCleanup=!!G}l.prototype.step=function(E){if(this.curve){E=this.curve(E)}this.element.style[this.property]=Math.round(E*this.delta+this.start)+"px"};l.prototype.cleanup=function(){this.element.style[this.property]=""};function y(F,H,E,G){this.element=F;this.start=parseFloat(H||0);this.end=parseFloat(E||0);this.delta=E-H;this.shouldCleanup=!!G}var h=(typeof document.createElement("div").style.opacity!="undefined");if(h){y.prototype.step=function(F){if(this.curve){F=this.curve(F)}var E=F*this.delta+this.start;this.element.style.opacity=(E>=1)?1:E.toFixed(3)};y.prototype.cleanup=function(){this.element.style.opacity=""}}else{if(coherent.Browser.IE){y.prototype.step=function(F){if(this.curve){F=this.curve(F)}var E=F*this.delta+this.start;this.element.style.filter=(E>=1)?"":"Alpha(Opacity="+Math.round(E*100)+")"};y.prototype.cleanup=function(){this.element.style.cssText=this.element.style.cssText.replace(/filter:.*?(?:;|$)/i,"")}}}function z(H,F,I,E,G){this.property=H;this.element=F;this.start=I;this.end=E;this.shouldCleanup=!!G}z.prototype.step=function(E){if(E>=this.discreteTransitionPoint){this.element.style[this.property]=this.end;this.step=function(F){}}};z.prototype.cleanup=function(){this.element.style[this.property]=""};function n(F,G,E){this.element=F;this.start=G;this.end=E}n.prototype.step=function(E){if(E>=this.discreteTransitionPoint){this.element.className=this.end;this.step=function(F){}}};function w(I,L,F,K){function J(M){switch(M){case"top":return"0% 50%";case"right":return"100% 50%";case"bottom":return"50% 100%";case"left":return"0% 50%";case"center":return"50% 50%";default:M=M.replace(/top|left/g,"0%");M=M.replace(/bottom|right/g,"100%");return M}}function G(M){return parseInt(M,10)}L=J(L);F=J(F);var H=L.match(/%|px/)[0];var E=F.match(/%|px/)[0];if(H!=E){return new z("backgroundPosition",I,L,F,K)}this.element=I;this.unit=H;this.start=Array.map(L.split(" "),G);this.end=Array.map(F.split(" "),G);this.delta=[this.end[0]-this.start[0],this.end[1]-this.start[1]];this.shouldCleanup=!!K;return this}w.prototype.step=function(E){if(this.curve){E=this.curve(E)}this.element.style.backgroundPosition=Math.round(E*this.delta[0]+this.start[0])+this.unit+" "+Math.round(E*this.delta[1]+this.start[1])+this.unit};w.prototype.cleanup=function(){if(coherent.Browser.IE){this.element.style.backgroundPositionX="";this.element.style.backgroundPositionY=""}else{this.element.style.backgroundPosition=""}};function c(F,H,E,G){this.element=F;this.startX=parseInt(H[0]||0,10);this.endX=parseInt(E[0]||0,10);this.startY=parseInt(H[1]||0,10);this.endY=parseInt(E[1]||0,10);this.deltaX=this.endX-this.startX;this.deltaY=this.endY-this.startY;this.shouldCleanup=!!G}c.prototype.step=function(E){if(this.curve){E=this.curve(E)}this.element.scrollTo(Math.round(E*this.deltaX+this.startX),Math.round(E*this.deltaY+this.startY))};c.prototype.cleanup=function(){this.element.scrollTo(this.startX,this.startY)};function A(H,F,I,E,G){switch(H){case"_className":return new n(F,I,E);case"display":return new z(H,F,I,E,G);case"backgroundPosition":return new w(F,I,E,G);case"backgroundColor":case"color":case"borderColor":case"borderTopColor":case"borderRightColor":case"borderBottomColor":case"borderLeftColor":return new t(H,F,I,E,G);case"opacity":return new y(F,I,E,G);case"scroll":return new c(F,I,E,G);default:return new l(H,F,I,E,G)}}function C(G,J){var I=[];var H=B[G];if(!H||!H.properties[J]){return}var E=H.properties[J].shift();if(E.shouldCleanup&&"function"===typeof(E.cleanup)){E.cleanup()}if("function"==typeof(E.callback)){I.push(E.callback)}if(!H.properties[J].length){delete H.properties[J];H.propCount--}if(!H.propCount){if("function"==typeof(B[G]._callback)){I.push(H._callback)}delete (B[G]);b--}if(!b){r()}var F=I.length;for(var K=0;K<F;K++){I[K](document.getElementById(G),J)}}function k(){if(m){return}m=window.setInterval(f,10)}function r(){if(!m){return}window.clearInterval(m);m=null}function f(){var F,H,I,E,G=(new Date()).getTime();coherent.EventLoop._start=G;for(F in B){H=B[F].properties;for(I in H){E=H[I][0];if(G>=E.endTime){E.step(1);C(F,I)}else{if(E.startTime<=G){E.step((G-E.startTime)/E.totalTime)}}}}}function o(H,G,J){J=Object.applyDefaults(J,a);if(J.delay){arguments.callee.delay(J.delay,H,G,J);delete J.delay;return}var P=Element.assignId(H);var I=B[P];if(!I){b++;I=B[P]={_node:H,propCount:0,properties:{},timers:{}}}if("function"==typeof(J.callback)){I._callback=J.callback}var F=J.startTime||coherent.EventLoop.getStart();var E=F+J.duration;var W=J.startStyles||g(H,Set.toArray(G));p(G);for(var R in G){var N=G[R],X=N.delay||0,M=F+X,K=N.duration?N.duration+M:E,S=N,Q=N.curve||J.curve,V=N.discreteTransitionPoint||J.discreteTransitionPoint||0.5,O=typeof(N.cleanup)!=="undefined"?N.cleanup:J.cleanup,L;if("object"===typeof(S)&&"value" in S){S=S.value}if(R in I.properties){L=I.properties[R]}else{I.propCount++;L=[]}function U(ab,ac,Y){var aa=ac.startTime<K&&ac.endTime>K;var Z=ac.startTime<M&&ac.endTime>M;var ad=ac.startTime<=M&&ac.endTime>=K;if(!(Z||aa||ad)){ab.push(ac)}return ab}if(L.length){L=L.reduce(U,[])}var T=A(R,H,W[R],S,O);T.curve=Q;T.discreteTransitionPoint=V;T.startTime=M;T.endTime=K;T.totalTime=K-M;if("object"===typeof(N)&&"callback" in N){T.callback=N.callback}if(J.stepBackToZero){T.step(0)}L.push(T);I.properties[R]=L}k()}function v(E){var F=Element.assignId(E);return !!document.getElementById(F)}function D(N,R,S){var P=B[N.id];if(N.className===R&&(!P||!P._className||P._className.value===R)){if(S.callback){S.callback()}return}S=Object.applyDefaults(S,a);if(S.delay){arguments.callee.delay(S.delay,N,R,S);delete S.delay;return}if(!v(N)){N.className=R;if(S.callback){S.callback()}return}var M=S.only;var I=d(N,M,S.ignore);var G=N.className;N.className=R;for(var F in I){var L=B[F];if(!L){continue}for(var E in L.properties){L._node.style[E]=""}}var K=d(N,M,S.ignore);N.className=G;var Q={};Q[N.id]={_className:{value:R,duration:S.duration,callback:S.callback}};delete S.callback;function O(W){var V=W.id;var Y=S.actions[V];var ab=I[V]||{};var ac=K[V]||{};var ae={};if(!Y){var ad=ab.display;var aa=ac.display;if(ad=="none"&&aa=="none"){Y=coherent.Animator.IGNORE_NODE}if(ad=="none"&&aa!=="none"){Y=coherent.Animator.FADE_IN_NODE}if(ad!=="none"&&aa=="none"){Y=coherent.Animator.FADE_OUT_NODE}}if("function"===typeof(Y)){Y=Y(W,I,K)}if("object"==typeof(Y)){ae=Y;Y=coherent.Animator.MORPH_NODE}switch(Y){case coherent.Animator.IGNORE_NODE:return false;case coherent.Animator.FADE_NODE:Q[V]=Q[V]||{};Q[V].opacity={value:"0",duration:S.duration,curve:coherent.easing.linearCompleteAndReverse};return false;case coherent.Animator.FADE_OUT_NODE:document.getElementById(V).style.display="block";Q[V]=Q[V]||{};Q[V].opacity={value:"0",duration:S.duration/2,cleanup:false,callback:function(){document.getElementById(V).style.display=""}};return false;case coherent.Animator.FADE_IN_NODE:ab.opacity=0;document.getElementById(V).style.display="block";Q[V]=Q[V]||{};Q[V].opacity={value:"1",duration:S.duration/2,delay:S.duration/2,callback:function(){document.getElementById(V).style.display=""}};return false;case coherent.Animator.MORPH_NODE:default:for(var U in ab){var X=B[V];var Z=ae[U];var T=Z?(Z.value||Z):ac[U];if((X&&U in X.properties)||(String(ab[U])!=String(T))){Q[V]=Q[V]||{};if(U in ae){if(Z.value){Q[V][U]=Z}else{Q[V][U]={value:Z}}Q[V][U].cleanup=false}else{Q[V][U]=T}}}return true}}Element.depthFirstTraversal(N,O);S.stepBackToZero=true;S.cleanup=true;S.startTime=(new Date()).getTime();for(var H in Q){var J=document.getElementById(H);if(!J){continue}S.startStyles=I[H];o(J,Q[H],S)}}function x(G,E){var F=Element.regexForClassName(E);return G.replace(F," ")}return{actors:function(){return B},addClassName:function(F,G,E){if(!G){return}var H=Element.regexForClassName(G);var I=F.className;if(!H.test(I)){if(I){I+=" "+G}else{I=G}}D(F,I,E)},removeClassName:function(F,G,E){var I=F.className;var H;if(I===G){D(F,"",E);return}if("string"===typeof(G)){I=x(I,G)}else{I=G.reduce(x,I)}D(F,I,E)},setClassName:function(F,G,E){var H=F.className;D(F,G,E)},replaceClassName:function(H,G,E,F){if(G){var I=Element.regexForClassName(G);E=H.className.replace(I,"$1"+E+"$2")}else{E=H.className+" "+E}D(H,E,F)},setStyles:o,abort:function(){B={};r()},abortAnimation:function(E){delete B[E.id]}}}();coherent.Animator.FADE_NODE="fade";coherent.Animator.FADE_IN_NODE="fade_in";coherent.Animator.FADE_OUT_NODE="fade_out";coherent.Animator.IGNORE_NODE="ignore";coherent.Animator.MORPH_NODE="morph";coherent.Animator.innerHTML=function(b,a,d){d=d||500;function f(){var k=b.innerHTML;var l=Element.getStyles(b,"height");Element.setInnerHTML(b,a);var h=Element.getStyles(b,"height");Element.setInnerHTML(b,k);b.style.height=l;b.style.overflow="hidden";coherent.Animator.setStyles(b,{opacity:{value:0,callback:c}},{duration:d/2});coherent.Animator.setStyles(b,{height:{value:h,curve:coherent.easing.inOutSine}},{duration:d,cleanup:true})}function c(){Element.setInnerHTML(b,a);coherent.Animator.setStyles(b,{opacity:1},{duration:d/2,callback:g,cleanup:true})}function g(){b.style.overflow=""}if(b.style.display!="none"){f()}else{b.innerHTML=a}};coherent.Animator.innerText=function(b,f,d){d=d||500;function a(h){var g=document.createTextNode(h);b.innerHTML="";b.appendChild(g)}function c(){a(f);coherent.Animator.setStyles(b,{opacity:1},{duration:d/2,cleanup:true})}if(b.style.display!="none"){coherent.Animator.setStyles(b,{opacity:0},{duration:d/2,callback:c})}else{a(f)}};coherent.Animator.scrollTo=function(b,d){var a=Element.getViewport(),g=(window.height||document.body.scrollHeight)-a.height,c=b,f,h;if(typeof b=="string"){f=document.getElementById(b.replace("#",""))}else{if("nodeName" in b){f=b}}if(f){h=Element.getRect(f);c=[a.left,Math.min(g,h.top)]}d=Object.applyDefaults({duration:375,curve:coherent.easing.cubicBezier(0.175,0.9,0.2,1,375),startStyles:{scroll:[a.left,a.top]},callback:function(){if(f&&f.id){window.location.hash="#"+f.id}}},d);coherent.Animator.setStyles(window,{scroll:c},d)};var CancelledError=coherent.defineError("CancelledError");var InvalidStateError=coherent.defineError("InvalidStateError");(function(){var c=-1;var a=0;var b=1;coherent.Deferred=Class.create({constructor:function(d){this.canceller=d;this._result=null;this._status=c;this._callbacks=[]},_fire:function(d){while(this._callbacks.length){this._status=(d instanceof Error)?b:a;this._result=d;var f=this._callbacks.shift()[this._status];if(!f){continue}d=f(d);if(d instanceof coherent.Deferred){var g=this;function h(k){g._fire(k);return k}d.addMethods(h,h);return}}this._status=(d instanceof Error)?b:a;this._result=d},result:function(){return this._result},cancel:function(){if(c!==this._status){throw new InvalidStateError("Can not cancel Deferred because it is already complete")}var d=(this.canceller&&this.canceller());if(!(d instanceof Error)){d=new CancelledError("Deferred operation cancelled")}this.failure(d)},addMethods:function(d,f){this._callbacks.push([d,f]);if(c===this._status){return this}this._fire(this._result);return this},addCallback:function(d){return this.addMethods(d,null)},addErrorHandler:function(d){return this.addMethods(null,d)},callback:function(d){if(c!==this._status){throw new InvalidStateError("Can not signal callback because Deferred is already complete: result="+d)}this._fire(d)},failure:function(d){if(c!==this._status){throw new InvalidStateError("Can not signal failure because Deferred is already complete: error="+d)}this._fire(d)}})})();coherent.URL=Class.create({constructor:function(b){this.url=b.trim();var c=(/^(([^\:\/\?#]+)\:)?(\/\/([^\/\?#]*))?([^\?#]*)(\?([^#]*))?(#(.*))?$/),a=this.url.match(c)||[];this.protocol=a[2]||"";this.authority=a[4]||"";this.path=a[5].trim()||"";this.query=a[7]||"";this.fragment=a[9]||"";c=(/^(([^@]+)@)?([^\:]+)(:(.+))?$/);a=this.authority.match(c)||[];this.userInfo=a[2]||"";this.host=a[3]||"";this.port=a[5]||""},toHash:function(a){var b=this.query.split("&").map(function(d){return escape(d)}),c=typeof a!=="undefined"?a:",";b.sort();return[this.protocol,this.authority,this.path,b,this.fragment].join(c)}});coherent.FormControl=Class.create(coherent.View,{exposedBindings:["value","name"],init:function(){this.base();var a=this.viewElement();var b=this.bindings;if(b.value&&!b.value.hasValue()&&a.value){b.value.setValue(a.value)}if(b.name&&!b.name.hasValue()&&a.name){b.name.setValue(a.name)}},observeValueChange:function(c){var a=this.viewElement();var b=c.newValue;if("undefined"===typeof(b)){a.disabled=true}else{if(!this.bindings.enabled){a.disabled=false}}if(!this.bindings.editable){a.readOnly=!this.bindings.value.mutable()||coherent.Markers.MultipleValues===b||coherent.Markers.NoSelection===b}if(a.readOnly){Element.addClassName(a,coherent.Style.kReadOnlyClass)}else{Element.removeClassName(a,coherent.Style.kReadOnlyClass)}if(a.disabled){Element.addClassName(a,coherent.Style.kDisabledClass)}else{Element.removeClassName(a,coherent.Style.kDisabledClass)}a.value=b},observeNameChange:function(d,c,b){var a=this.viewElement();a.name=d.newValue},validate:function(){return this.viewElement().value}});coherent.Button=Class.create(coherent.FormControl,{__viewClassName__:"Button",__tagSpec__:["input[type=button]","input[type=submit]","input[type=reset]","button"],requireBindingsForInferredViewType:false,onmousedown:function(b){var a=this.viewElement();Element.addClassName(a,coherent.Style.kActiveClass)},onmouseup:function(b){var a=this.viewElement();Element.removeClassName(a,coherent.Style.kActiveClass)},onclick:function(a){if(this.disabled){Event.stop(a);return}this.sendAction()}});coherent.EventLoop={currentEvent:null,getStart:function(){if(!this._start){this._start=new Date().getTime()}return this._start},begin:function(a){this._start=new Date().getTime();this.currentEvent=a},end:function(){this.currentEvent=null;this._start=null}};coherent.Form=Class.create(coherent.FieldGroup,{exposedBindings:["actionUrl","method"],sendActionOn:["submit"],init:function(){this.base();var a=this.viewElement();var b=this.bindings;if(b.actionUrl&&!b.actionUrl.hasValue()&&a.action){b.actionUrl.setValue(a.action)}if(b.method&&!b.method.hasValue()&&a.method){b.method.setValue(a.method)}Event.observe(a,"submit",this.onsubmit.bind(this))},onsubmit:function(a){if(!this.action||!this.sendActionOn.containsObject("submit")){return}Event.stop(a);this.sendAction()},observeActionUrlChange:function(d,c,b){var a=this.viewElement();a.action=d.newValue},observeMethodChange:function(d,c,b){var a=this.viewElement();a.method=d.newValue}});coherent.ImageView=Class.create(coherent.View,{__viewClassName__:"Image",__tagSpec__:["img","input[type=image]"],exposedBindings:["src","alt","width","height"],multipleValuesPlaceholder:_("marker.image.multipleValues"),nullPlaceholder:_("marker.image.placeholder"),noSelectionPlaceholder:_("marker.image.noSelection"),init:function(){this.base();var a=this.viewElement();Event.observe(a,"error",this.onerror.bind(this));Event.observe(a,"load",this.onload.bind(this));var b=this.bindings;if(b.src&&!b.src.hasValue()&&a.src){b.src.setValue(a.src)}if(b.alt&&!b.alt.hasValue()&&a.alt){b.alt.setValue(a.alt)}if(b.width&&!b.width.hasValue()&&a.width){b.width.setValue(a.width)}if(b.height&&!b.height.hasValue()&&a.height){b.height.setValue(a.height)}},onload:function(){var a=this.viewElement();this.setValueForKey(false,"loading");Element.removeClassName(a,coherent.Style.kLoadingClass)},onerror:function(){var a=this.viewElement();this.setValueForKey(false,"loading");Element.updateClass(a,coherent.Style.kInvalidValueClass,coherent.Style.kLoadingClass)},src:function(){var a=this.viewElement().src;return("about:blank"===a)?null:a},setSrc:function(c){if(this.bindings.src){this.bindings.src.setValue(c)}this.setValueForKey(true,"loading");var b=this.viewElement();Element.updateClass(b,coherent.Style.kLoadingClass,coherent.Style.kInvalidValueClass);if(!c){c="about:blank"}var a=b.src;b.src=c;if(coherent.Browser.Safari&&b.src===a){this.onload()}},observeSrcChange:function(f){var c=this;var a=this.viewElement();var d=f.newValue;var b=true;switch(d){case"":case null:case undefined:d=this.attributeOrProperty("nullPlaceholder");break;case coherent.Markers.NoSelection:d=this.attributeOrProperty("noSelectionPlaceholder");break;case coherent.Markers.MultipleValues:d=this.attributeOrProperty("multipleValuesPlaceholder");break;default:b=false;break}if(b){Element.addClassName(a,coherent.Style.kMarkerClass)}else{Element.removeClassName(a,coherent.Style.kMarkerClass)}this.setSrc(d)},observeWidthChange:function(c){var a=this.viewElement();var b=parseInt(c.newValue,10);if(isNaN(b)){a.removeAttribute("width")}else{a.width=b}},observeAltChange:function(c){var a=this.viewElement();var b=c.newValue;if(b===null||"undefined"===typeof(b)){a.alt=""}else{a.alt=b}},observeHeightChange:function(c){var b=this.viewElement();var a=parseInt(c.newValue,10);if(isNaN(a)){b.removeAttribute("height")}else{b.height=a}}});coherent.Media=Class.create(coherent.View,{exposedBindings:["src","currentTime","volume","muted"],init:function(){var a=this.viewElement();var b=this.bindings;if(b.src&&!b.src.hasValue()&&a.src){b.src.setValue(a.src)}if(b.currentTime&&!b.currentTime.hasValue()){b.currentTime.setValue(a.currentTime)}if(b.duration&&!b.duration.hasValue()){b.duration.setValue(a.duration)}if(b.volume&&!b.volume.hasValue()){b.volume.setValue(a.volume)}if(b.muted&&!b.muted.hasValue()){b.muted.setValue(a.muted)}Event.observe(a,"ended",this.mediaDidEnd.bindAsEventListener(this))},pause:function(){var a=this.viewElement();if(!a.paused){a.pause()}},play:function(){var a=this.viewElement();a.play();this.forceChangeNotificationForKey("ended")},stop:function(){var a=this.viewElement();a.currentTime=a.duration},muted:function(){var a=this.viewElement();return a.muted},mediaDidEnd:function(a){this.forceChangeNotificationForKey("ended")},ended:function(){var a=this.viewElement();return a.ended},src:function(){var a=this.viewElement();return a.src},setSrc:function(c){if(this.bindings.src){this.bindings.src.setValue(c)}var b=this.viewElement();var d=this;function a(){b.src=c;b.load();d.forceChangeNotificationForKey("ended")}a.delay(0)}});coherent.Page=Class.create(coherent.Responder,{constructor:function(){this.firstResponder=null;this.__hoverTrackingIds={};this._onmousedragHandler=this._onmousedrag.bindAsEventListener(this);this._delegates={click:[]};this.onclick=this._fireDelegates},targetViewForEvent:function(c){var b=c.target||c.srcElement;var a;var d=coherent.View.fromNode;while(b&&b!=document&&!(a=d(b))){b=b.parentNode}if(!b||b==document){return null}return a},makeFirstResponder:function(a){if(this.firstResponder==a){return true}if(this.firstResponder&&!this.firstResponder.resignFirstResponder()){return false}if(this.firstResponder){Element.removeClassName(this.firstResponder.viewElement(),coherent.Style.kFocusClass)}if(a&&!a.becomeFirstResponder()){return false}this.willChangeValueForKey("firstResponder");this.firstResponder=a;this.didChangeValueForKey("firstResponder");if(a){a.focus();Element.addClassName(a.viewElement(),coherent.Style.kFocusClass)}return true},addTrackingInfo:function(c,b){if("string"!==typeof(c)){c=Element.assignId(c)}var a=this.__hoverTrackingIds[c];if(!a){a=this.__hoverTrackingIds[c]=[]}a.push(b)},superview:function(){return null},presentError:function(a){function b(){var c=a.description;if(a.recoverySuggestion){c+="\n"+a.recoverySuggestion}window.alert(c);coherent.page.makeFirstResponder(a.field)}b.delay(0)},delegate:function(a,c,b){if("string"===typeof(c)){this._delegates[c].push({sel:a,fn:b})}else{var d;for(d in c){if(!(d in this._delegates)){throw new Error("Invalid delegation event type: "+d)}this._delegates[d].push({sel:a,fn:c[d]})}}},superview:function(){return null},_fireDelegates:function(f){var c=f.target||f.srcElement;var b=Element.match;var a=this._delegates[f.type]||[];function d(g){if(b(c,g.sel)){g.fn(f)}}a.forEach(d)},_findFirstResponder:function(a){while(a&&!a.acceptsFirstResponder()){a=a.superview()}if(!a){this.makeFirstResponder(null);return}this.makeFirstResponder(a)},_onmousedown:function(b){var a=this.targetViewForEvent(b);if(a){this._findFirstResponder(a);a.onmousedown(b);Event.observe(document,"mousemove",this._onmousedragHandler)}this._mousedownView=a},_onmouseup:function(a){if(this._mousedownView){this._mousedownView.onmouseup(a)}Event.stopObserving(document,"mousemove",this._onmousedragHandler)},_onmousedrag:function(a){if(this._mousedownView){this._mousedownView.onmousedrag(a)}},_onmouseover:function(a){var g=this.__hoverTrackingIds||{};var p=this.__mouseOverIds||{};var d={};var l=a.target||a.srcElement;var h=document.body;var m;var o;var b;var f;var k;var n;for(;l&&l!=h;l=l.parentNode){b=l.id;if(!b||!(b in g)){continue}d[b]=true;if(b in p){continue}m=g[b];k=m.length;for(f=0;f<k;++f){n=m[f];if(n.onmouseenter){n.onmouseenter.call(n.owner,l,n.ownerInfo)}}}for(b in p){if(b in d){continue}l=document.getElementById(b);if(!l){continue}m=g[b];k=m.length;for(f=0;f<k;++f){n=m[f];if(n.onmouseleave){n.onmouseleave.call(n.owner,l,n.ownerInfo)}}}this.__mouseOverIds=d},_onmouseout:function(a){},_onclick:function(b){if(coherent.Browser.Mozilla&&b.button===2){return}var a=this.targetViewForEvent(b);if(a){a.onclick(b)}else{this._fireDelegates(b)}},_ondblclick:function(a){if(this._mousedownView){this._mousedownView.ondblclick(a)}},_onkeydown:function(a){var b=this.firstResponder;if(b){b.onkeydown(a)}},_onkeyup:function(a){var b=this.firstResponder;if(b){b.onkeyup(a)}},_onkeypress:function(a){var b=this.firstResponder;if(b){b.onkeypress(a)}},_onfocus:function(b){var c=b.target||b.srcElement;if(c==window){return}if(c==document){this.makeFirstResponder(this._previousFirstResponder||null);this._previousFirstResponder=null}else{var a=this.targetViewForEvent(b);if(a&&a.acceptsFirstResponder()){this.makeFirstResponder(a)}else{this.makeFirstResponder(null)}}},_onblur:function(b){var c=b.target||b.srcElement;if(c==window){return}if(c==document){this._previousFirstResponder=this.firstResponder;this.makeFirstResponder(null)}else{var a=this.targetViewForEvent(b);if(a&&this.firstResponder==a){this.makeFirstResponder(null)}}},_ontouchstart:function(b){var a=this.targetViewForEvent(b);if(a){a.ontouchstart(b);a.onmousedown(b)}this._touchstartView=a},_ontouchmove:function(a){if(this._touchstartView){this._touchstartView.ontouchmove(a)}},_ontouchend:function(a){if(this._touchstartView){this._touchstartView.ontouchend(a);this._touchstartView.onmouseup(a)}},_ontouchcancel:function(a){if(this._touchstartView){this._touchstartView.ontouchend(a);this._touchstartView.onmouseup(a)}},_onunload:function(){var b;var a=coherent.View.viewLookup;for(b in a){a[b].teardown();delete a[b]}}});(function(){coherent.page=new coherent.Page();window._setTimeout=window.setTimeout;window.setTimeout=function(g,f){if(!g){return null}if("string"===typeof(g)){g="coherent.EventLoop.begin();do {"+g+"} while (false); coherent.EventLoop.end();";return window._setTimeout(g,f)}var d=Array.from(arguments,2);function c(){coherent.EventLoop.begin();var h=g.apply(this,d);coherent.EventLoop.end();return h}return window._setTimeout(c,f)};window._setInterval=window.setInterval;window.setInterval=function(g,f){if(!g){return null}if("string"===typeof(g)){g="coherent.EventLoop.begin();do {"+g+"} while (false); coherent.EventLoop.end();";return window._setInterval(g,f)}var d=Array.from(arguments,2);function c(){coherent.EventLoop.begin();var h=g.apply(this,d);coherent.EventLoop.end();return h}return window._setInterval(c,f)};var b=coherent.page;var a;a=function(c){return function(d){d=d||window.event;Event.shiftKey=d.shiftKey;coherent.EventLoop.begin(d);b[c](d);coherent.EventLoop.end()}};if(window.addEventListener){document.addEventListener("mouseover",a("_onmouseover"),false);document.addEventListener("mouseout",a("_onmouseout"),false);document.addEventListener("mousedown",a("_onmousedown"),false);document.addEventListener("mouseup",a("_onmouseup"),false);document.addEventListener("click",a("_onclick"),false);document.addEventListener("dblclick",a("_ondblclick"),false);document.addEventListener("keydown",a("_onkeydown"),false);document.addEventListener("keyup",a("_onkeyup"),false);document.addEventListener("keypress",a("_onkeypress"),false);document.addEventListener("focus",a("_onfocus"),true);document.addEventListener("blur",a("_onblur"),true);window.addEventListener("focus",a("_onfocus"),false);window.addEventListener("blur",a("_onblur"),false);if(coherent.Support.Touches){document.addEventListener("touchstart",a("_ontouchstart"),true);document.addEventListener("touchmove",a("_ontouchmove"),true);document.addEventListener("touchend",a("_ontouchend"),true);document.addEventListener("touchcancel",a("_ontouchcancel"),true)}}else{if(window.attachEvent){document.attachEvent("onmouseover",a("_onmouseover"));document.attachEvent("onmouseout",a("_onmouseout"));document.attachEvent("onmousedown",a("_onmousedown"));document.attachEvent("onmouseup",a("_onmouseup"));document.attachEvent("onclick",a("_onclick"));document.attachEvent("ondblclick",a("_ondblclick"));document.attachEvent("onkeydown",a("_onkeydown"));document.attachEvent("onkeyup",a("_onkeyup"));document.attachEvent("onkeypress",a("_onkeypress"));document.attachEvent("onfocusin",a("_onfocus"));document.attachEvent("onfocusout",a("_onblur"));window.attachEvent("focus",a("_onfocus"));window.attachEvent("blur",a("_onblur"));window.attachEvent("onunload",a("_onunload"))}}})();coherent.TextField=Class.create(coherent.FormControl,{__viewClassName__:"TextField",__tagSpec__:["input[type=text]","input[type=password]","input[type=hidden]","textarea"],init:function(){this.base();var a=this.viewElement();Event.observe(a,"change",this.valueChanged.bindAsEventListener(this));Event.observe(a,"drop",this.fieldReceivedDropEvent.bindAsEventListener(this));this.editing=false;this.validationError=null;var b=this.bindings;if(b.maxLength&&!b.maxLength.hasValue()&&a.maxLength){b.maxLength.setValue(a.maxLength)}},exposedBindings:["errorMessage","maxLength"],multipleValuesPlaceholder:_("marker.input.multipleValues"),nullPlaceholder:_("marker.input.placeholder"),noSelectionPlaceholder:_("marker.input.noSelection"),keypressUpdateTimeout:500,continuallyUpdatesValue:true,sendsActionOnEndEditing:true,sendActionOn:["blur","keydown"],beginEditing:function(){this.editing=true},endEditing:function(){Element.removeClassName(this.viewElement(),coherent.Style.kEditingClass);this.editing=false;if(this.sendsActionOnEndEditing&&this.action){this.sendAction()}},validate:function(){var a=this.viewElement(),c=a.value,b;if(this.formatter){b=this.formatter.isStringValid(c);if(b!==true){this.presentError(b);return b}c=this.formatter.valueForString(c)}if(!(this.bindings.errorMessage&&this.bindings.errorMessage.value())){this.clearAllErrors()}if(this.bindings.value){c=this.bindings.value.validateProposedValue(c);if(c instanceof coherent.Error){this.presentError(c);return c}if(c!=this.bindings.value.value()){this.bindings.value.setValue(c)}}return c},presentError:function(a){this.validationError=a;Element.addClassName(this.viewElement(),coherent.Style.kInvalidValueClass);return this.base.apply(this,arguments)},clearAllErrors:function(){this.validationError=null;Element.removeClassName(this.viewElement(),coherent.Style.kInvalidValueClass);return this.base.apply(this,arguments)},acceptsFirstResponder:function(){var a=this.viewElement();if(a.disabled||a.readOnly){return false}return true},becomeFirstResponder:function(){var a=this.viewElement();if(a.disabled||a.readOnly){return false}if(this.markerValue){this.clearMarkerValue()}this.hasFocus=true;this.beginEditing();return true},resignFirstResponder:function(b){var a=this.viewElement();this.hasFocus=false;if(""===a.value){this.setMarkerValue("nullPlaceholder")}this.endEditing();return true},setMarkerValue:function(b){var a=this.viewElement();var c=this.attributeOrProperty(b);this.markerValue=b;a.value=c;Element.addClassName(a,coherent.Style.kMarkerClass)},clearMarkerValue:function(){var a=this.viewElement();this.markerValue=false;a.value="";Element.removeClassName(a,coherent.Style.kMarkerClass)},valueChanged:function(a){if(this.updateTimer){window.clearTimeout(this.updateTmer);this.updateTimer=null}if(this.markerValue){return}this.validate()},fieldReceivedDropEvent:function(b){var a=this.viewElement();a.value="";this.clearMarkerValue()},onkeyup:function(c){if(Event.isMetaKey(c)){return}var b=this.viewElement(),d=b.selectionStart,a=b.selectionEnd;Element.addClassName(b,coherent.Style.kEditingClass);if(coherent.Browser.Mozilla){b.selectionStart=d;b.selectionEnd=a}if(!this.continuallyUpdatesValue){return}if(this.updateTimer){window.clearTimeout(this.updateTimer)}if(b.readOnly||b.disabled){return}this.updateTimer=this.valueChanged.bindAndDelay(this,this.keypressUpdateTimeout)},onkeydown:function(a){if(this.action&&a.keyCode===Event.KEY_RETURN){this.valueChanged(null);if(this.validationError){return}this.sendAction();Event.stop(a)}},onkeypress:function(a){var b=Event;if(!this.formatter){return}if((a.charCode===0||b.isMetaKey(a)||a.charCode===b.KEY_BACKSPACE||b.isModifiedKey(a))){return}var d=String.fromCharCode(a.charCode||a.keyCode);if(!this.formatter.isValidInputCharacter(d)){Event.stop(a)}},observeValueChange:function(c){var a=this.viewElement();var b=c.newValue;if(this.formatter){b=this.formatter.stringForValue(b)}if("undefined"===typeof(b)){a.disabled=true}else{if(!this.bindings.enabled){a.disabled=false}}if(!this.bindings.editable){a.readOnly=!this.bindings.value.mutable()||coherent.Markers.MultipleValues===b||coherent.Markers.NoSelection===b}if(a.readOnly){Element.addClassName(a,coherent.Style.kReadOnlyClass)}else{Element.removeClassName(a,coherent.Style.kReadOnlyClass)}if(a.disabled){Element.addClassName(a,coherent.Style.kDisabledClass)}else{Element.removeClassName(a,coherent.Style.kDisabledClass)}if(!this.bindings.errorMessage||!this.bindings.errorMessage.value()){this.clearAllErrors()}if(this.hasFocus){return}switch(a.type){case"text":case"password":case"textarea":if(null===b||"undefined"===typeof(b)||""===b){this.setMarkerValue("nullPlaceholder")}else{if(coherent.Markers.NoSelection===b){this.setMarkerValue("noSelectionPlaceholder")}else{if(coherent.Markers.MultipleValues===b){this.setMarkerValue("multipleValuesPlaceholder")}else{this.clearMarkerValue();a.value=b}}}break;default:a.value=b;break}},observeErrorMessageChange:function(c){var b=c.newValue;if(!b){this.clearAllErrors();return}var a=new coherent.Error({description:c.newValue});this.presentError(a)},observeMaxLengthChange:function(c){var b=c.newValue;var a=this.viewElement();if("INPUT"==a.nodeName){a.maxLength=b}}});coherent.SearchField=Class.create(coherent.TextField,{__viewClassName__:"Search",__tagSpec__:"input[type=search]",exposedBindings:["predicate"],init:function(){this.base();var a=this.viewElement();if("search"===a.type){Event.observe(a,"search",this.valueChanged.bindAsEventListener(this))}},keypressUpdateTimeout:25,valueChanged:function(a){this.base(a);if(this.bindings.predicate){this.bindings.predicate.setValue(this.createFilterPredicate())}},createFilterPredicate:function(){var a=this.viewElement();var d=this.attributeOrProperty("predicate");var c=a.value.toLowerCase();function b(g){var f=g.valueForKeyPath(d);if(!f){return !!c}if(f.toLocaleString){f=f.toLocaleString()}else{f=f.toString()}f=f.toLowerCase();return(-1!==f.indexOf(c))}return b},observePredicateChange:function(a){}});coherent.SelectField=Class.create(coherent.ListView,{__viewClassName__:"Select",__tagSpec__:"select",exposedBindings:["errorMessage","displayValues","contentValues","selectedValue","name"],init:function(){this.base();this._items=function(b){var a=this.viewElement().options;return b?a[b]:a}},_initFromDOM:function(){var q=this.viewElement(),c=this.bindings,f=this.objectClass||coherent.KVO,m=[],o=[],p=q.options,n=p.length,h,k,b,g;if(q.name&&c.name&&!c.name.hasValue()){c.name.setValue(q.name)}if(!n||(c.content&&c.content.hasValue())){return}var l=c.displayValues&&c.displayValues.keyPath;var a=c.contentValues&&c.contentValues.keyPath;var d=c.content&&c.content.keyPath;if(l&&l.beginsWith(d)){l=l.substring(d.length+1)}else{l=null}if(a&&a.beginsWith(d)){a=a.substring(d.length+1)}else{a=null}for(h=0;h<n;++h){k=p[h];b=Element.assignId(k);g=o[h]=new f();if(l){g.setValueForKeyPath(k.text,l)}if(a){g.setValueForKeyPath(k.value,a)}if(k.selected){m.push(h)}}this.__content=o;this.__selectionIndexes=m;this.selectedIndex=m.length?m[0]:-1;if(c.content){c.content.setValue(o)}if(m.length){if(c.selectionIndexes){c.selectionIndexes.setValue(m)}if(c.selectedObject){c.selectedObject.setValue(this.selectedIndex)}if(c.selectedIndex){c.selectedIndex.setValue(this.selectedIndex)}if(c.selectedValue){c.selectedValue.setValue(p[this.selectedIndex].value)}}},observeContentChange:function(h){var k=this.viewElement(),d,l,f=[],m,b;switch(h.changeType){case coherent.ChangeType.setting:var g=this.__content=h.newValue||[],c=g.length;m=this.selectedObjects();while(k.options.length>c){k.remove(k.options.length-1)}for(d=0;d<c;++d){if(-1!==m.indexOf(g[d])){f.push(d)}if(d==k.options.length){if(coherent.Browser.IE){k.add(new Option())}else{k.add(new Option(),null)}}}break;case coherent.ChangeType.insertion:for(d=0;d<h.indexes.length;++d){l=h.indexes[d];if(!coherent.Browser.IE){l=k.options[l]}k.add(new Option(),l)}break;case coherent.ChangeType.replacement:for(d=0;d<h.indexes.length;++d){k.options[h.indexes[d]]=new Option()}break;case coherent.ChangeType.deletion:f=this.selectionIndexes();for(d=h.indexes.length-1;d>=0;--d){var a=h.indexes[d];k.remove(a);f.removeObject(a)}this.setSelectionIndexes(f);break;default:console.log("Unknown change type: "+h.changeType);break}if(this.bindings.displayValues){this.bindings.displayValues.update()}if(this.bindings.contentValues){this.bindings.contentValues.update()}this.setSelectionIndexes(f)},observeContentValuesChange:function(h){var b=this.viewElement();var f;var d;var g=b.options;var a=g.length;switch(h.changeType){case coherent.ChangeType.setting:if(!h.newValue){break}for(f=0;f<a;++f){g[f].value=h.newValue[f]}break;case coherent.ChangeType.insertion:case coherent.ChangeType.replacement:var c;for(c=0;c<h.indexes.length;++c){f=h.indexes[c];d=g[f];d.value=h.newValue[c]}break;default:console.log("Unknown change type: "+h.changeType);break}},observeDisplayValuesChange:function(h){var b=this.viewElement();var f;var d;var g=b.options;var a=g.length;switch(h.changeType){case coherent.ChangeType.setting:if(!h.newValue){break}for(f=0;f<a;++f){g[f].innerHTML=h.newValue[f]}break;case coherent.ChangeType.insertion:case coherent.ChangeType.replacement:var c;for(c=0;c<h.indexes.length;++c){f=h.indexes[c];d=g[f];d.innerHTML=h.newValue[c]}break;default:console.log("Unknown change type: "+h.changeType);break}},observeSelectedValueChange:function(g,k,b){if(this.bindings.content&&!this.bindings.content.value()){return}var h=this.viewElement();var l=h.options;var f=l.length;var a=g.newValue;h.disabled="undefined"===typeof(a)||coherent.Markers.MultipleValues===a||coherent.Markers.NoSelection===a;var d=[];a=a||"";for(var c=0;c<f;++c){if(l[c].value==a){d=[c];break}}this.setSelectionIndexes(d)},observeNameChange:function(d,c,b){var a=this.viewElement();a.name=d.newValue},observeErrorMessageChange:function(c){var b=c.newValue;if(!b){this.clearAllErrors();return}var a=new coherent.Error({description:c.newValue});this.presentError(a)},onkeydown:function(a){},presentError:function(a){this.validationError=a;Element.addClassName(this.viewElement(),coherent.Style.kInvalidValueClass);return this.base.apply(this,arguments)},clearAllErrors:function(){this.validationError=null;Element.removeClassName(this.viewElement(),coherent.Style.kInvalidValueClass);return this.base.apply(this,arguments)}});coherent.TableHeaderView=Class.create(coherent.View,{__viewClassName__:"TableHeader",exposedBindings:["sortDescriptors"],init:function(){this.base();var a=this.viewElement();if(!a.rows.length){return}var f=a.rows[0];var d=f.cells;var g=d.length;var c;this.__selectedColumn=-1;this.__sortKeyIndex={};for(var b=0;b<g;++b){c=d[b].getAttribute("sortKey");if(!c){continue}this.__sortKeyIndex[c]=b}},selectedColumn:function(){return this.__selectedColumn},setSelectedColumn:function(c){var b=this.viewElement();if(!b.rows.length){return}if(this.__selectedColumn===c){return}var f;var d=b.rows[0];if(-1!==this.__selectedColumn){f=d.cells[this.__selectedColumn];var a=f.__ascending?coherent.Style.kAscendingClass:coherent.Style.kDescendingClass;Element.updateClass(f,[],[coherent.Style.kSelectedClass,a])}this.__selectedColumn=c;if(-1!==this.__selectedColumn){f=d.cells[this.__selectedColumn];var g=f.__ascending?coherent.Style.kAscendingClass:coherent.Style.kDescendingClass;var h=f.__ascending?coherent.Style.kDescendingClass:coherent.Style.kAscendingClass;Element.updateClass(f,[coherent.Style.kSelectedClass,g],h)}},onclick:function(f){var a=this.viewElement();var b;var k=f.target||f.srcElement;while(k&&!(b=k.getAttribute("sortKey"))){if(k.parentNode==a){return}k=k.parentNode}if(!k){return}var d=this.__sortKeyIndex[b];if(this.__selectedColumn==d){k.__ascending=k.__ascending?false:true;var c=coherent.Style.kAscendingClass;var h=coherent.Style.kDescendingClass;if(k.__ascending){Element.updateClass(k,c,h)}else{Element.updateClass(k,h,c)}}else{this.setSelectedColumn(d)}var g=new coherent.SortDescriptor(b,k.__ascending?true:false);if(this.bindings.sortDescriptors){this.bindings.sortDescriptors.setValue([g])}},observeSortDescriptorsChange:function(c){var b=c.newValue;if(!b||!b.length||b.length>1){this.setSelectedColumn(-1);return}var a=this.__sortKeyIndex[b[0].keyPath];if("undefined"===typeof(a)||null===a){a=-1}this.setSelectedColumn(a)}});coherent.ToggleButton=Class.create(coherent.FormControl,{exposedBindings:["checked","selection"],__viewClassName__:"ToggleButton",__tagSpec__:["input[type=checkbox]","input[type=radio]"],init:function(){this.base();var a=this.viewElement();var b=this.bindings;if(b.checked&&!b.checked.hasValue()){b.checked.setValue(a.checked)}if(b.selection&&!b.selection.hasValue()&&a.checked&&a.value){b.selection.setValue(a.value)}},onclick:function(c){var a=this.viewElement();var b=a.checked;if(this.bindings.selection){this.bindings.selection.setValue(a.value)}if(this.bindings.checked){this.bindings.checked.setValue(b)}this.sendAction()},observeValueChange:function(c){this.base(c);var a=this.viewElement();var b=c.newValue;a.value=b;if(!this.bindings.selection){return}a.checked=(this.bindings.selection.value()==b);if(this.bindings.checked){this.bindings.checked.setValue(a.checked)}},observeCheckedChange:function(f,d,b){var a=this.viewElement();var c=!!f.newValue;a.checked=c;if(this.bindings.selection){this.bindings.selection.setValue(a.value)}},observeSelectionChange:function(f,d,b){var a=this.viewElement();var c=(f.newValue===a.value);a.checked=c;if(this.bindings.checked){this.bindings.checked.setValue(c)}}});coherent.ViewController=Class.create(coherent.Responder,{view:null,title:null,automaticallySetupBindings:false,constructor:function(b,c){this.base(c);if("string"===typeof(b)){this.__viewId=b}else{if(b&&1===b.nodeType){this.__viewId=Element.assignId(b)}else{this.__viewId=b.id}}var a=document.getElementById(this.__viewId);this.viewElement=function(){return a}},registerWithName:function(a){if(!a){return}this.name=a;coherent.registerModelWithName(this,a)},nextResponder:function(){return this.view.superview()},structure:function(){return this.__structure__},viewElement:function(){return this.view.viewElement()},addTrackingInfo:function(a,b){coherent.page.addTrackingInfo(a,b)},__postConstruct:function(){var a=document.getElementById(this.__viewId);if(a){this.__init()}else{Event.onDomReady(this.__init.bind(this))}},__init:function(){this.__initialising=true;var d=document.getElementById(this.__viewId);if(!d){throw new Error("Unable to locate node with ID: "+this.__viewId)}var g=this.__context;var a=coherent.dataModel;this.__context=coherent.dataModel=this;var c=this.structure()||{};var h={};var f;var k;this.__copyParameters(this.__parameters||{});var b=coherent.View.fromNode(d);for(k in c){f=c[k];if(f&&"function"==typeof(f)&&(f=f.valueOf()).__factoryFn__){h[k]=f;f.call(this,k,true)}}for(k in h){h[k].call(this,k,false)}if(!b){coherent.View.createViewsForNodeTree(d,null,this);b=coherent.View.createViewForNode(d)}this.view=b;this.view.setNextResponder(this);coherent.dataModel=a;this.__context=g;this.setupBindings();this.init();this.updateBindings();this.createObservers();delete this.__initialising;delete this.viewElement},init:function(){}});coherent.ViewController.__subclassCreated__=function(a){var b=a.prototype;var c=a.superclass.prototype;if(b.__structure__!==c.__structure__){Object.applyDefaults(b.__structure__,c.__structure__)}};
